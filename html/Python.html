<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-01-24 Fr 19:48 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>python</title>
<meta name="author" content="si" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="https://gongzhitaao.org/orgcss/org.css"/>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">python</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgeeddea5">1. collection</a></li>
<li><a href="#org77139d0">2. Install</a>
<ul>
<li><a href="#orgb4db862">2.1. prerequirement</a></li>
<li><a href="#org0c6a971">2.2. install from source code</a></li>
<li><a href="#org927d8fb">2.3. create virtualenv</a>
<ul>
<li><a href="#org45803ac">2.3.1. virtualenv</a></li>
<li><a href="#org6f8ed21">2.3.2. python3-venv</a></li>
</ul>
</li>
<li><a href="#org55b9731">2.4. pip</a>
<ul>
<li><a href="#org9cd24d4">2.4.1. ipython</a></li>
<li><a href="#orga71ee8c">2.4.2. update package</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org75f50b8">3. GPU Driver for linux</a>
<ul>
<li><a href="#orgef0b7ae">3.1. install with apt</a></li>
<li><a href="#org56293c6">3.2. install  driver 418-server, cuda 10.1, cudnn 7.6.1</a></li>
</ul>
</li>
<li><a href="#org72b66ec">4. Error</a>
<ul>
<li><a href="#orgd872611">4.1. 'int' object is not callable</a></li>
<li><a href="#org9ee92be">4.2. can't open pip installed package</a></li>
</ul>
</li>
<li><a href="#org531441d">5. Python Program collection</a>
<ul>
<li><a href="#orgec7e235">5.1. useful expression</a></li>
<li><a href="#org5154d86">5.2. map and for</a></li>
<li><a href="#org54f948e">5.3. multiply</a></li>
<li><a href="#org8d2d8a0">5.4. generator</a></li>
<li><a href="#org4d37256">5.5. List</a></li>
<li><a href="#org3fcd69e">5.6. list creation</a></li>
<li><a href="#org498308f">5.7. Break Points</a></li>
<li><a href="#org800f790">5.8. Tkinter Vairlaation</a>
<ul>
<li><a href="#org951d936">5.8.1. buttom</a></li>
<li><a href="#orgb51e6cf">5.8.2. checkbutton</a></li>
<li><a href="#org5b73f44">5.8.3. menubar</a></li>
<li><a href="#org3a56131">5.8.4. canvas (cannt load img)</a></li>
<li><a href="#org8fc5179">5.8.5. frame</a></li>
<li><a href="#orgf64765d">5.8.6. list</a></li>
<li><a href="#org483acf7">5.8.7. scale</a></li>
</ul>
</li>
<li><a href="#orgff48518">5.9. decorator</a></li>
<li><a href="#orgc9acd27">5.10. functools</a></li>
<li><a href="#org0d8e0aa">5.11. Polymorphism</a></li>
<li><a href="#org7b40154">5.12. generator</a></li>
<li><a href="#orgc4b745e">5.13. pdb</a></li>
<li><a href="#org82ec6d0">5.14. Copy</a></li>
<li><a href="#org9458d5d">5.15. Decorator</a></li>
<li><a href="#orgbf1d916">5.16. with * **</a></li>
<li><a href="#org06377c4">5.17. Python Numpy with ~</a></li>
<li><a href="#org0c74fd8">5.18. turtle movement</a></li>
<li><a href="#org1b2efdd">5.19. tempertur converse</a></li>
<li><a href="#org89b6dc1">5.20. print current time</a></li>
<li><a href="#orgc4937ec">5.21. pandas DataFrame  merge</a></li>
<li><a href="#org73f8f80">5.22. filp</a></li>
<li><a href="#org12264dd">5.23. print all attribute of object</a></li>
<li><a href="#org5cbed6e">5.24. @property</a></li>
</ul>
</li>
<li><a href="#org97a1f89">6. python automotion</a>
<ul>
<li><a href="#orge4cc221">6.1. system manipulation</a>
<ul>
<li><a href="#orgcc44528">6.1.1. os.getcwd()</a></li>
<li><a href="#org9aa7585">6.1.2. os.chdir()</a></li>
<li><a href="#org33d43a5">6.1.3. os.listdir()</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org8045b97">7. PyTorch</a>
<ul>
<li><a href="#org878647d">7.1. Basic</a>
<ul>
<li><a href="#orgb677db9">7.1.1. cpu with cuda.gpu</a></li>
<li><a href="#orgbe64ace">7.1.2. auto Derivative</a></li>
<li><a href="#org3e836dd">7.1.3. small example</a></li>
</ul>
</li>
<li><a href="#org9cf1e33">7.2. Function</a>
<ul>
<li><a href="#org2f6bc61">7.2.1. x = x.new<sub>ones</sub>(4,3)</a></li>
</ul>
</li>
<li><a href="#org24b9eb3">7.3. Iterator DataLoader</a></li>
<li><a href="#orgfff9420">7.4. torch.max</a></li>
<li><a href="#orgf79ed59">7.5. exsample 3 ploy</a></li>
</ul>
</li>
<li><a href="#orgb0c4c79">8. packages</a>
<ul>
<li><a href="#orgb4ffb79">8.1. matplotlib.plot</a>
<ul>
<li><a href="#org5f2255c">8.1.1. two linear plot</a></li>
<li><a href="#org3c6cb8b">8.1.2. simplest linear plot</a></li>
<li><a href="#orge0d2663">8.1.3. simplest point plot</a></li>
<li><a href="#org63525d8">8.1.4. simplest function plot</a></li>
<li><a href="#org2cce819">8.1.5. simplest subplot</a></li>
<li><a href="#org5ee739f">8.1.6. histogram plot with cusomised legend</a></li>
<li><a href="#org144770d">8.1.7. histogram plot</a></li>
<li><a href="#org14902b5">8.1.8. histogram y axis with log index</a></li>
<li><a href="#orgc31d2b5">8.1.9. a example of mean standrad deviation plotting</a></li>
</ul>
</li>
<li><a href="#org309dde6">8.2. pandas</a>
<ul>
<li><a href="#orgab87275">8.2.1. plot.scatter()</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org89cb34f">9. Tensorflow 1</a>
<ul>
<li><a href="#org4352160">9.1. Constand additional und multiply</a>
<ul>
<li><a href="#org046cb69">9.1.1. addition</a></li>
<li><a href="#org123f7bc">9.1.2. mpppultiply</a></li>
</ul>
</li>
<li><a href="#org913895e">9.2. Variable</a>
<ul>
<li><a href="#org11bcc40">9.2.1. the first using of variable &amp; subtract add</a></li>
<li><a href="#orge5b655d">9.2.2. assign a value for variable and update &amp; assign</a></li>
<li><a href="#org9a22082">9.2.3. fetch and Feed &amp;placeholder</a></li>
</ul>
</li>
<li><a href="#org451efb4">9.3. Tuning</a>
<ul>
<li><a href="#orgf44870d">9.3.1. change learing rate</a></li>
<li><a href="#orgd9d1538">9.3.2. learing rate for loss</a></li>
</ul>
</li>
<li><a href="#org8b444ce">9.4. train examples</a>
<ul>
<li><a href="#org261f7c0">9.4.1. the first train case</a></li>
<li><a href="#org411e4c2">9.4.2. non linear regression case</a></li>
<li><a href="#orge6761dc">9.4.3. the first train with data for accuary</a></li>
<li><a href="#org41f1453">9.4.4. a simple CNN case</a></li>
<li><a href="#org1c1a552">9.4.5. CNN train</a></li>
<li><a href="#org3e321e1">9.4.6. classification</a></li>
<li><a href="#org255fa07">9.4.7. optimizer varialbe (with error)</a></li>
<li><a href="#orga373b76">9.4.8. dropout</a></li>
<li><a href="#orgac284af">9.4.9. number identification</a></li>
<li><a href="#org7b4d031">9.4.10. with L regularizer</a></li>
<li><a href="#org0ae5eea">9.4.11. without L regularizer</a></li>
<li><a href="#orgd8d660d">9.4.12. exponen decay with L regularizer(this has error)</a></li>
<li><a href="#org600a8b8">9.4.13. read date for variables</a></li>
</ul>
</li>
<li><a href="#org6de7c97">9.5. keras</a>
<ul>
<li><a href="#org7342ee3">9.5.1. classification</a></li>
<li><a href="#orgf415757">9.5.2. regression</a></li>
</ul>
</li>
<li><a href="#org2d2e91e">9.6. sklearn</a>
<ul>
<li><a href="#org4d00eb9">9.6.1. decisiontree</a></li>
<li><a href="#org6027ca0">9.6.2. cross validation 1</a></li>
<li><a href="#org5437b22">9.6.3. cross validation 2</a></li>
<li><a href="#org404160e">9.6.4. corss validation 3</a></li>
<li><a href="#org2f65a35">9.6.5. data application</a></li>
<li><a href="#orga505df7">9.6.6. eigenschaft function</a></li>
<li><a href="#orgad2040e">9.6.7. iris</a></li>
<li><a href="#org24199c4">9.6.8. normnalization</a></li>
<li><a href="#orgbc23632">9.6.9. save load</a></li>
</ul>
</li>
<li><a href="#org5c17284">9.7. theano</a>
<ul>
<li><a href="#orgb5a4280">9.7.1. basic</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgc235c28">10. Tensorflow 2</a>
<ul>
<li><a href="#org1198e72">10.1. Tensorflow foundation</a>
<ul>
<li><a href="#org3ee66d6">10.1.1. 数值类型</a></li>
<li><a href="#org1e44052">10.1.2. Reference(,) and Segment(:)</a></li>
<li><a href="#org8ade28e">10.1.3. 改变视图</a></li>
<li><a href="#orgec9d2c6">10.1.4. 交换维度</a></li>
<li><a href="#orgd72f59b">10.1.5. Broadcasting</a></li>
<li><a href="#org367fb08">10.1.6. tile</a></li>
<li><a href="#orge645736">10.1.7. Concatenate &amp; Stack &amp; Split &amp; unstack</a></li>
<li><a href="#org285769a">10.1.8. Statistik</a></li>
<li><a href="#orgc736a0f">10.1.9. Padding</a></li>
<li><a href="#org343e3aa">10.1.10. advance manipulation</a></li>
<li><a href="#org47e2aad">10.1.11. tf.minimum</a></li>
<li><a href="#orgf904bb7">10.1.12. tf.gather</a></li>
<li><a href="#orgf04359d">10.1.13. tf.gather<sub>nd</sub></a></li>
<li><a href="#orga4d3f13">10.1.14. tf.boolean<sub>mask</sub></a></li>
<li><a href="#org29cf680">10.1.15. tf.where</a></li>
<li><a href="#orgcdc1e04">10.1.16. tf.scatter<sub>nd</sub></a></li>
<li><a href="#orgc0e8788">10.1.17. tf.meshgrid</a></li>
</ul>
</li>
<li><a href="#org662bcd0">10.2. chapter 01 code</a></li>
<li><a href="#org7faa39e">10.3. MNIST dataset</a></li>
<li><a href="#org862ec32">10.4. Make<sub>moons</sub></a></li>
<li><a href="#orga95bea1">10.5. Keras</a>
<ul>
<li><a href="#orgd556147">10.5.1. tf.keras</a></li>
<li><a href="#orgb953dd8">10.5.2. 模型的保存和加载</a></li>
<li><a href="#orgf858045">10.5.3. self-def</a></li>
</ul>
</li>
<li><a href="#orged73fd1">10.6. Dropout</a></li>
<li><a href="#org95601ef">10.7. Data Augmentation</a>
<ul>
<li><a href="#org6482b98">10.7.1. resize</a></li>
<li><a href="#orgc396477">10.7.2. rote</a></li>
<li><a href="#orge044106">10.7.3. flip</a></li>
<li><a href="#org3731d69">10.7.4. crop</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org1e5a7e3">11. IDE</a>
<ul>
<li><a href="#org1b8b6ab">11.1. emacs</a></li>
<li><a href="#orgd97ba9d">11.2. Pycharm</a></li>
<li><a href="#org39dc3b1">11.3. jupyter</a></li>
</ul>
</li>
<li><a href="#org43629be">12. Flask</a></li>
<li><a href="#orgde6337a">13. Django</a>
<ul>
<li><a href="#org263cab8">13.1. deployment</a></li>
</ul>
</li>
<li><a href="#org4b5be08">14. Golab notebook with Vim</a></li>
<li><a href="#org80c4002">15. test</a></li>
<li><a href="#orga438ad4">16. Exception</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgeeddea5" class="outline-2">
<h2 id="orgeeddea5"><span class="section-number-2">1.</span> collection</h2>
<div class="outline-text-2" id="text-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #7590db;">a</span> = 12
<span style="color: #7590db;">aa</span> = f<span style="color: #2d9574;">"a is </span>{a}<span style="color: #2d9574;">"</span>
<span style="color: #7590db;">aaa</span> = f<span style="color: #2d9574;">"a is </span>{<span style="color: #4f97d7;">str</span>(a).zfill(5)}<span style="color: #2d9574;">"</span>
<span style="color: #4f97d7;">print</span>(aa)
<span style="color: #4f97d7;">print</span>(aaa)
</pre>
</div>
</div>
</div>

<div id="outline-container-org77139d0" class="outline-2">
<h2 id="org77139d0"><span class="section-number-2">2.</span> Install</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orgb4db862" class="outline-3">
<h3 id="orgb4db862"><span class="section-number-3">2.1.</span> prerequirement</h3>
<div class="outline-text-3" id="text-2-1">
<pre class="example">
sudo apt-get install -y make build-essential libssl-dev zlib1g-dev libbz2-dev \
libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev libncursesw5-dev \
xz-utils tk-dev libffi-dev liblzma-dev python-openssl git
</pre>
</div>
</div>

<div id="outline-container-org0c6a971" class="outline-3">
<h3 id="org0c6a971"><span class="section-number-3">2.2.</span> install from source code</h3>
<div class="outline-text-3" id="text-2-2">
<p>
go to the offical python3.9 site, down the newest version python package, extract it
./configure
make
make test
sudo make install
</p>
</div>
</div>

<div id="outline-container-org927d8fb" class="outline-3">
<h3 id="org927d8fb"><span class="section-number-3">2.3.</span> create virtualenv</h3>
<div class="outline-text-3" id="text-2-3">
</div>
<div id="outline-container-org45803ac" class="outline-4">
<h4 id="org45803ac"><span class="section-number-4">2.3.1.</span> virtualenv</h4>
<div class="outline-text-4" id="text-2-3-1">
<p>
sudo apt install python3-virtualenv
virtualenv  &#x2013;python=3.10 venv
source venv/bin/activate
deactivate
</p>
</div>
</div>
<div id="outline-container-org6f8ed21" class="outline-4">
<h4 id="org6f8ed21"><span class="section-number-4">2.3.2.</span> python3-venv</h4>
<div class="outline-text-4" id="text-2-3-2">
<p>
sudo apt install python3-venv
python3 -m venv django
source venv/bin/activate
deactivate
</p>
</div>
</div>
</div>
<div id="outline-container-org55b9731" class="outline-3">
<h3 id="org55b9731"><span class="section-number-3">2.4.</span> pip</h3>
<div class="outline-text-3" id="text-2-4">
<p>
pip freeze &gt; requirement.txt
pip install -r requirement.txt
</p>
</div>
<div id="outline-container-org9cd24d4" class="outline-4">
<h4 id="org9cd24d4"><span class="section-number-4">2.4.1.</span> ipython</h4>
<div class="outline-text-4" id="text-2-4-1">
<p>
install ipyton comes error
</p>
<pre class="example">
AttributeError: 'PtkHistoryAdapter' object has no attribute '_loaded'
</pre>
<p>
this is because prompt-toolkit version 2 conflict with ipython,
upgrade it with
</p>
<pre class="example">
pip install prompt-toolkit --upgrade
</pre>
</div>
</div>
<div id="outline-container-orga71ee8c" class="outline-4">
<h4 id="orga71ee8c"><span class="section-number-4">2.4.2.</span> update package</h4>
<div class="outline-text-4" id="text-2-4-2">
<div class="org-src-container">
<pre class="src src-sh">pip list --outdated --format=freeze | grep -v <span style="color: #2d9574;">'^\-e'</span> | cut -d = -f 1  | xargs -n1 pip install -U
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org75f50b8" class="outline-2">
<h2 id="org75f50b8"><span class="section-number-2">3.</span> GPU Driver for linux</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgef0b7ae" class="outline-3">
<h3 id="orgef0b7ae"><span class="section-number-3">3.1.</span> install with apt</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Am 2022 May 09, monday I install cuda with apt,
I don't know if this is ready a offer for all, but I still wirte it down
</p>
<pre class="example">
sudo apt update
sudo apt upgrade
ubuntu-drivers devices
sudo apt install nvidia-driver-510
reboot
watch  -n 0.1 nvidia-smi 
</pre>

<pre class="example">
sudo apt install zlib1g nvidia-cuda-toolkit
nvcc -V
</pre>

<pre class="example">
pip install virtualenv 
python -m virtualenv dlforcvenv
cd dlforcvenv
source ./bin/activate
pip install torch torchvision torchaudio
</pre>

<pre class="example">
pip install notebook
python -m jupyter notebook &amp;
import torch
torch.cuda.is_available(), torch.backends.cudnn.is_available(), torch.cuda.device_count()
</pre>
</div>
</div>

<div id="outline-container-org56293c6" class="outline-3">
<h3 id="org56293c6"><span class="section-number-3">3.2.</span> install  driver 418-server, cuda 10.1, cudnn 7.6.1</h3>
<div class="outline-text-3" id="text-3-2">
<pre class="example">
1. nouveau to backlist: add following to /etc/modprobe.d/blacklist.conf
   blacklist nouveau
   options nouveau modeset=0
</pre>
<pre class="example">
2. sudo update-initramfs -u   
</pre>
<pre class="example">
3. sudo apt update
   ubuntu-drivers devices
   sudo apt install nvidia-drivers-418-server
   sudo reboot


   then I will be able to check :   nvidia-smi
</pre>

<pre class="example">
4. CUDA
   go to [[https://developer.nvidia.com/cuda-toolkit-archive]]
   select CUDA Toolkit 10.1 update 2 to install
   unmark the Drivers in  CUDA installation
</pre>
<pre class="example">
5. emacs ~/.bashrc
   export PATH="/usr/local/cuda-10.1/bin:$PATH"
   export LD_LIBRARY_PATH="/usr/lcoal/cuda-10.1/lib64:$LD_LIBRARY_PATH"
   source ~/.bashrc
</pre>
<pre class="example">
6. check CUDA
   cd /usr/local/cuda-10.1/samples/1_Utilities/deviceQuery
   sudo make
   ./deviceQuery

   OK if Result = PASS
   or nvcc -V
</pre>
<pre class="example">
6. cuDNN
   go to [[https://developer.nvidia.com/rdp/cudnn-download]]
   at least select 7.6.1 for CUDA 10.1
   sudo cp cuda/include/cudnn.h /usr/local/cuda/include/
   sudo cp cuda/lib64/libcudnn* /usr/local/cuda/lib64/
   sudo chmod a+r /usr/local/cuda/include/cudnn.h 
</pre>
<pre class="example">
7. sudo apt remove nvidia-*
   reboot
</pre>
<pre class="example">
8. download the nvidia driver source file  at
   [[https://www.nvidia.com/Download/index.aspx?lang=en-us]]
</pre>
<pre class="example">
9. cd ~/Downloads
   chmod +x ~/Downloads/NVIDIA-Linux-x86_64-450.80.02.run
   sudo ./NVI...
</pre>
<pre class="example">
10. sudo apt install python3-pip
    sudo apt install ipython3
    pip3 install pip
    pip3 install tensorflow-gpu
    ipython3
    import tensorflow as tf
    print(tf.test.is_gpu_available())
</pre>
<ol class="org-ol">
<li>fixup
sometime it can be in the case: the communication with nvidia driver is failed,
to fix it,  using apt install the driver 418-driver from apt again</li>
<li><p>
check
</p>
<div class="org-src-container">
<pre class="src src-ipython">import tensorflow as tf
if (tf.test.is_gpu_available(cuda_only=False, min_cuda_compute_capability=None)==True):
  print("using gpu")
</pre>
</div></li>
</ol>

<pre class="example">
WARNING:tensorflow:From &lt;ipython-input-3-77a0022b7707&gt;:2: is_gpu_available (from tensorflow.python.framework.test_util) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.config.list_physical_devices('GPU')` instead.
using gpu
</pre>


<div class="org-src-container">
<pre class="src src-ipython">import sys
print(sys.version)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org72b66ec" class="outline-2">
<h2 id="org72b66ec"><span class="section-number-2">4.</span> Error</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orgd872611" class="outline-3">
<h3 id="orgd872611"><span class="section-number-3">4.1.</span> 'int' object is not callable</h3>
<div class="outline-text-3" id="text-4-1">
<p>
trying to assign a variable to the system variable
</p>
</div>
</div>
<div id="outline-container-org9ee92be" class="outline-3">
<h3 id="org9ee92be"><span class="section-number-3">4.2.</span> can't open pip installed package</h3>
<div class="outline-text-3" id="text-4-2">
<p>
notebook, or ipython, such package, installed, bu can't open,
if the package is in the path, we can start it with
python -m package
</p>
</div>
</div>
</div>

<div id="outline-container-org531441d" class="outline-2">
<h2 id="org531441d"><span class="section-number-2">5.</span> Python Program collection</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-orgec7e235" class="outline-3">
<h3 id="orgec7e235"><span class="section-number-3">5.1.</span> useful expression</h3>
<div class="outline-text-3" id="text-5-1">
<p>
conditional express
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #7590db;">condition</span> = <span style="color: #a45bad;">True</span>
<span style="color: #7590db;">x</span> = 1 <span style="color: #4f97d7; font-weight: bold;">if</span> condition <span style="color: #4f97d7; font-weight: bold;">else</span> 0
<span style="color: #4f97d7;">print</span>(x)

</pre>
</div>


<p>
Large Number  Formation
</p>
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #7590db;">num1</span> = 100_000_000_000
<span style="color: #7590db;">num2</span> = 10_000_000
<span style="color: #4f97d7;">print</span>(f<span style="color: #2d9574;">'</span>{num1 + num2 :,}<span style="color: #2d9574;">'</span>)

</pre>
</div>



<p>
open with
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">with</span> <span style="color: #4f97d7;">open</span>(<span style="color: #2d9574;">'pycharm_keybounding.org'</span>,<span style="color: #2d9574;">'r'</span>) <span style="color: #4f97d7; font-weight: bold;">as</span> f:
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">file</span>= f.read()
<span style="color: #7590db;">words</span> = <span style="color: #4f97d7;">file</span>.split(<span style="color: #2d9574;">' '</span>)


</pre>
</div>

<p>
enumerate
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #7590db;">names</span> = [<span style="color: #2d9574;">'one'</span>, <span style="color: #2d9574;">'two'</span>, <span style="color: #2d9574;">'three'</span>, <span style="color: #2d9574;">'four'</span>]
<span style="color: #4f97d7; font-weight: bold;">for</span> index, name <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">enumerate</span>(names, start=1):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(index,name)

</pre>
</div>


<p>
zip
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #7590db;">names</span> = [<span style="color: #2d9574;">'one'</span>, <span style="color: #2d9574;">'two'</span>, <span style="color: #2d9574;">'three'</span>, <span style="color: #2d9574;">'four'</span>]
<span style="color: #7590db;">hero</span> = [<span style="color: #2d9574;">'ni'</span>, <span style="color: #2d9574;">'wo'</span>, <span style="color: #2d9574;">'ta'</span>, <span style="color: #2d9574;">'bu'</span>]

<span style="color: #4f97d7; font-weight: bold;">for</span> name, h <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">zip</span>(names, hero):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(f<span style="color: #2d9574;">'</span>{name}<span style="color: #2d9574;"> is actually </span>{h}<span style="color: #2d9574;">'</span>)
</pre>
</div>


<p>
unpacking tuple
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #7590db;">a</span>, <span style="color: #7590db;">b</span>, *<span style="color: #7590db;">_</span> = (1,2,3, 4,5)
<span style="color: #7590db;">a</span>, <span style="color: #7590db;">b</span>, *<span style="color: #7590db;">f</span> = (1,2,3, 4,5)
<span style="color: #7590db;">c</span>, <span style="color: #7590db;">d</span>, <span style="color: #7590db;">_</span> = (1,2,3)
<span style="color: #4f97d7;">print</span>(a)
<span style="color: #4f97d7;">print</span>(b)

</pre>
</div>


<p>
setattr, 
</p>

<p>
getattr
</p>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">from</span> getpass <span style="color: #4f97d7; font-weight: bold;">import</span> getpass
<span style="color: #7590db;">password</span> = getpass(<span style="color: #2d9574;">'Password:'</span>)
</pre>
</div>


<p>
python -m model
直接执行model模块
</p>
</div>
</div>
<div id="outline-container-org5154d86" class="outline-3">
<h3 id="org5154d86"><span class="section-number-3">5.2.</span> map and for</h3>
<div class="outline-text-3" id="text-5-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #7590db;">list1</span> = [<span style="color: #4f97d7;">ord</span>(x) <span style="color: #4f97d7; font-weight: bold;">for</span> x <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #2d9574;">'ABC'</span>]
<span style="color: #4f97d7;">print</span>(list1)

<span style="color: #7590db;">list2</span> = <span style="color: #4f97d7;">map</span>(<span style="color: #4f97d7;">ord</span>, <span style="color: #2d9574;">'ABkkC'</span>)
<span style="color: #4f97d7;">print</span>(list2)

</pre>
</div>
</div>
</div>
<div id="outline-container-org54f948e" class="outline-3">
<h3 id="org54f948e"><span class="section-number-3">5.3.</span> multiply</h3>
<div class="outline-text-3" id="text-5-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'A'</span>*3)
<span style="color: #4f97d7;">print</span>([<span style="color: #2d9574;">'A'</span>]*3)
<span style="color: #4f97d7;">print</span>([[<span style="color: #2d9574;">'A'</span>]]*3)

</pre>
</div>
</div>
</div>

<div id="outline-container-org8d2d8a0" class="outline-3">
<h3 id="org8d2d8a0"><span class="section-number-3">5.4.</span> generator</h3>
<div class="outline-text-3" id="text-5-4">
<p>
use yield stead of return
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">func</span> (lst):
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">lt</span> = []
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> i <span style="color: #4f97d7; font-weight: bold;">in</span> lst:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   lt.append( i*i)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> lt
<span style="color: #7590db;">num</span> = func([ x <span style="color: #4f97d7; font-weight: bold;">for</span> x <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(8)])
<span style="color: #4f97d7;">print</span>(num)
<span style="color: #7590db;">num1</span> = [ x*x <span style="color: #4f97d7; font-weight: bold;">for</span> x <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(8)]
<span style="color: #4f97d7;">print</span>(num1)


<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">generator</span>
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">funcg</span> (lst):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> i <span style="color: #4f97d7; font-weight: bold;">in</span> lst:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">yield</span> (i*i)

<span style="color: #7590db;">numg</span> = funcg([ x <span style="color: #4f97d7; font-weight: bold;">for</span> x <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(8)])
<span style="color: #4f97d7;">print</span>(numg)
<span style="color: #7590db;">numg1</span> = ( x*x <span style="color: #4f97d7; font-weight: bold;">for</span> x <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(8))
<span style="color: #4f97d7;">print</span>(numg1)



</pre>
</div>
</div>
</div>

<div id="outline-container-org4d37256" class="outline-3">
<h3 id="org4d37256"><span class="section-number-3">5.5.</span> List</h3>
<div class="outline-text-3" id="text-5-5">
<p>
this can not be execute, otherweise it will dead,rekursive of position 0
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #7590db;">words</span> = [<span style="color: #2d9574;">'big'</span>,<span style="color: #2d9574;">'cat'</span>,<span style="color: #2d9574;">'dog'</span>]
<span style="color: #4f97d7; font-weight: bold;">for</span> a <span style="color: #4f97d7; font-weight: bold;">in</span> words:
<span style="background-color: #292e34;"> </span>   words.insert(0, <span style="color: #2d9574;">'wo'</span>)

</pre>
</div>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #7590db;">words</span> = [<span style="color: #2d9574;">'big'</span>,<span style="color: #2d9574;">'cat'</span>,<span style="color: #2d9574;">'dog'</span>]
<span style="color: #4f97d7; font-weight: bold;">for</span> a <span style="color: #4f97d7; font-weight: bold;">in</span> words[:]:
<span style="background-color: #292e34;"> </span>   words.insert(0, <span style="color: #2d9574;">'wo'</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org3fcd69e" class="outline-3">
<h3 id="org3fcd69e"><span class="section-number-3">5.6.</span> list creation</h3>
<div class="outline-text-3" id="text-5-6">
<div class="org-src-container">
<pre class="src src-ipython">
# two fast way to create list
a0 = [1]*10
print(a0)
a1 = [1 for x in range(10)]
print(a1)

# every subarray is conneted
ak0 = [[]]*10
print(ak0)
ak0[2].append(3)
print(ak0)

# every subarray is disconneted
ak1 = [[] for x in range(10)]
print(ak1)
ak1[2].append(3)
print(ak1)

</pre>
</div>
</div>
</div>

<div id="outline-container-org498308f" class="outline-3">
<h3 id="org498308f"><span class="section-number-3">5.7.</span> Break Points</h3>
<div class="outline-text-3" id="text-5-7">
<pre class="example">
else sentence after for: after for sentence else can be used

def fun(argument, *argument, **argument)
fun(single_value, tuple, dictionary)
</pre>

<p>
lambda with funtion
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">fun</span>(n):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #4f97d7; font-weight: bold;">lambda</span> x: x+n
<span style="color: #4f97d7;">print</span>(fun(3)(4))
</pre>
</div>




<pre class="example">
nonlocal将变量的赋值,且将此值向外层作用域扩展一个范

global 将变量的赋值到程序的全局作用域
</pre>

<pre class="example">

_ value: 在交互模式下，上一次打印出来的表达式被赋值给变量 _

import test.py file as a model
import test
so all funtions and parameters can be called as in a test class
</pre>

<pre class="example">

python -i test.py 
after execute test.py file, terminal will get into python console, 
and all funtions and parameters can just be called.
</pre>
</div>
</div>
<div id="outline-container-org800f790" class="outline-3">
<h3 id="org800f790"><span class="section-number-3">5.8.</span> Tkinter Vairlaation</h3>
<div class="outline-text-3" id="text-5-8">
</div>
<div id="outline-container-org951d936" class="outline-4">
<h4 id="org951d936"><span class="section-number-4">5.8.1.</span> buttom</h4>
<div class="outline-text-4" id="text-5-8-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> tkinter <span style="color: #4f97d7; font-weight: bold;">as</span> tk

<span style="color: #7590db;">window</span> = tk.Tk()
window.title(<span style="color: #2d9574;">'my window'</span>)
window.geometry(<span style="color: #2d9574;">'200x200'</span>)

<span style="color: #7590db;">var</span> = tk.StringVar()
<span style="color: #7590db;">l</span> = tk.Label(window, bg=<span style="color: #2d9574;">'yellow'</span>, width=20, text=<span style="color: #2d9574;">'empty'</span>)
l.pack()

<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">print_selection</span>():
<span style="background-color: #292e34;"> </span>   l.config(text=<span style="color: #2d9574;">'you have selected '</span> + var.get())

<span style="color: #7590db;">r1</span> = tk.Radiobutton(window, text=<span style="color: #2d9574;">'Option A'</span>,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   variable=var, value=<span style="color: #2d9574;">'A'</span>,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   command=print_selection)
r1.pack()
<span style="color: #7590db;">r2</span> = tk.Radiobutton(window, text=<span style="color: #2d9574;">'Option B'</span>,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   variable=var, value=<span style="color: #2d9574;">'B'</span>,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   command=print_selection)
r2.pack()
<span style="color: #7590db;">r3</span> = tk.Radiobutton(window, text=<span style="color: #2d9574;">'Option C'</span>,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   variable=var, value=<span style="color: #2d9574;">'C'</span>,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   command=print_selection)
r3.pack()


window.mainloop()


</pre>
</div>
</div>
</div>
<div id="outline-container-orgb51e6cf" class="outline-4">
<h4 id="orgb51e6cf"><span class="section-number-4">5.8.2.</span> checkbutton</h4>
<div class="outline-text-4" id="text-5-8-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> tkinter <span style="color: #4f97d7; font-weight: bold;">as</span> tk

<span style="color: #7590db;">window</span> = tk.Tk()
window.title(<span style="color: #2d9574;">'my window'</span>)
window.geometry(<span style="color: #2d9574;">'200x200'</span>)

<span style="color: #7590db;">l</span> = tk.Label(window, bg=<span style="color: #2d9574;">'yellow'</span>, width=20, text=<span style="color: #2d9574;">'empty'</span>)
l.pack()

<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">print_selection</span>():
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">if</span> (var1.get() == 1) &amp; (var2.get() == 0):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   l.config(text=<span style="color: #2d9574;">'I love only Python '</span>)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">elif</span> (var1.get() == 0) &amp; (var2.get() == 1):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   l.config(text=<span style="color: #2d9574;">'I love only C++'</span>)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">elif</span> (var1.get() == 0) &amp; (var2.get() == 0):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   l.config(text=<span style="color: #2d9574;">'I do not love either'</span>)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">else</span>:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   l.config(text=<span style="color: #2d9574;">'I love both'</span>)

<span style="color: #7590db;">var1</span> = tk.IntVar()
<span style="color: #7590db;">var2</span> = tk.IntVar()
<span style="color: #7590db;">c1</span> = tk.Checkbutton(window, text=<span style="color: #2d9574;">'Python'</span>, variable=var1, onvalue=1, offvalue=0,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   command=print_selection)
<span style="color: #7590db;">c2</span> = tk.Checkbutton(window, text=<span style="color: #2d9574;">'C++'</span>, variable=var2, onvalue=1, offvalue=0,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   command=print_selection)
c1.pack()
c2.pack()


window.mainloop()


</pre>
</div>
</div>
</div>
<div id="outline-container-org5b73f44" class="outline-4">
<h4 id="org5b73f44"><span class="section-number-4">5.8.3.</span> menubar</h4>
<div class="outline-text-4" id="text-5-8-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> tkinter <span style="color: #4f97d7; font-weight: bold;">as</span> tk

<span style="color: #7590db;">window</span> = tk.Tk()
window.title(<span style="color: #2d9574;">'my window'</span>)
window.geometry(<span style="color: #2d9574;">'200x200'</span>)

<span style="color: #7590db;">l</span> = tk.Label(window, text=<span style="color: #2d9574;">''</span>, bg=<span style="color: #2d9574;">'yellow'</span>)
l.pack()
<span style="color: #7590db;">counter</span> = 0
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">do_job</span>():
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">global</span> counter
<span style="background-color: #292e34;"> </span>   l.config(text=<span style="color: #2d9574;">'do '</span>+ <span style="color: #4f97d7;">str</span>(counter))
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">counter</span>+=1

<span style="color: #7590db;">menubar</span> = tk.Menu(window)
<span style="color: #7590db;">filemenu</span> = tk.Menu(menubar, tearoff=0)
menubar.add_cascade(label=<span style="color: #2d9574;">'File'</span>, menu=filemenu)
filemenu.add_command(label=<span style="color: #2d9574;">'New'</span>, command=do_job)
filemenu.add_command(label=<span style="color: #2d9574;">'Open'</span>, command=do_job)
filemenu.add_command(label=<span style="color: #2d9574;">'Save'</span>, command=do_job)
filemenu.add_separator()
filemenu.add_command(label=<span style="color: #2d9574;">'Exit'</span>, command=window.<span style="color: #a45bad;">quit</span>)

<span style="color: #7590db;">editmenu</span> = tk.Menu(menubar, tearoff=0)
menubar.add_cascade(label=<span style="color: #2d9574;">'Edit'</span>, menu=editmenu)
editmenu.add_command(label=<span style="color: #2d9574;">'Cut'</span>, command=do_job)
editmenu.add_command(label=<span style="color: #2d9574;">'Copy'</span>, command=do_job)
editmenu.add_command(label=<span style="color: #2d9574;">'Paste'</span>, command=do_job)

<span style="color: #7590db;">submenu</span> = tk.Menu(filemenu)
filemenu.add_cascade(label=<span style="color: #2d9574;">'Import'</span>, menu=submenu, underline=0)
submenu.add_command(label=<span style="color: #2d9574;">"Submenu1"</span>, command=do_job)

window.config(menu=menubar)

window.mainloop()


</pre>
</div>
</div>
</div>
<div id="outline-container-org3a56131" class="outline-4">
<h4 id="org3a56131"><span class="section-number-4">5.8.4.</span> canvas (cannt load img)</h4>
<div class="outline-text-4" id="text-5-8-4">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> tkinter <span style="color: #4f97d7; font-weight: bold;">as</span> tk

<span style="color: #7590db;">window</span> = tk.Tk()
window.title(<span style="color: #2d9574;">'my window'</span>)
window.geometry(<span style="color: #2d9574;">'200x200'</span>)

<span style="color: #7590db;">canvas</span> = tk.Canvas(window, bg=<span style="color: #2d9574;">'blue'</span>, height=100, width=200)
<span style="color: #7590db;">image_file</span> = tk.PhotoImage(<span style="color: #4f97d7;">file</span>=<span style="color: #2d9574;">'ins.gif'</span>)
<span style="color: #7590db;">image</span> = canvas.create_image(10, 10, anchor=<span style="color: #2d9574;">'nw'</span>, image=image_file)
<span style="color: #7590db;">x0</span>, <span style="color: #7590db;">y0</span>, <span style="color: #7590db;">x1</span>, <span style="color: #7590db;">y1</span>= 50, 50, 80, 80
<span style="color: #7590db;">line</span> = canvas.create_line(x0, y0, x1, y1)
<span style="color: #7590db;">oval</span> = canvas.create_oval(x0, y0, x1, y1, fill=<span style="color: #2d9574;">'red'</span>)
<span style="color: #7590db;">arc</span> = canvas.create_arc(x0+30, y0+30, x1+30, y1+30, start=0, extent=180)
<span style="color: #7590db;">rect</span> = canvas.create_rectangle(100, 30, 100+20, 30+20)
canvas.pack()

<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">moveit</span>():
<span style="background-color: #292e34;"> </span>   canvas.move(rect, 0, 2)

<span style="color: #7590db;">b</span> = tk.Button(window, text=<span style="color: #2d9574;">'move'</span>, command=moveit).pack()


window.mainloop()

</pre>
</div>
</div>
</div>
<div id="outline-container-org8fc5179" class="outline-4">
<h4 id="org8fc5179"><span class="section-number-4">5.8.5.</span> frame</h4>
<div class="outline-text-4" id="text-5-8-5">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #4f97d7; font-weight: bold;">import</span> tkinter <span style="color: #4f97d7; font-weight: bold;">as</span> tk

<span style="color: #7590db;">window</span> = tk.Tk()
window.title(<span style="color: #2d9574;">'my window'</span>)
window.geometry(<span style="color: #2d9574;">'200x200'</span>)
tk.Label(window, text=<span style="color: #2d9574;">'on the window'</span>).pack()

<span style="color: #7590db;">frm</span> = tk.Frame(window)
frm.pack()
<span style="color: #7590db;">frm_l</span> = tk.Frame(frm, )
<span style="color: #7590db;">frm_r</span> = tk.Frame(frm)
frm_l.pack(side=<span style="color: #2d9574;">'left'</span>)
frm_r.pack(side=<span style="color: #2d9574;">'right'</span>)

tk.Label(frm_l, text=<span style="color: #2d9574;">'on the frm_l1'</span>).pack()
tk.Label(frm_l, text=<span style="color: #2d9574;">'on the frm_l2'</span>).pack()
tk.Label(frm_r, text=<span style="color: #2d9574;">'on the frm_r1'</span>).pack()
window.mainloop()

</pre>
</div>
</div>
</div>
<div id="outline-container-orgf64765d" class="outline-4">
<h4 id="orgf64765d"><span class="section-number-4">5.8.6.</span> list</h4>
<div class="outline-text-4" id="text-5-8-6">
<div class="org-src-container">
<pre class="src src-python">

<span style="color: #4f97d7; font-weight: bold;">import</span> tkinter <span style="color: #4f97d7; font-weight: bold;">as</span> tk

<span style="color: #7590db;">window</span> = tk.Tk()
window.title(<span style="color: #2d9574;">'my window'</span>)
window.geometry(<span style="color: #2d9574;">'200x200'</span>)

<span style="color: #7590db;">var1</span> = tk.StringVar()
<span style="color: #7590db;">l</span> = tk.Label(window, bg=<span style="color: #2d9574;">'yellow'</span>, width=4, textvariable=var1)
l.pack()

<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">print_selection</span>():
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">value</span> = lb.get(lb.curselection())
<span style="background-color: #292e34;"> </span>   var1.<span style="color: #4f97d7;">set</span>(value)

<span style="color: #7590db;">b1</span> = tk.Button(window, text=<span style="color: #2d9574;">'print selection'</span>, width=15,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span> height=2, command=print_selection)
b1.pack()

<span style="color: #7590db;">var2</span> = tk.StringVar()
var2.<span style="color: #4f97d7;">set</span>((11,22,33,44))
<span style="color: #7590db;">lb</span> = tk.Listbox(window, listvariable=var2)
<span style="color: #7590db;">list_items</span> = [1,2,3,4]
<span style="color: #4f97d7; font-weight: bold;">for</span> item <span style="color: #4f97d7; font-weight: bold;">in</span> list_items:
<span style="background-color: #292e34;"> </span>   lb.insert(<span style="color: #2d9574;">'end'</span>, item)
lb.insert(1, <span style="color: #2d9574;">'first'</span>)
lb.insert(2, <span style="color: #2d9574;">'second'</span>)
lb.delete(2)
lb.pack()

window.mainloop()


</pre>
</div>
</div>
</div>
<div id="outline-container-org483acf7" class="outline-4">
<h4 id="org483acf7"><span class="section-number-4">5.8.7.</span> scale</h4>
<div class="outline-text-4" id="text-5-8-7">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #4f97d7; font-weight: bold;">import</span> tkinter <span style="color: #4f97d7; font-weight: bold;">as</span> tk

<span style="color: #7590db;">window</span> = tk.Tk()
window.title(<span style="color: #2d9574;">'my window'</span>)
window.geometry(<span style="color: #2d9574;">'200x200'</span>)

<span style="color: #7590db;">l</span> = tk.Label(window, bg=<span style="color: #2d9574;">'yellow'</span>, width=20, text=<span style="color: #2d9574;">'empty'</span>)
l.pack()

<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">print_selection</span>(v):
<span style="background-color: #292e34;"> </span>   l.config(text=<span style="color: #2d9574;">'you have selected '</span> + v)

<span style="color: #7590db;">s</span> = tk.Scale(window, label=<span style="color: #2d9574;">'try me'</span>, from_=5, to=11, orient=tk.HORIZONTAL,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>length=200, showvalue=0, tickinterval=2, resolution=0.01, command=print_selection)
s.pack()

window.mainloop()


</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgff48518" class="outline-3">
<h3 id="orgff48518"><span class="section-number-3">5.9.</span> decorator</h3>
<div class="outline-text-3" id="text-5-9">
<p>
1, @后没有参数，则被修饰函数名被传到修饰函数作参数
2, @后有参数，在该参数被传到修饰函数作参数，而被修饰函数可在其定义内被接收
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">log</span>(func):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">wrapper</span>(*args, **kw):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'call function %s():'</span> % func.<span style="color: #4f97d7;">__name__</span>)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> func(*args, **kw)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> wrapper

<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">loog</span>(text):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">decorator</span>(fun):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">wrapper</span>(*args, **kw):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'kkcall function %s with %s():'</span> % (fun.<span style="color: #4f97d7;">__name__</span>, text))
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> fun(*args, **kw)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> wrapper
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> decorator



<span style="color: #ce537a; font-weight: bold;">@loog</span>(<span style="color: #2d9574;">'exit'</span>)
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">now</span>():
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"now to start"</span>)

now()
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc9acd27" class="outline-3">
<h3 id="orgc9acd27"><span class="section-number-3">5.10.</span> functools</h3>
<div class="outline-text-3" id="text-5-10">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> functools
<span style="color: #7590db;">int2</span> = functools.partial(<span style="color: #4f97d7;">int</span>, base=3)
<span style="color: #4f97d7;">print</span>(int2(<span style="color: #2d9574;">'1211'</span>))

</pre>
</div>
</div>
</div>

<div id="outline-container-org0d8e0aa" class="outline-3">
<h3 id="org0d8e0aa"><span class="section-number-3">5.11.</span> Polymorphism</h3>
<div class="outline-text-3" id="text-5-11">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">Animal</span>(<span style="color: #4f97d7;">object</span>):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">__init__</span>(<span style="color: #4f97d7; font-weight: bold;">self</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">name</span> =<span style="color: #2d9574;">'Animal name'</span>

<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">run</span>(<span style="color: #4f97d7; font-weight: bold;">self</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'Animal is running'</span>)

<span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">Dog</span>(Animal):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">__init__</span>(<span style="color: #4f97d7; font-weight: bold;">self</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">name</span> =<span style="color: #2d9574;">'Dog name'</span>
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">run</span>(<span style="color: #4f97d7; font-weight: bold;">self</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'Dog is running'</span>)

<span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">Cat</span>(Animal):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">__init__</span>(<span style="color: #4f97d7; font-weight: bold;">self</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">name</span> =<span style="color: #2d9574;">'Cat name'</span>
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">run</span>(<span style="color: #4f97d7; font-weight: bold;">self</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'Cat is running'</span>)

<span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">Tortoise</span>(Animal):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">__init__</span>(<span style="color: #4f97d7; font-weight: bold;">self</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">name</span> =<span style="color: #2d9574;">'Tortoise name'</span>
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">run</span>(<span style="color: #4f97d7; font-weight: bold;">self</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'Tortoise is running slowly'</span>)

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Polymorphism, all Class or instance will be checked the best passing</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">mothode or character</span>
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">run_twice</span>(a):
<span style="background-color: #292e34;"> </span>   a.run()

<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">name</span>(b):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(b.name)

<span style="color: #7590db;">dog</span> = Dog()
<span style="color: #7590db;">cat</span> = Cat()


run_twice(Animal())
run_twice(Dog())
run_twice(Cat())
run_twice(dog)

name(Animal())
name(Dog())
name(dog)

</pre>
</div>
</div>
</div>

<div id="outline-container-org7b40154" class="outline-3">
<h3 id="org7b40154"><span class="section-number-3">5.12.</span> generator</h3>
<div class="outline-text-3" id="text-5-12">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">something</span>():
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">result</span> = []
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> _ <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(10):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   result.append(2)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> result
<span style="color: #4f97d7;">print</span>(something())


<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">iter_some</span>():
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">x</span> = 0
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> _ <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(10):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">yield</span> x
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">x</span> += 1
<span style="color: #7590db;">a</span> = iter_some()
<span style="color: #4f97d7;">print</span>(<span style="color: #4f97d7;">next</span>(a))
<span style="color: #4f97d7;">print</span>(<span style="color: #4f97d7;">next</span>(a))
<span style="color: #4f97d7;">print</span>(<span style="color: #4f97d7;">next</span>(a))

</pre>
</div>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">fib</span> ():
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">a</span> = <span style="color: #7590db;">b</span> = 1
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">yield</span> a
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">yield</span> b
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">while</span> <span style="color: #a45bad;">True</span>:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">a</span>, <span style="color: #7590db;">b</span> = b, a+b
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">yield</span> b


<span style="color: #4f97d7; font-weight: bold;">for</span> var <span style="color: #4f97d7; font-weight: bold;">in</span> fib():
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">if</span> var &gt; 100:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">break</span>
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(var)



</pre>
</div>
</div>
</div>

<div id="outline-container-orgc4b745e" class="outline-3">
<h3 id="orgc4b745e"><span class="section-number-3">5.13.</span> pdb</h3>
<div class="outline-text-3" id="text-5-13">
<ol class="org-ol">
<li>python -m pdb test.py</li>
</ol>
<p>
step by step with n,
</p>

<ol class="org-ol">
<li>import pdb</li>
</ol>
<p>
pdb.set<sub>trace</sub>() 设置断点
</p>
</div>
</div>

<div id="outline-container-org82ec6d0" class="outline-3">
<h3 id="org82ec6d0"><span class="section-number-3">5.14.</span> Copy</h3>
<div class="outline-text-3" id="text-5-14">
<p>
copying fundmental vaiable will creat a new id for assigned varible, 
copy = [:] for object will create also a new id for new object, but not for nested object
deepcopy will also creat id for nested object in copyed object
</p>
</div>
</div>

<div id="outline-container-org9458d5d" class="outline-3">
<h3 id="org9458d5d"><span class="section-number-3">5.15.</span> Decorator</h3>
<div class="outline-text-3" id="text-5-15">
<p>
decorator just rewrite the function, using call function as argument
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">decorator_function</span>(original_function):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">wrapper_function</span>(*arg, **kwargs):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"using wrapper, and  the name is {}, and the age"</span>.<span style="color: #4f97d7;">format</span>(original_function.<span style="color: #4f97d7;">__name__</span>))
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> original_function(*arg, **kwargs)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> wrapper_function

<span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">decorator_class</span>(<span style="color: #4f97d7;">object</span>):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">__init__</span>(<span style="color: #4f97d7; font-weight: bold;">self</span>, original_function):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">original_function</span> = original_function
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">__call__</span>(<span style="color: #4f97d7; font-weight: bold;">self</span>, *arg, **kwargs):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"using the decorator class"</span>)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #4f97d7; font-weight: bold;">self</span>.original_function(*arg, **kwargs)

<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"////////function decor without augurment//////////////////////"</span>)
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">display</span>():
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"display this"</span>)
<span style="color: #7590db;">display</span> = decorator_function(display)
display()
<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"////////decorator decor without augurment//////////////////////"</span>)
<span style="color: #ce537a; font-weight: bold;">@decorator_function</span>
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">display1</span>():
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"display1 this"</span>)
display1()
<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"////////function decor with augurment//////////////////////"</span>)
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">display_info</span>(name, age):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"display the name is {}, and the age is {}"</span>.<span style="color: #4f97d7;">format</span>(name, age))
<span style="color: #7590db;">display_info</span> = decorator_function(display_info)
display_info(<span style="color: #2d9574;">"Xiang"</span>, 21)
<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"////////decorator decor with augurment//////////////////////"</span>)
<span style="color: #ce537a; font-weight: bold;">@decorator_function</span>
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">display_info1</span>(name, age):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"display the name is {}, and the age is {}"</span>.<span style="color: #4f97d7;">format</span>(name, age))
display_info1(<span style="color: #2d9574;">"Xiang"</span>, 21)
<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"/////////class decorator decor/////////////////////"</span>)
<span style="color: #ce537a; font-weight: bold;">@decorator_class</span>
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">display_info_class</span>(name, age):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"display the name is {}, and the age is {}"</span>.<span style="color: #4f97d7;">format</span>(name, age))
display_info_class(<span style="color: #2d9574;">"Xiang"</span>, 21)
<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"////////class function decor//////////////////////"</span>)
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">display_info_class</span>(name, age):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"display the name is {}, and the age is {}"</span>.<span style="color: #4f97d7;">format</span>(name, age))
<span style="color: #7590db;">display_info_class1</span> = decorator_class(display_info_class)
display_info_class1(<span style="color: #2d9574;">"Xiang"</span>, 21)



</pre>
</div>
</div>
</div>

<div id="outline-container-orgbf1d916" class="outline-3">
<h3 id="orgbf1d916"><span class="section-number-3">5.16.</span> with * **</h3>
<div class="outline-text-3" id="text-5-16">
<div class="org-src-container">
<pre class="src src-ipython">def function_with_one_star(*d):
    print(d)

def function_with_two_stars(**d):
    print(d)

function_with_one_star(1,2,3)

function_with_two_stars(a=1, b=2, c=3)


</pre>
</div>

<pre class="example">
(1, 2, 3)
{'a': 1, 'b': 2, 'c': 3}
</pre>
</div>
</div>

<div id="outline-container-org06377c4" class="outline-3">
<h3 id="org06377c4"><span class="section-number-3">5.17.</span> Python Numpy with ~</h3>
<div class="outline-text-3" id="text-5-17">
<p>
Wenn we want to filter the we wanted from a np.array,
we can define the filter  with boolen in a np.array,
</p>

<div class="org-src-container">
<pre class="src src-ipython">import numpy as np
x = np.arange(25).reshape(5,5)
print(x)

</pre>
</div>

<pre class="example">
[[ 0  1  2  3  4]
 [ 5  6  7  8  9]
 [10 11 12 13 14]
 [15 16 17 18 19]
 [20 21 22 23 24]]
</pre>

<p>
Or
</p>
<div class="org-src-container">
<pre class="src src-ipython">import numpy as np
xx = np.linspace(0, 24, 25).reshape(5,5)
print(xx)

</pre>
</div>

<pre class="example">
[[ 0.  1.  2.  3.  4.]
 [ 5.  6.  7.  8.  9.]
 [10. 11. 12. 13. 14.]
 [15. 16. 17. 18. 19.]
 [20. 21. 22. 23. 24.]]
</pre>


<p>
With np.linspace is float number, but arange is int number
</p>

<div class="org-src-container">
<pre class="src src-ipython">import numpy as np
x = np.arange(25).reshape(5,5)
y = np.array([False, False, True, True, False])
print(x[y,2])

</pre>
</div>

<pre class="example">
[12 17]
</pre>


<p>
according to   y = np.array([False, False, True, True, False]) to filter
the true position in the third column.
</p>

<p>
if we want the false position in the third column, with ~ on the filter array
</p>

<div class="org-src-container">
<pre class="src src-ipython">import numpy as np
x = np.arange(25).reshape(5,5)
y = np.array([False, False, True, True, False])
print(x[~y,2])

</pre>
</div>

<pre class="example">
[ 2  7 22]
</pre>
</div>
</div>

<div id="outline-container-org0c74fd8" class="outline-3">
<h3 id="org0c74fd8"><span class="section-number-3">5.18.</span> turtle movement</h3>
<div class="outline-text-3" id="text-5-18">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #4f97d7; font-weight: bold;">import</span> turtle
turtle.setup(650, 350, 200, 200)
turtle.penup()
turtle.fd(-250)
turtle.pendown()
turtle.pensize(25)
turtle.pencolor(<span style="color: #2d9574;">"purple"</span>)
turtle.seth(-40)
<span style="color: #4f97d7; font-weight: bold;">for</span> i <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(4):
<span style="background-color: #292e34;"> </span>   turtle.circle(40, 80)
<span style="background-color: #292e34;"> </span>   turtle.circle(-40, 80)
turtle.circle(40, 80/2)
turtle.fd(40)
turtle.circle(16, 180)
turtle.fd(40*2/3)
turtle.done()


</pre>
</div>
</div>
</div>

<div id="outline-container-org1b2efdd" class="outline-3">
<h3 id="org1b2efdd"><span class="section-number-3">5.19.</span> tempertur converse</h3>
<div class="outline-text-3" id="text-5-19">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">TempConver.py</span>
<span style="color: #7590db;">TempStr</span> = <span style="color: #4f97d7;">input</span>(<span style="color: #2d9574;">'&#35831;&#36755;&#20837;&#24102;&#26377;&#31526;&#21495;&#30340;&#28201;&#24230;&#20540;:'</span>)
<span style="color: #4f97d7; font-weight: bold;">if</span> TempStr[-1] <span style="color: #4f97d7; font-weight: bold;">in</span> [<span style="color: #2d9574;">'F'</span>, <span style="color: #2d9574;">'f'</span>]:
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">C</span> = (<span style="color: #4f97d7;">eval</span>(TempStr[0:-1]) - 32)/1.8
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'&#36716;&#25442;&#21518;&#30340;&#28201;&#24230;&#20540;&#20026;{:.2f}C'</span>.<span style="color: #4f97d7;">format</span>(C))
<span style="color: #4f97d7; font-weight: bold;">elif</span> TempStr[-1] <span style="color: #4f97d7; font-weight: bold;">in</span> [<span style="color: #2d9574;">'C'</span>, <span style="color: #2d9574;">'c'</span>]:
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">F</span> = 1.8*<span style="color: #4f97d7;">eval</span>(TempStr[0:-1]) + 32
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'&#36716;&#25442;&#21518;&#30340;&#28201;&#24230;&#20540;&#20026;{:.2f}F'</span>.<span style="color: #4f97d7;">format</span>(F))
<span style="color: #4f97d7; font-weight: bold;">else</span>:
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'&#36755;&#20837;&#26377;&#35823;'</span>)


</pre>
</div>
</div>
</div>
<div id="outline-container-org89b6dc1" class="outline-3">
<h3 id="org89b6dc1"><span class="section-number-3">5.20.</span> print current time</h3>
<div class="outline-text-3" id="text-5-20">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> turtle, time
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">drawGap</span>():
<span style="background-color: #292e34;"> </span>   turtle.penup()
<span style="background-color: #292e34;"> </span>   turtle.fd(5)
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">drawLine</span>(draw):
<span style="background-color: #292e34;"> </span>   drawGap()
<span style="background-color: #292e34;"> </span>   turtle.pendown() <span style="color: #4f97d7; font-weight: bold;">if</span> draw <span style="color: #4f97d7; font-weight: bold;">else</span> turtle.penup()
<span style="background-color: #292e34;"> </span>   turtle.fd(40)
<span style="background-color: #292e34;"> </span>   drawGap()
<span style="background-color: #292e34;"> </span>   turtle.right(90)
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">drawDigit</span>(digit):
<span style="background-color: #292e34;"> </span>   drawLine(<span style="color: #a45bad;">True</span>) <span style="color: #4f97d7; font-weight: bold;">if</span> digit <span style="color: #4f97d7; font-weight: bold;">in</span> [2,3,4,5,6,8,9] <span style="color: #4f97d7; font-weight: bold;">else</span> drawLine(<span style="color: #a45bad;">False</span>)
<span style="background-color: #292e34;"> </span>   drawLine(<span style="color: #a45bad;">True</span>) <span style="color: #4f97d7; font-weight: bold;">if</span> digit <span style="color: #4f97d7; font-weight: bold;">in</span> [0,1,3,4,5,6,7,8,9] <span style="color: #4f97d7; font-weight: bold;">else</span> drawLine(<span style="color: #a45bad;">False</span>)
<span style="background-color: #292e34;"> </span>   drawLine(<span style="color: #a45bad;">True</span>) <span style="color: #4f97d7; font-weight: bold;">if</span> digit <span style="color: #4f97d7; font-weight: bold;">in</span> [0,2,3,5,6,8,9] <span style="color: #4f97d7; font-weight: bold;">else</span> drawLine(<span style="color: #a45bad;">False</span>)
<span style="background-color: #292e34;"> </span>   drawLine(<span style="color: #a45bad;">True</span>) <span style="color: #4f97d7; font-weight: bold;">if</span> digit <span style="color: #4f97d7; font-weight: bold;">in</span> [0,2,6,8] <span style="color: #4f97d7; font-weight: bold;">else</span> drawLine(<span style="color: #a45bad;">False</span>)
<span style="background-color: #292e34;"> </span>   turtle.left(90)
<span style="background-color: #292e34;"> </span>   drawLine(<span style="color: #a45bad;">True</span>) <span style="color: #4f97d7; font-weight: bold;">if</span> digit <span style="color: #4f97d7; font-weight: bold;">in</span> [0,4,5,6,8,9] <span style="color: #4f97d7; font-weight: bold;">else</span> drawLine(<span style="color: #a45bad;">False</span>)
<span style="background-color: #292e34;"> </span>   drawLine(<span style="color: #a45bad;">True</span>) <span style="color: #4f97d7; font-weight: bold;">if</span> digit <span style="color: #4f97d7; font-weight: bold;">in</span> [0,2,3,5,6,7,8,9] <span style="color: #4f97d7; font-weight: bold;">else</span> drawLine(<span style="color: #a45bad;">False</span>)
<span style="background-color: #292e34;"> </span>   drawLine(<span style="color: #a45bad;">True</span>) <span style="color: #4f97d7; font-weight: bold;">if</span> digit <span style="color: #4f97d7; font-weight: bold;">in</span> [0,1,2,3,4,7,8,9] <span style="color: #4f97d7; font-weight: bold;">else</span> drawLine(<span style="color: #a45bad;">False</span>)
<span style="background-color: #292e34;"> </span>   turtle.left(180)
<span style="background-color: #292e34;"> </span>   turtle.penup()
<span style="background-color: #292e34;"> </span>   turtle.fd(20)
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">def drawDate(date):</span>
<span style="color: #2aa1ae; background-color: #292e34;">#     </span><span style="color: #2aa1ae; background-color: #292e34;">for i in date:</span>
<span style="color: #2aa1ae; background-color: #292e34;">#         </span><span style="color: #2aa1ae; background-color: #292e34;">drawDigit(eval(i))</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">def main():</span>
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">drawDate</span>(date):
<span style="background-color: #292e34;"> </span>   turtle.pencolor(<span style="color: #2d9574;">"red"</span>)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> i <span style="color: #4f97d7; font-weight: bold;">in</span> date:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">if</span> i == <span style="color: #2d9574;">'-'</span>:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   turtle.write(<span style="color: #2d9574;">'&#24180;'</span>, font=(<span style="color: #2d9574;">"Arial"</span>, 18, <span style="color: #2d9574;">"normal"</span>))
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   turtle.pencolor(<span style="color: #2d9574;">"green"</span>)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   turtle.fd(40)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">elif</span> i == <span style="color: #2d9574;">'='</span>:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   turtle.write(<span style="color: #2d9574;">'&#26376;'</span>, font=(<span style="color: #2d9574;">"Arial"</span>, 18, <span style="color: #2d9574;">"normal"</span>))
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   turtle.pencolor(<span style="color: #2d9574;">"blue"</span>)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   turtle.fd(40)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">elif</span> i == <span style="color: #2d9574;">'+'</span>:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   turtle.write(<span style="color: #2d9574;">'&#26085;'</span>, font=(<span style="color: #2d9574;">"Arial"</span>, 18, <span style="color: #2d9574;">"normal"</span>))
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">else</span>:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   drawDigit(<span style="color: #4f97d7;">eval</span>(i))
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">main</span>():
<span style="background-color: #292e34;"> </span>   turtle.setup(800,350,200,200)
<span style="background-color: #292e34;"> </span>   turtle.penup()
<span style="background-color: #292e34;"> </span>   turtle.fd(-300)
<span style="background-color: #292e34;"> </span>   turtle.pensize(5)
<span style="background-color: #292e34;"> </span>   <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">drawDate('20181010')</span>
<span style="background-color: #292e34;"> </span>   drawDate(time.strftime(<span style="color: #2d9574;">"%Y-%m=%d+"</span>,time.gmtime()))
<span style="background-color: #292e34;"> </span>   turtle.hideturtle()
<span style="background-color: #292e34;"> </span>   turtle.done()
main()

</pre>
</div>
</div>
</div>

<div id="outline-container-orgc4937ec" class="outline-3">
<h3 id="orgc4937ec"><span class="section-number-3">5.21.</span> pandas DataFrame  merge</h3>
<div class="outline-text-3" id="text-5-21">
<p>
merge in pandas DataFrame is very similar like join in SQL.
</p>
<div class="org-src-container">
<pre class="src src-ipython">DataFrame.merge(right,
                how='inner', 
                on=None,
                left_on=None,
                right_on=None, 
                left_index=False,
                right_index=False, 
                sort=False,
                suffixes=('_x', '_y'),
                copy=True,
                indicator=False, 
                validate=None)[source]
</pre>
</div>
<p>
how = 'inner', 'outer', 'left', 'right' default is 'inner'
inner: interaction set
output: union set
left : all left 
right : all right
</p>



<p>
if right<sub>on</sub>, left<sub>on</sub>, and on is not given, the merge is on the index(row).
we use the frist column from  left and right dataframe to merge, just like the example.
left: 'one' has 0, 1
right: 'one' has 1, 2, 3
the interaction set is only 1 
all columns will be just added together
</p>

<div class="org-src-container">
<pre class="src src-ipython">import pandas as pd
dd = {'one':[0, 1 ], 'two':[0, 0], 'three':[1, 1]}
a = pd.DataFrame(data= dd)
b = pd.DataFrame({'zero':[0,0,0], 'one':[1,2,3 ], 'two':[0,0,0 ]})
print(a)
print(b)
print(a.merge(b))
</pre>
</div>

<pre class="example">
   one  two  three
0    0    0      1
1    1    0      1
   zero  one  two
0     0    1    0
1     0    2    0
2     0    3    0
   one  two  three  zero
0    1    0      1     0
</pre>


<p>
the can also be merge on columns, for each compare elemenet 
in column with out repeated key
</p>
<div class="org-src-container">
<pre class="src src-ipython">dd = {'one':[0, 1 ], 'two':[0, 0], 'three':[1, 1]}
a = pd.DataFrame(data= dd)
b = pd.DataFrame({'zero':[0,0,0], 'one':[1,2,3 ], 'two':[0,0,0 ]})
print(a)
print(b)
print(a.merge(b, on='one', how='inner'))

</pre>
</div>

<pre class="example">
   one  two  three
0    0    0      1
1    1    0      1
   zero  one  two
0     0    1    0
1     0    2    0
2     0    3    0
   one  two_x  three  zero  two_y
0    1      0      1     0      0
</pre>


<p>
if with repeated key, the number will be multipy by its occurrence,
</p>
<div class="org-src-container">
<pre class="src src-ipython">dd = {'one':[0, 1 ], 'two':[0, 0], 'three':[1, 1]}
a = pd.DataFrame(data= dd)
b = pd.DataFrame({'zero':[0,0,0], 'one':[1,2,3 ], 'two':[0,0,0 ]})
print(a)
print(b)
print(a.merge(b, on='two', how='inner'))
</pre>
</div>

<pre class="example" id="orgc416128">
   one  two  three
0    0    0      1
1    1    0      1
   zero  one  two
0     0    1    0
1     0    2    0
2     0    3    0
   one_x  two  three  zero  one_y
0      0    0      1     0      1
1      0    0      1     0      2
2      0    0      1     0      3
3      1    0      1     0      1
4      1    0      1     0      2
5      1    0      1     0      3
</pre>
</div>
</div>

<div id="outline-container-org73f8f80" class="outline-3">
<h3 id="org73f8f80"><span class="section-number-3">5.22.</span> filp</h3>
<div class="outline-text-3" id="text-5-22">
<p>
see numpy document <a href="https://numpy.org/doc/stable/reference/generated/numpy.flip.html">numpy.flip</a>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> numpy <span style="color: #4f97d7; font-weight: bold;">as</span> np
<span style="color: #7590db;">A</span> = np.array([[1,2,3], [4,5,6], [7,8,9]])
<span style="color: #4f97d7;">print</span>(A)
<span style="color: #4f97d7;">print</span>(A[::-1])
<span style="color: #4f97d7;">print</span>(np.<span style="color: #4f97d7;">all</span>(A[::-1] == np.flip(A, 0)))


</pre>
</div>

<pre class="example">
[[1 2 3]
 [4 5 6]
 [7 8 9]]
[[7 8 9]
 [4 5 6]
 [1 2 3]]
True
</pre>
</div>
</div>

<div id="outline-container-org12264dd" class="outline-3">
<h3 id="org12264dd"><span class="section-number-3">5.23.</span> print all attribute of object</h3>
<div class="outline-text-3" id="text-5-23">
<div class="org-src-container">
<pre class="src src-ipython">from pprint import pprint
import inspect
import time
pprint(inspect.getmembers(time))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5cbed6e" class="outline-3">
<h3 id="org5cbed6e"><span class="section-number-3">5.24.</span> @property</h3>
<div class="outline-text-3" id="text-5-24">
<pre class="example">
@property: Declares the method as a property.
@&lt;property-name&gt;.setter: Specifies the setter method for a property that sets the value to a property.
@&lt;property-name&gt;.deleter: Specifies the delete method as a property that deletes a property.  
</pre>
</div>
</div>
</div>

<div id="outline-container-org97a1f89" class="outline-2">
<h2 id="org97a1f89"><span class="section-number-2">6.</span> python automotion</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-orge4cc221" class="outline-3">
<h3 id="orge4cc221"><span class="section-number-3">6.1.</span> system manipulation</h3>
<div class="outline-text-3" id="text-6-1">
</div>
<div id="outline-container-orgcc44528" class="outline-4">
<h4 id="orgcc44528"><span class="section-number-4">6.1.1.</span> os.getcwd()</h4>
<div class="outline-text-4" id="text-6-1-1">
<div class="org-src-container">
<pre class="src src-ipython">import os
print(os.getcwd())
</pre>
</div>

<pre class="example">
/home/silin/Dropbox/LiteraturPrograme/content
</pre>
</div>
</div>

<div id="outline-container-org9aa7585" class="outline-4">
<h4 id="org9aa7585"><span class="section-number-4">6.1.2.</span> os.chdir()</h4>
<div class="outline-text-4" id="text-6-1-2">
<div class="org-src-container">
<pre class="src src-ipython"># import os
# os.chdir("../../Schreibtisch")
# print(os.getcwd())
</pre>
</div>
</div>
</div>

<div id="outline-container-org33d43a5" class="outline-4">
<h4 id="org33d43a5"><span class="section-number-4">6.1.3.</span> os.listdir()</h4>
<div class="outline-text-4" id="text-6-1-3">
<div class="org-src-container">
<pre class="src src-ipython">print(os.listdir())
</pre>
</div>

<pre class="example">
[]
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8045b97" class="outline-2">
<h2 id="org8045b97"><span class="section-number-2">7.</span> PyTorch</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-org878647d" class="outline-3">
<h3 id="org878647d"><span class="section-number-3">7.1.</span> Basic</h3>
<div class="outline-text-3" id="text-7-1">
</div>
<div id="outline-container-orgb677db9" class="outline-4">
<h4 id="orgb677db9"><span class="section-number-4">7.1.1.</span> cpu with cuda.gpu</h4>
<div class="outline-text-4" id="text-7-1-1">
<div class="org-src-container">
<pre class="src src-ipython">
import torch
import time
print(torch.__version__)
print(torch.cuda.is_available)

a = torch.randn(10000, 1000)
b = torch.randn(1000, 2000)

t0 = time.time()
c = torch.matmul(a, b)
t1 = time.time()
print(a.device, t1-t0, c.norm(2))

device = torch.device('cuda')
a = a.to(device)
b = b.to(device)

t0 = time.time()
c = torch.matmul(a, b)
t2 = time.time()
print(a.device, t2-t0, c.norm(2))


t0 = time.time()
c = torch.matmul(a, b)
t2 = time.time()
print(a.device, t2-t0, c.norm(2))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbe64ace" class="outline-4">
<h4 id="orgbe64ace"><span class="section-number-4">7.1.2.</span> auto Derivative</h4>
<div class="outline-text-4" id="text-7-1-2">
<div class="org-src-container">
<pre class="src src-ipython">import torch
from torch import autograd

x = torch.tensor(1.)
a = torch.tensor(1. , requires_grad=True)
b = torch.tensor(2. , requires_grad=True)
c = torch.tensor(3. , requires_grad=True)

y = a**2*x + b*x + c

print('before:', a.grad, b.grad, c.grad)
grad = autograd.grad(y, [a,b,c])
print('after:', grad[0], grad[1], grad[2])

</pre>
</div>
</div>
</div>

<div id="outline-container-org3e836dd" class="outline-4">
<h4 id="org3e836dd"><span class="section-number-4">7.1.3.</span> small example</h4>
<div class="outline-text-4" id="text-7-1-3">
<div class="org-src-container">
<pre class="src src-ipython">import torch

x = torch.ones(2,2,requires_grad=True)
y = x +2
z = y*y*3
out = z.mean()
out.backward()
print(x.grad)

</pre>
</div>


\begin{equation}
x = 
  \left(
  \begin{array}{cc}
          1  & 1  \\
          1  & 1 \\
  \end{array}
  \right)
\end{equation}



\begin{equation}
y =    2 + x =
  \left(
  \begin{array}{cc}
          3  & 3  \\
          3  & 3 \\
  \end{array}
  \right)
\end{equation}


\begin{equation}
z =   3*y*y =
  \left(
  \begin{array}{cc}
          27  & 27  \\
          27  & 27 \\
  \end{array}
  \right)
\end{equation}

<p>
\[ out = \frac{1}{4}\sum_{i=1,j=1}^{i=2, j=2}3y_{ij}y_{ij} =\frac{1}{4}\sum_{i=1,j=1}^{i=2, j=2}3(2+x_{ij})(2+x_{ij}) \]
</p>

<p>
x.grad is to say :
\[ \frac{d(out_{ij})}{d(x_{ij})}  = 3(2+4)/4 = 4.5\] 
</p>
</div>
</div>
</div>




<div id="outline-container-org9cf1e33" class="outline-3">
<h3 id="org9cf1e33"><span class="section-number-3">7.2.</span> Function</h3>
<div class="outline-text-3" id="text-7-2">
</div>
<div id="outline-container-org2f6bc61" class="outline-4">
<h4 id="org2f6bc61"><span class="section-number-4">7.2.1.</span> x = x.new<sub>ones</sub>(4,3)</h4>
</div>
</div>

<div id="outline-container-org24b9eb3" class="outline-3">
<h3 id="org24b9eb3"><span class="section-number-3">7.3.</span> Iterator DataLoader</h3>
<div class="outline-text-3" id="text-7-3">
<p>
here, THE i is the number of iterations, each iteration has 20 iter
</p>
<div class="org-src-container">
<pre class="src src-ipython">import torch
import numpy as np

i = np.array([a for a in range(100)])
i = torch.from_numpy(i)

test = torch.utils.data.DataLoader(i, batch_size=20,shuffle=False)
testiter = iter(test)

for k, data in enumerate(testiter):
    print(k)


</pre>
</div>
</div>
</div>

<div id="outline-container-orgfff9420" class="outline-3">
<h3 id="orgfff9420"><span class="section-number-3">7.4.</span> torch.max</h3>
<div class="outline-text-3" id="text-7-4">
<p>
the return is a namedtuple
dim = 0, 1, maximum of rows or columns
</p>
<div class="org-src-container">
<pre class="src src-ipython">import torch
i = torch.randn(3,4)
print(torch.max(i, 0))
print(torch.max(i, 1))

</pre>
</div>
</div>
</div>

<div id="outline-container-orgf79ed59" class="outline-3">
<h3 id="orgf79ed59"><span class="section-number-3">7.5.</span> exsample 3 ploy</h3>
<div class="outline-text-3" id="text-7-5">
<div class="org-src-container">
<pre class="src src-ipython">import torch
import math


class Polynomial3(torch.nn.Module):
    def __init__(self):
        """
        In the constructor we instantiate four parameters and assign them as
        member parameters.
        """
        super().__init__()
        self.a = torch.nn.Parameter(torch.randn(()))
        self.b = torch.nn.Parameter(torch.randn(()))
        self.c = torch.nn.Parameter(torch.randn(()))
        self.d = torch.nn.Parameter(torch.randn(()))

    def forward(self, x):
        """
        In the forward function we accept a Tensor of input data and we must return
        a Tensor of output data. We can use Modules defined in the constructor as
        well as arbitrary operators on Tensors.
        """
        return self.a + self.b * x + self.c * x ** 2 + self.d * x ** 3

    def string(self):
        """
        Just like any class in Python, you can also define custom method on PyTorch modules
        """
        return f'y = {self.a.item()} + {self.b.item()} x + {self.c.item()} x^2 + {self.d.item()} x^3'


# Create Tensors to hold input and outputs.
x = torch.linspace(-math.pi, math.pi, 2000)
y = torch.sin(x)

# Construct our model by instantiating the class defined above
model = Polynomial3()

# Construct our loss function and an Optimizer. The call to model.parameters()
# in the SGD constructor will contain the learnable parameters of the nn.Linear
# module which is members of the model.
criterion = torch.nn.MSELoss(reduction='sum')
optimizer = torch.optim.SGD(model.parameters(), lr=1e-6)
for t in range(2000):
    # Forward pass: Compute predicted y by passing x to the model
    y_pred = model(x)

    # Compute and print loss
    loss = criterion(y_pred, y)
    if t % 100 == 99:
        print(t, loss.item())

    # Zero gradients, perform a backward pass, and update the weights.
    optimizer.zero_grad()
    loss.backward()
    optimizer.step()

print(f'Result: {model.string()}')


</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb0c4c79" class="outline-2">
<h2 id="orgb0c4c79"><span class="section-number-2">8.</span> packages</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-orgb4ffb79" class="outline-3">
<h3 id="orgb4ffb79"><span class="section-number-3">8.1.</span> matplotlib.plot</h3>
<div class="outline-text-3" id="text-8-1">
</div>
<div id="outline-container-org5f2255c" class="outline-4">
<h4 id="org5f2255c"><span class="section-number-4">8.1.1.</span> two linear plot</h4>
<div class="outline-text-4" id="text-8-1-1">
<div class="org-src-container">
<pre class="src src-ipython">import numpy as np
import random
from matplotlib import pyplot as plt

a = np.array([ x for x in range(10)])
b = np.array([[random.randint(0,10) for x in range(10)],[random.randint(0,10) for x in range(10)]])
plt.plot(a,b.T)
plt.show()


</pre>
</div>
</div>
</div>

<div id="outline-container-org3c6cb8b" class="outline-4">
<h4 id="org3c6cb8b"><span class="section-number-4">8.1.2.</span> simplest linear plot</h4>
<div class="outline-text-4" id="text-8-1-2">
<div class="org-src-container">
<pre class="src src-ipython">import matplotlib.pyplot as plt
plt.plot([1,2,3,4])
plt.ylabel('some numbers')
plt.show()


</pre>
</div>
</div>
</div>

<div id="outline-container-orge0d2663" class="outline-4">
<h4 id="orge0d2663"><span class="section-number-4">8.1.3.</span> simplest point plot</h4>
<div class="outline-text-4" id="text-8-1-3">
<div class="org-src-container">
<pre class="src src-ipython">import matplotlib.pyplot as plt
plt.plot([1,2,3,4], [1,4,9,16], 'ro')
plt.axis([0, 6, 0, 20])
plt.show()


</pre>
</div>
</div>
</div>

<div id="outline-container-org63525d8" class="outline-4">
<h4 id="org63525d8"><span class="section-number-4">8.1.4.</span> simplest function plot</h4>
<div class="outline-text-4" id="text-8-1-4">
<div class="org-src-container">
<pre class="src src-ipython">import numpy as np
import matplotlib.pyplot as plt

# evenly sampled time at 200ms intervals
t = np.arange(0., 5., 0.2)

# red dashes, blue squares and green triangles
plt.plot(t, t, 'r--', t, t**2, 'bs', t, t**3, 'g^')
plt.show()


</pre>
</div>
</div>
</div>
<div id="outline-container-org2cce819" class="outline-4">
<h4 id="org2cce819"><span class="section-number-4">8.1.5.</span> simplest subplot</h4>
<div class="outline-text-4" id="text-8-1-5">
<div class="org-src-container">
<pre class="src src-ipython">import numpy as np
import matplotlib.pyplot as plt

def f(t):
    return np.exp(-t) * np.cos(2*np.pi*t)

t1 = np.arange(0.0, 5.0, 0.1)
t2 = np.arange(0.0, 5.0, 0.02)

plt.figure(1)
plt.subplot(211)
plt.plot(t1, f(t1), 'bo', t2, f(t2), 'k')

plt.subplot(212)
plt.plot(t2, np.cos(2*np.pi*t2), 'r--')
plt.show()


</pre>
</div>
</div>
</div>
<div id="outline-container-org5ee739f" class="outline-4">
<h4 id="org5ee739f"><span class="section-number-4">8.1.6.</span> histogram plot with cusomised legend</h4>
<div class="outline-text-4" id="text-8-1-6">
<div class="org-src-container">
<pre class="src src-ipython">import numpy as np
import matplotlib.pyplot as plt

# Fixing random state for reproducibility
np.random.seed(19680801)

mu, sigma = 100, 15
x = mu + sigma * np.random.randn(10000)

# the histogram of the data
n, bins, patches = plt.hist(x, 50, normed=1, facecolor='g', alpha=0.75)


plt.xlabel('Smarts')
plt.ylabel('Probability')
plt.title('Histogram of IQ')
plt.text(60, .025, r'$\mu=100,\ \sigma=15$')
plt.axis([40, 160, 0, 0.03])
plt.grid(True)
plt.show()


</pre>
</div>
</div>
</div>
<div id="outline-container-org144770d" class="outline-4">
<h4 id="org144770d"><span class="section-number-4">8.1.7.</span> histogram plot</h4>
<div class="outline-text-4" id="text-8-1-7">
<div class="org-src-container">
<pre class="src src-ipython">import numpy as np
import matplotlib.pyplot as plt

# Fixing random state for reproducibility
np.random.seed(19680801)

mu, sigma = 100, 15
x = mu + sigma * np.random.randn(100000)

# the histogram of the data
n, bins, patches = plt.hist(x, 50, facecolor='g')

plt.xlabel('Smarts')
plt.ylabel('Probability')
plt.title('Histogram of IQ')
#plt.text(60, .025, r'$\mu=100,\ \sigma=15$')
#plt.axis([40, 160, 0, 0.03])
#plt.grid(True)
plt.show()



</pre>
</div>
</div>
</div>
<div id="outline-container-org14902b5" class="outline-4">
<h4 id="org14902b5"><span class="section-number-4">8.1.8.</span> histogram y axis with log index</h4>
<div class="outline-text-4" id="text-8-1-8">
<div class="org-src-container">
<pre class="src src-ipython">
import numpy as np
import matplotlib.pyplot as plt
from matplotlib.ticker import NullFormatter  # useful for `logit` scale

# Fixing random state for reproducibility
np.random.seed(19680801)

# make up some data in the interval ]0, 1[
y = np.random.normal(loc=0.5, scale=0.4, size=1000)
y = y[(y &gt; 0) &amp; (y &lt; 1)]
y.sort()
x = np.arange(len(y))

# plot with various axes scales
plt.figure(1)

# linear
plt.subplot(221)
plt.plot(x, y)
plt.yscale('linear')
plt.title('linear')
plt.grid(True)


# log
plt.subplot(222)
plt.plot(x, y)
plt.yscale('log')
plt.title('log')
plt.grid(True)


# symmetric log
plt.subplot(223)
plt.plot(x, y - y.mean())
plt.yscale('symlog', linthreshy=0.01)
plt.title('symlog')
plt.grid(True)

# logit
plt.subplot(224)
plt.plot(x, y)
plt.yscale('logit')
plt.title('logit')
plt.grid(True)
# Format the minor tick labels of the y-axis into empty strings with
# `NullFormatter`, to avoid cumbering the axis with too many labels.
plt.gca().yaxis.set_minor_formatter(NullFormatter())
# Adjust the subplot layout, because the logit one may take more space
# than usual, due to y-tick labels like "1 - 10^{-3}"
plt.subplots_adjust(top=0.92, bottom=0.08, left=0.10, right=0.95, hspace=0.25, wspace=0.35)

plt.show()


</pre>
</div>
</div>
</div>
<div id="outline-container-orgc31d2b5" class="outline-4">
<h4 id="orgc31d2b5"><span class="section-number-4">8.1.9.</span> a example of mean standrad deviation plotting</h4>
<div class="outline-text-4" id="text-8-1-9">
<div class="org-src-container">
<pre class="src src-ipython">import matplotlib.pyplot as plt;
import numpy as np
import scipy.stats
import scipy as sp
from scipy import integrate
from scipy.optimize import curve_fit

data = np.genfromtxt('Highz_SN_data.txt');

redshift = np.array([data[:,2]])
mu = np.array([data[:,3]])
velocity = np.array([data[:,4]])
redshift_mean = np.mean(redshift)
mu_mean = np.mean(mu)
velocity_mean = np.mean(velocity)
redshift_std = np.std(redshift)
mu_std = np.std(mu)
velocity_std = np.std(velocity)
para = ["redshift", "mu", "velocity"]
x_pos = np.arange(len(para))
ctes = [redshift_mean, mu_mean, velocity_mean]
error = [redshift_std, mu_std, velocity_std]


fig, ax = plt.subplots()
ax.bar(x_pos, ctes, yerr=error, align='center', alpha=0.5, ecolor='black', capsize=10)
ax.set_ylabel('Coefficient of Thermal Expansion ($\degree C^{-1}$)')
ax.set_xticks(x_pos)
ax.set_xticklabels(para)
ax.set_title('Coefficent of Thermal Expansion (CTE) of Three Metals')
ax.yaxis.grid(True)

# Save the figure and show
plt.tight_layout()
plt.savefig('bar_plot_with_error_bars.png')
plt.show()

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org309dde6" class="outline-3">
<h3 id="org309dde6"><span class="section-number-3">8.2.</span> pandas</h3>
<div class="outline-text-3" id="text-8-2">
</div>
<div id="outline-container-orgab87275" class="outline-4">
<h4 id="orgab87275"><span class="section-number-4">8.2.1.</span> plot.scatter()</h4>
<div class="outline-text-4" id="text-8-2-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> pandas <span style="color: #4f97d7; font-weight: bold;">as</span> pd
<span style="color: #4f97d7; font-weight: bold;">import</span> numpy <span style="color: #4f97d7; font-weight: bold;">as</span> np
<span style="color: #7590db;">a</span> = pd.DataFrame(np.random.rand(3,2))
<span style="color: #4f97d7;">print</span>(a)
a.plot.scatter(x=0, y = 1)


</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org89cb34f" class="outline-2">
<h2 id="org89cb34f"><span class="section-number-2">9.</span> Tensorflow 1</h2>
<div class="outline-text-2" id="text-9">
</div>
<div id="outline-container-org4352160" class="outline-3">
<h3 id="org4352160"><span class="section-number-3">9.1.</span> Constand additional und multiply</h3>
<div class="outline-text-3" id="text-9-1">
</div>
<div id="outline-container-org046cb69" class="outline-4">
<h4 id="org046cb69"><span class="section-number-4">9.1.1.</span> addition</h4>
<div class="outline-text-4" id="text-9-1-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">as</span> tf
<span style="color: #7590db;">a</span> = tf.constant([1.0, 2.0])
<span style="color: #7590db;">b</span> = tf.constant([3.0, 4.0])

<span style="color: #7590db;">a_m</span> = tf.constant([[1.0, 2.0]])
<span style="color: #7590db;">b_m</span> = tf.constant([[3.0], [4.0]])

<span style="color: #7590db;">result_add</span> = a + b
<span style="color: #7590db;">result_multpl</span> = tf.matmul(a_m, b_m)

<span style="color: #4f97d7; font-weight: bold;">with</span> tf.Session() <span style="color: #4f97d7; font-weight: bold;">as</span> sess:
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span> (sess.run(result_add))
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span> (sess.run(result_multpl))

<span style="color: #4f97d7;">print</span> (result_add)
<span style="color: #4f97d7;">print</span> (result_multpl)
</pre>
</div>
</div>
</div>

<div id="outline-container-org123f7bc" class="outline-4">
<h4 id="org123f7bc"><span class="section-number-4">9.1.2.</span> mpppultiply</h4>
<div class="outline-text-4" id="text-9-1-2">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #4f97d7; font-weight: bold;">import</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">as</span> tf
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#21019;&#24314;&#24120;&#37327;</span>
<span style="color: #7590db;">m1</span>= tf.constant([[3,3]])
<span style="color: #7590db;">m2</span>=tf.constant([[1],[2]])
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#30456;&#20056;</span>
<span style="color: #7590db;">product</span> = tf.matmul(m1,m2)
<span style="color: #4f97d7;">print</span>(product)

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#23450;&#20041;&#19968;&#20010;&#20250;&#35805;&#65292;&#21551;&#21160;&#40664;&#35748;&#22270;</span>
<span style="color: #7590db;">sess</span> = tf.Session()
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#35843;&#29992;sess&#65292;&#25191;&#34892;&#20056;&#27861;&#36816;&#31639;</span>
<span style="color: #7590db;">result</span> = sess.run(product)
<span style="color: #4f97d7;">print</span>(result)
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#19981;&#35201;&#24536;&#20102;&#20851;&#38381;sess</span>
sess.close()

<span style="color: #4f97d7; font-weight: bold;">with</span> tf.Session() <span style="color: #4f97d7; font-weight: bold;">as</span> sess:
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">result</span> = sess.run(product)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(result)
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#20351;&#29992;with&#19981;&#38656;&#35201;&#19987;&#38376;&#20851;&#38381;sess</span>


</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org913895e" class="outline-3">
<h3 id="org913895e"><span class="section-number-3">9.2.</span> Variable</h3>
<div class="outline-text-3" id="text-9-2">
</div>
<div id="outline-container-org11bcc40" class="outline-4">
<h4 id="org11bcc40"><span class="section-number-4">9.2.1.</span> the first using of variable &amp; subtract add</h4>
<div class="outline-text-4" id="text-9-2-1">
<div class="org-src-container">
<pre class="src src-python"><span style="background-color: #292e34;"> </span> <span style="color: #4f97d7; font-weight: bold;">import</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">as</span> tf
<span style="background-color: #292e34;"> </span> <span style="color: #7590db;">x</span> = tf.Variable([1,2])
<span style="background-color: #292e34;"> </span> <span style="color: #7590db;">a</span> = tf.constant([3,3])
<span style="background-color: #292e34;"> </span> <span style="color: #7590db;">sub</span> = tf.subtract(x,a)
<span style="background-color: #292e34;"> </span> <span style="color: #7590db;">add</span> = tf.add(x,sub)
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#23545;&#20110;&#21464;&#37327;&#65292;&#35201;&#21021;&#22987;&#21270;init</span>
<span style="background-color: #292e34;"> </span> <span style="color: #7590db;">init</span> = tf.global_variables_initializer()
<span style="background-color: #292e34;"> </span> <span style="color: #4f97d7; font-weight: bold;">with</span> tf.Session() <span style="color: #4f97d7; font-weight: bold;">as</span> sess:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span> sess.run(init)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span> <span style="color: #4f97d7;">print</span>(sess.run(sub))
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span> <span style="color: #4f97d7;">print</span>(sess.run(add))


</pre>
</div>
</div>
</div>

<div id="outline-container-orge5b655d" class="outline-4">
<h4 id="orge5b655d"><span class="section-number-4">9.2.2.</span> assign a value for variable and update &amp; assign</h4>
<div class="outline-text-4" id="text-9-2-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">............................&#65294;&#65294;&#65294;&#65294;&#65294;&#65294;&#21464;&#37327;&#35745;&#31639;</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#21464;&#37327;&#21487;&#20197;&#34987;&#36215;&#21517;&#65292;&#21021;&#22987;&#21270;&#20026;&#65296;</span>
<span style="color: #4f97d7; font-weight: bold;">import</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">as</span> tf
<span style="color: #7590db;">state</span> = tf.Variable(0, name = <span style="color: #2d9574;">'counter'</span>)
<span style="color: #7590db;">new_value</span> = tf.add(state,1)
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#36171;&#20540;&#21151;&#33021;assign</span>
<span style="color: #7590db;">update</span> = tf.assign(state,new_value)
<span style="color: #7590db;">init</span> = tf.global_variables_initializer()
<span style="color: #4f97d7; font-weight: bold;">with</span> tf.Session() <span style="color: #4f97d7; font-weight: bold;">as</span> sess:
<span style="background-color: #292e34;"> </span>   sess.run(init)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(state)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> _ <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(5):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   sess.run(update)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(sess.run(state))
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(sess.run(update))


</pre>
</div>
</div>
</div>

<div id="outline-container-org9a22082" class="outline-4">
<h4 id="org9a22082"><span class="section-number-4">9.2.3.</span> fetch and Feed &amp;placeholder</h4>
<div class="outline-text-4" id="text-9-2-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">as</span> tf
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Fetch &#22312;&#19968;&#20010;&#20250;&#35805;&#37324;&#25191;&#34892;&#22810;&#20010;op</span>
<span style="color: #7590db;">input1</span> = tf.constant(3.0)
<span style="color: #7590db;">input2</span> = tf.constant(2.0)
<span style="color: #7590db;">input3</span> = tf.constant(5.0)

<span style="color: #7590db;">add</span> = tf.add(input2,input3)
<span style="color: #7590db;">mul</span> = tf.multiply(input1,add)

<span style="color: #4f97d7; font-weight: bold;">with</span> tf.Session() <span style="color: #4f97d7; font-weight: bold;">as</span> sess:
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">result</span> = sess.run([add,mul])  <span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#26377;[]</span>
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(result)

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">------------------Feed</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#21019;&#24314;&#21344;&#20301;&#31526;</span>
<span style="color: #7590db;">input4</span>= tf.placeholder(tf.float32)
<span style="color: #7590db;">input5</span> = tf.placeholder(tf.float32)
<span style="color: #7590db;">output</span> = tf.multiply(input4, input5)
<span style="color: #4f97d7; font-weight: bold;">with</span> tf.Session() <span style="color: #4f97d7; font-weight: bold;">as</span> sess:
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(sess.run(output,feed_dict = {<span style="color: #7590db;">input4</span>:[7.0],input5:[2.0]}))  <span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#38543;&#21518;&#36171;&#20540;&#26159;&#29992;&#23383;&#20856;&#30340;&#26041;&#24335;&#36827;&#34892;&#30340;feed_dict = {input4:[7.0],input5:[2.0]}, &#25968;&#23383;&#36824;&#21152;&#20102;&#26041;&#25324;&#21495;&#65294;</span>


</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org451efb4" class="outline-3">
<h3 id="org451efb4"><span class="section-number-3">9.3.</span> Tuning</h3>
<div class="outline-text-3" id="text-9-3">
</div>
<div id="outline-container-orgf44870d" class="outline-4">
<h4 id="orgf44870d"><span class="section-number-4">9.3.1.</span> change learing rate</h4>
<div class="outline-text-4" id="text-9-3-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">coding:utf-8</span>

<span style="color: #4f97d7; font-weight: bold;">import</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">as</span> tf
<span style="color: #7590db;">LEARING_RATE_BASE</span> = 0.1
<span style="color: #7590db;">LEARING_RATE_DECAY</span> = 0.99
<span style="color: #7590db;">LEARING_RATE_STEP</span>= 1

<span style="color: #7590db;">global_step</span> = tf.Variable(0,trainable = <span style="color: #a45bad;">False</span>)
<span style="color: #7590db;">learning_rate</span> = tf.train.exponential_decay(LEARING_RATE_BASE, global_step,
LEARING_RATE_STEP, LEARING_RATE_DECAY, staircase = <span style="color: #a45bad;">True</span>)

<span style="color: #7590db;">w</span> = tf.Variable(tf.constant(5, dtype = tf.float32))
<span style="color: #7590db;">loss</span> = tf.square(w+1)

<span style="color: #7590db;">train_step</span> = tf.train.GradientDescentOptimizer(learning_rate).minimize(loss,global_step = global_step)

<span style="color: #4f97d7; font-weight: bold;">with</span> tf.Session() <span style="color: #4f97d7; font-weight: bold;">as</span> sess:
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">init_op</span> = tf.global_variables_initializer()
<span style="background-color: #292e34;"> </span>   sess.run(init_op)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> i <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(40):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   sess.run(train_step)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">learnin_rate_val</span> = sess.run(learning_rate)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">global_step_val</span> = sess.run(global_step)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">w_val</span> = sess.run(w)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">loss_val</span> = sess.run(loss)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">" After {} steps: global_step is {}, w is {}, learnin_rate is {}, loss is {}"</span>
.<span style="color: #4f97d7;">format</span>(i, global_step_val, w_val, learnin_rate_val, loss_val))


</pre>
</div>
</div>
</div>
<div id="outline-container-orgd9d1538" class="outline-4">
<h4 id="orgd9d1538"><span class="section-number-4">9.3.2.</span> learing rate for loss</h4>
<div class="outline-text-4" id="text-9-3-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">as</span> tf
<span style="color: #7590db;">w</span> = tf.Variable(tf.constant(5,dtype=tf.float32))
<span style="color: #7590db;">loss</span> = tf.square(w+1)
<span style="color: #7590db;">train_step</span> = tf.train.GradientDescentOptimizer(0.2).minimize(loss)

<span style="color: #4f97d7; font-weight: bold;">with</span> tf.Session() <span style="color: #4f97d7; font-weight: bold;">as</span> sess:
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">init_op</span>=tf.global_variables_initializer()
<span style="background-color: #292e34;"> </span>   sess.run(init_op)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> i <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(50):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   sess.run(train_step)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">w_var</span> = sess.run(w)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">loss_val</span> = sess.run(loss)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"After {} steps: w is {}, loss is {}"</span>.<span style="color: #4f97d7;">format</span>(i,w_var,loss_val))
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">print("After %s steps: w is %f, loss is %f." %(i,w_var, loss_val))</span>


</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8b444ce" class="outline-3">
<h3 id="org8b444ce"><span class="section-number-3">9.4.</span> train examples</h3>
<div class="outline-text-3" id="text-9-4">
</div>
<div id="outline-container-org261f7c0" class="outline-4">
<h4 id="org261f7c0"><span class="section-number-4">9.4.1.</span> the first train case</h4>
<div class="outline-text-4" id="text-9-4-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">as</span> tf
<span style="color: #4f97d7; font-weight: bold;">import</span> numpy <span style="color: #4f97d7; font-weight: bold;">as</span> np
<span style="color: #4f97d7; font-weight: bold;">import</span> matplotlib.pyplot <span style="color: #4f97d7; font-weight: bold;">as</span> plt
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#29983;&#25104;&#38543;&#26426;&#25968;&#25454;</span>
<span style="color: #7590db;">x_date</span> = np.random.rand(100)
<span style="color: #7590db;">y_date</span> = x_date*0.4 + 2

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#26500;&#36896;&#32447;&#24615;&#27169;&#22411;</span>
<span style="color: #7590db;">b</span> = tf.Variable(0.)
<span style="color: #7590db;">k</span> = tf.Variable(0.)
<span style="color: #7590db;">y</span> = k*x_date + b

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#26500;&#36896;&#20108;&#27425;&#20195;&#20215;&#20989;&#25968;</span>
<span style="color: #7590db;">loss</span> = tf.reduce_mean(tf.square(y_date-y))
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#23450;&#20041;&#26799;&#24230;&#19979;&#38477;&#30340;&#20248;&#21270;&#22120;</span>
<span style="color: #7590db;">optimizer</span> = tf.train.GradientDescentOptimizer(0.2)
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#23450;&#20041;&#19968;&#20010;&#26368;&#23567;&#21270;&#20195;&#20215;&#20989;&#25968;</span>
<span style="color: #7590db;">train</span> = optimizer.minimize(loss)
<span style="color: #7590db;">init</span> = tf.global_variables_initializer()
<span style="color: #4f97d7; font-weight: bold;">with</span> tf.Session() <span style="color: #4f97d7; font-weight: bold;">as</span> sess:
<span style="background-color: #292e34;"> </span>   sess.run(init)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> steps <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(201):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   sess.run(train)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">if</span> steps%20 == 0:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(steps, sess.run([k,b]))
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">prediction_value</span> = sess.run(y)
<span style="background-color: #292e34;"> </span>   plt.figure()
<span style="background-color: #292e34;"> </span>   plt.scatter(x_date, y_date)
<span style="background-color: #292e34;"> </span>   plt.plot(x_date,prediction_value,<span style="color: #2d9574;">'r-'</span>,lw=5)
<span style="background-color: #292e34;"> </span>   plt.show()



</pre>
</div>
</div>
</div>

<div id="outline-container-org411e4c2" class="outline-4">
<h4 id="org411e4c2"><span class="section-number-4">9.4.2.</span> non linear regression case</h4>
<div class="outline-text-4" id="text-9-4-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">----------------------------&#38750;&#32447;&#24615;&#22238;&#24402;</span>
<span style="color: #4f97d7; font-weight: bold;">import</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">as</span> tf
<span style="color: #4f97d7; font-weight: bold;">import</span> numpy <span style="color: #4f97d7; font-weight: bold;">as</span> np
<span style="color: #4f97d7; font-weight: bold;">import</span> matplotlib.pyplot <span style="color: #4f97d7; font-weight: bold;">as</span> plt

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#26500;&#36896;&#25968;&#25454;</span>
<span style="color: #7590db;">x_date</span> = np.linspace (-0.5,0.5,100)[:,np.newaxis] <span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">np.newaxis &#21151;&#33021;&#21516;None&#65292;&#23558;&#34892;&#21464;&#21015;</span>
<span style="color: #7590db;">noise</span> = np.random.normal(0,0.02,x_date.shape)
<span style="color: #7590db;">y_date</span> = np.square(x_date)+noise

<span style="color: #7590db;">x</span> = tf.placeholder(tf.float32,[<span style="color: #a45bad;">None</span>,1])
<span style="color: #7590db;">y</span> = tf.placeholder(tf.float32,[<span style="color: #a45bad;">None</span>,1])

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#26500;&#24314;&#31070;&#32463;&#32593;&#32476;</span>
<span style="color: #7590db;">Weight_L1</span> = tf.Variable(tf.random_normal([1,10]))
<span style="color: #7590db;">Biase_L1</span> = tf.Variable(tf.zeros([1,10]))
<span style="color: #7590db;">Wx_plus_b_L1</span> = tf.matmul(x,Weight_L1)+Biase_L1
<span style="color: #7590db;">L1</span> = tf.nn.tanh(Wx_plus_b_L1)

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#23450;&#20041;&#36755;&#20986;&#23618;</span>
<span style="color: #7590db;">Weight_L2</span> = tf.Variable(tf.random_normal([10,1]))
<span style="color: #7590db;">Biase_L2</span> = tf.Variable(tf.zeros([1,1]))
<span style="color: #7590db;">Wx_plus_b_L2</span> = tf.matmul(L1,Weight_L2)+ Biase_L2
<span style="color: #7590db;">prediction</span> = tf.nn.tanh(Wx_plus_b_L2)

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#20108;&#27425;&#20195;&#20215;&#20989;&#25968;</span>
<span style="color: #7590db;">loss</span> = tf.reduce_mean(tf.square(y-prediction))
<span style="color: #7590db;">train_step</span> = tf.train.GradientDescentOptimizer(0.1).minimize(loss)
<span style="color: #4f97d7; font-weight: bold;">with</span> tf.Session() <span style="color: #4f97d7; font-weight: bold;">as</span> sess:
<span style="background-color: #292e34;"> </span>   sess.run(tf.global_variables_initializer())
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> _ <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(2000):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   sess.run(train_step,feed_dict={x:x_date,y:y_date})

<span style="background-color: #292e34;"> </span>   <span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#35757;&#32451;&#22909;&#21518;&#65292;&#29992;&#26469;&#20570;&#39044;&#27979;</span>
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">prediction_value</span> = sess.run(prediction,feed_dict={x:x_date})
<span style="background-color: #292e34;"> </span>   plt.figure()
<span style="background-color: #292e34;"> </span>   plt.scatter(x_date, y_date)
<span style="background-color: #292e34;"> </span>   plt.plot(x_date,prediction_value,<span style="color: #2d9574;">'r-'</span>,lw=5)
<span style="background-color: #292e34;"> </span>   plt.show()


</pre>
</div>
</div>
</div>

<div id="outline-container-orge6761dc" class="outline-4">
<h4 id="orge6761dc"><span class="section-number-4">9.4.3.</span> the first train with data for accuary</h4>
<div class="outline-text-4" id="text-9-4-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">as</span> tf
<span style="color: #4f97d7; font-weight: bold;">from</span> tensorflow.examples.tutorials.mnist <span style="color: #4f97d7; font-weight: bold;">import</span> input_data
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#36733;&#20837;&#25968;&#25454;&#38598;</span>
<span style="color: #7590db;">mnist</span>= input_data.read_data_sets(<span style="color: #2d9574;">'MNIST_data'</span>, one_hot = <span style="color: #a45bad;">True</span>)

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#35774;&#23450;&#27599;&#20010;&#25209;&#27425;&#30340;&#22823;&#23567;</span>
<span style="color: #7590db;">batch_size</span> = 100
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#35745;&#31639;&#24635;&#20849;&#30340;&#25209;&#27425;</span>
<span style="color: #7590db;">n_batch</span> = mnist.train.num_examples // batch_size

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#21442;&#25968;&#32479;&#35745;</span>
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">variable_summries</span>(var):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">with</span> tf.name_scope(<span style="color: #2d9574;">'summaries'</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">mean</span> = tf.reduce_mean(var)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   tf.summary.scalar(<span style="color: #2d9574;">'mean'</span>,mean)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">with</span> tf.name_scope(<span style="color: #2d9574;">'stddev'</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">stddev</span> = tf.sqrt(tf.reduce_mean(tf.square(var-mean)))
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   tf.summary.scalar(<span style="color: #2d9574;">'stddev'</span>,stddev)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   tf.summary.scalar(<span style="color: #2d9574;">'max'</span>,tf.reduce_max(var))
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   tf.summary.scalar(<span style="color: #2d9574;">'min'</span>,tf.reduce_min(var))
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   tf.summary.histogram(<span style="color: #2d9574;">'histogram'</span>,var)

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#21629;&#21517;&#31354;&#38388;</span>
<span style="color: #4f97d7; font-weight: bold;">with</span> tf.name_scope(<span style="color: #2d9574;">'input'</span>):
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">x</span> = tf.placeholder(tf.float32,[<span style="color: #a45bad;">None</span>,784])
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">y</span> = tf.placeholder(tf.float32,[<span style="color: #a45bad;">None</span>,10])

<span style="color: #4f97d7; font-weight: bold;">with</span> tf.name_scope(<span style="color: #2d9574;">'layers'</span>):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">with</span> tf.name_scope(<span style="color: #2d9574;">'wight'</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">W</span> = tf.Variable(tf.truncated_normal([784,10]))
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   variable_summries(W)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">with</span> tf.name_scope(<span style="color: #2d9574;">'biases'</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">B</span> = tf.Variable(tf.zeros([10])+0.1)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   variable_summries(B)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">with</span> tf.name_scope(<span style="color: #2d9574;">'wx_plus_b'</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">wx_plus_b</span>=tf.matmul(x,W)+B
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">with</span> tf.name_scope(<span style="color: #2d9574;">'softmax'</span>):    
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">prediction</span> = tf.nn.tanh(wx_plus_b)

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#23450;&#20041;&#20108;&#27425;&#20195;&#20215;&#20989;&#25968;</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">loss = tf.reduce_mean(tf.square(y-prediction))</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#37325;&#26032;&#23450;&#20041;&#23545;&#25968;(&#20132;&#21449;&#29109;)</span>
<span style="color: #4f97d7; font-weight: bold;">with</span> tf.name_scope(<span style="color: #2d9574;">'loss'</span>):
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">loss</span> =tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits(labels=y,logits=prediction))
<span style="background-color: #292e34;"> </span>   tf.summary.scalar(<span style="color: #2d9574;">'loss'</span>,loss)
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#20351;&#29992;&#26799;&#24230;&#19979;&#38477;&#27861;</span>

<span style="color: #4f97d7; font-weight: bold;">with</span> tf.name_scope(<span style="color: #2d9574;">'train'</span>):
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">train_step</span> = tf.train.GradientDescentOptimizer(0.2).minimize(loss)
<span style="color: #2aa1ae; background-color: #292e34;">#    </span><span style="color: #2aa1ae; background-color: #292e34;">train_step = tf.train.AdamOptimizer(0.05).minimize(loss)</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#21021;&#22987;&#21270;</span>
<span style="color: #7590db;">init</span> = tf.global_variables_initializer()

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#27979;&#35797;&#20934;&#30830;&#29575;</span>
<span style="color: #4f97d7; font-weight: bold;">with</span> tf.name_scope(<span style="color: #2d9574;">'accuracy'</span>):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">with</span> tf.name_scope(<span style="color: #2d9574;">'correct_prediction'</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">correct_prediction</span> = tf.equal(tf.argmax(y,1), tf.argmax(prediction,1))
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">with</span> tf.name_scope(<span style="color: #2d9574;">'accuracy'</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">accuracy</span> = tf.reduce_mean(tf.cast(correct_prediction,tf.float32))
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   tf.summary.scalar(<span style="color: #2d9574;">'accuracy'</span>,accuracy)

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#21512;&#24182;summary</span>
<span style="color: #7590db;">merged</span> = tf.summary.merge_all()
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#35757;&#32451;&#24320;&#22987;</span>
<span style="color: #4f97d7; font-weight: bold;">with</span> tf.Session() <span style="color: #4f97d7; font-weight: bold;">as</span> sess:
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">writer</span> = tf.summary.FileWriter(<span style="color: #2d9574;">'pics/'</span>,sess.graph)
<span style="background-color: #292e34;"> </span>   sess.run(init)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> epoch <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(51):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> batch <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(n_batch):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">batch_xs</span>, <span style="color: #7590db;">batch_ys</span> = mnist.train.next_batch(batch_size)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">summary</span>,<span style="color: #7590db;">_</span> = sess.run([merged,train_step], feed_dict={x:batch_xs, y:batch_ys})
<span style="color: #2aa1ae; background-color: #292e34;">#            </span><span style="color: #2aa1ae; background-color: #292e34;">writer.add_summary(summary,batch)</span>
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   writer.add_summary(summary,epoch)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">acc</span> = sess.run(accuracy,feed_dict={x:mnist.test.images, y:mnist.test.labels})
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"&#20934;&#30830;&#29575;&#20026;:&#12288;&#22312;"</span>+<span style="color: #4f97d7;">str</span>(epoch)+<span style="color: #2d9574;">"&#22238;,"</span>+<span style="color: #4f97d7;">str</span>(acc))



</pre>
</div>
</div>
</div>

<div id="outline-container-org41f1453" class="outline-4">
<h4 id="org41f1453"><span class="section-number-4">9.4.4.</span> a simple CNN case</h4>
<div class="outline-text-4" id="text-9-4-4">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">as</span> tf
<span style="color: #4f97d7; font-weight: bold;">import</span> numpy <span style="color: #4f97d7; font-weight: bold;">as</span> np
<span style="color: #7590db;">BATCH_SIZE</span> = 8
<span style="color: #7590db;">seed</span> = 23455

<span style="color: #7590db;">rng</span> = np.random.RandomState(seed)
<span style="color: #7590db;">X</span> = rng.rand(32, 2)
<span style="color: #7590db;">Y</span> = [[<span style="color: #4f97d7;">int</span>(X0+X1 &lt; 1)] <span style="color: #4f97d7; font-weight: bold;">for</span> (X0, X1) <span style="color: #4f97d7; font-weight: bold;">in</span> X]
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">print ("X is :", X)</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">print ("Y is :", Y)</span>

<span style="color: #7590db;">x</span> = tf.placeholder(tf.float32, shape = (<span style="color: #a45bad;">None</span>, 2))
<span style="color: #7590db;">y_</span> = tf.placeholder(tf.float32, shape = (<span style="color: #a45bad;">None</span>, 1))

<span style="color: #7590db;">w1</span> = tf.Variable(tf.random_normal([2,3], stddev=1, seed=1))
<span style="color: #7590db;">w</span> = tf.Variable(tf.random_normal([3,3], stddev=1, seed=1))
<span style="color: #7590db;">w2</span> = tf.Variable(tf.random_normal([3,1], stddev=1, seed=1))

<span style="color: #7590db;">a</span> = tf.matmul(x,w1)
<span style="color: #7590db;">b</span> = tf.matmul(a,w)
<span style="color: #7590db;">y</span> = tf.matmul(b,w2)

<span style="color: #7590db;">loss</span> = tf.reduce_mean(tf.square(y-y_))
<span style="color: #7590db;">train_step</span> = tf.train.GradientDescentOptimizer(0.001).minimize(loss)

<span style="color: #4f97d7; font-weight: bold;">with</span> tf.Session() <span style="color: #4f97d7; font-weight: bold;">as</span> sess:
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">init_op</span> = tf.global_variables_initializer()
<span style="background-color: #292e34;"> </span>   sess.run(init_op)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"w1 is :"</span>, sess.run(w1))
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"w is :"</span>, sess.run(w))
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"w2 is :"</span>, sess.run(w2))

<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">steps</span>= 30000
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> i <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(steps):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">start</span> = (i*BATCH_SIZE) % 32
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">end</span> = start + BATCH_SIZE
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   sess.run(train_step, feed_dict={x:X[start:end], y_:Y[start:end]})
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">if</span> i % 5000 == 0:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">total_loss</span> = sess.run(loss, feed_dict={x:X, y_:Y})
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"After %d training steps, loss on all data is %g"</span> %(i,total_loss))
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"</span><span style="color: #a45bad;">\n</span><span style="color: #2d9574;">"</span>)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"w1 is :"</span>, sess.run(w1))
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"w is :"</span>, sess.run(w))
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"w2 is :"</span>, sess.run(w2))

</pre>
</div>
</div>
</div>

<div id="outline-container-org1c1a552" class="outline-4">
<h4 id="org1c1a552"><span class="section-number-4">9.4.5.</span> CNN train</h4>
<div class="outline-text-4" id="text-9-4-5">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">as</span> tf
<span style="color: #4f97d7; font-weight: bold;">from</span> tensorflow.examples.tutorials.mnist <span style="color: #4f97d7; font-weight: bold;">import</span> input_data

<span style="color: #7590db;">mnist</span>=input_data.read_data_sets(<span style="color: #2d9574;">"MNIST_data"</span>,one_hot = <span style="color: #a45bad;">True</span>)

<span style="color: #7590db;">batch_size</span> = 100
<span style="color: #7590db;">n_batch</span> = mnist.train.num_examples // batch_size

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#21021;&#22987;&#21270;&#26435;&#20540;</span>
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">weight_variable</span>(shape):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> tf.Variable(tf.truncated_normal(shape,stddev =0.01))

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#21021;&#22987;&#21270;&#20559;&#32622;</span>
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">bias_variable</span>(shape):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> tf.Variable(tf.constant(0.1,shape= shape))

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#23450;&#20041;&#21367;&#31215;&#23618;</span>
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">conv2d</span>(x,W):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> tf.nn.conv2d(x,W,strides=[1,1,1,1],padding=<span style="color: #2d9574;">"SAME"</span>) 

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#27744;&#21270;&#23618;&#23450;&#20041;</span>
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">max_pool_2x2</span>(x):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> tf.nn.max_pool(x,ksize =[1,2,2,1],strides=[1,2,2,1], padding = <span style="color: #2d9574;">"SAME"</span>)

<span style="color: #7590db;">x</span> = tf.placeholder(tf.float32,[<span style="color: #a45bad;">None</span>, 784])
<span style="color: #7590db;">y</span> = tf.placeholder(tf.float32,[<span style="color: #a45bad;">None</span>,10])

<span style="color: #7590db;">x_image</span> = tf.reshape(x,[-1,28,28,1])

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#21021;&#22987;&#21270;&#31532;&#19968;&#20010;&#21367;&#31215;&#23618;&#30340;&#26435;&#20540;&#21644;&#20559;&#32622;&#65292;&#36755;&#20837;&#20854;&#35201;&#27714;&#30340;&#24418;&#29366;</span>
<span style="color: #7590db;">W_convl</span> = weight_variable([5,5,1,32]) <span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">5x5&#30340;&#37319;&#26679;&#31383;&#21475;&#22823;&#23567;&#65292;&#65297;&#36890;&#36947;&#23545;&#40657;&#30333;&#65292;&#65299;&#36890;&#36947;&#23545;&#24425;&#33394;</span>
<span style="color: #7590db;">b_convl</span> = bias_variable([32])

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#29616;&#22312;&#21367;&#31215;</span>
<span style="color: #7590db;">h_conv1</span> = tf.nn.relu(conv2d(x_image,W_convl) +b_convl)
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#29616;&#22312;&#27744;&#21270;</span>
<span style="color: #7590db;">h_pool1</span> = max_pool_2x2(h_conv1) 


<span style="color: #7590db;">W_convl2</span> = weight_variable([5,5,32,64]) <span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">5x5&#30340;&#37319;&#26679;&#31383;&#21475;&#22823;&#23567;&#65292;&#65297;&#36890;&#36947;&#23545;&#40657;&#30333;&#65292;&#65299;&#36890;&#36947;&#23545;&#24425;&#33394;</span>
<span style="color: #7590db;">b_convl2</span> = bias_variable([64])

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#29616;&#22312;&#21367;&#31215;</span>
<span style="color: #7590db;">h_conv2</span> = tf.nn.relu(conv2d(h_pool1 ,W_convl2) +b_convl2)
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#29616;&#22312;&#27744;&#21270;</span>
<span style="color: #7590db;">h_pool2</span> = max_pool_2x2(h_conv2)

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#27744;&#21270;&#21518;&#23558;&#32467;&#26524;&#25153;&#24179;&#21270;&#22788;&#29702;&#65292;&#20197;&#20415;&#36755;&#20837;&#32593;&#32476;</span>
<span style="color: #7590db;">h_pool2_flat</span> = tf.reshape(h_pool2, [-1,7*7*64])

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#24314;&#31435;&#31532;&#19968;&#20010;&#31070;&#32463;&#32593;&#32476;&#30340;&#20840;&#36830;&#25509;&#23618;&#65292;&#21021;&#22987;&#21270;&#20854;&#26435;&#37325;&#21644;&#20559;&#32622;</span>
<span style="color: #7590db;">W_fcl</span> = weight_variable([7*7*64, 100])
<span style="color: #7590db;">b_fcl</span> = bias_variable([100])

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#31532;&#19968;&#23618;&#30340;&#35745;&#31639;</span>
<span style="color: #7590db;">h_fcl</span> = tf.nn.relu(tf.matmul(h_pool2_flat, W_fcl) + b_fcl)

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">dropout</span>
<span style="color: #7590db;">keep_prob</span> = tf.placeholder(tf.float32)
<span style="color: #7590db;">h_fcl_drop</span> = tf.nn.dropout(h_fcl, keep_prob)

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#24314;&#31435;&#31532;&#20108;&#20010;&#31070;&#32463;&#23618;</span>
<span style="color: #7590db;">W_fc2</span> = weight_variable([100,10])
<span style="color: #7590db;">b_fc2</span> = bias_variable([10])
<span style="color: #7590db;">prediction</span> = tf.nn.softmax(tf.matmul(h_fcl_drop, W_fc2)+b_fc2)

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#20132;&#21449;&#29109;</span>
<span style="color: #7590db;">cross_entropy</span> = tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits(labels = y, logits=prediction))
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#20248;&#21270;</span>
<span style="color: #7590db;">train_step</span> = tf.train.AdamOptimizer(1e-4).minimize(cross_entropy)

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#32467;&#26524;</span>
<span style="color: #7590db;">correct_prediction</span> = tf.equal(tf.argmax(prediction,1),tf.argmax(y,1))
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#20934;&#30830;&#29575;</span>
<span style="color: #7590db;">accuracy</span> = tf.reduce_mean(tf.cast(correct_prediction, tf.float32))

<span style="color: #4f97d7; font-weight: bold;">with</span> tf.Session() <span style="color: #4f97d7; font-weight: bold;">as</span> sess:
<span style="background-color: #292e34;"> </span>   sess.run(tf.global_variables_initializer())
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> epoch <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(21):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> batch <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(n_batch):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">batch_xs</span>, <span style="color: #7590db;">batch_ys</span> = mnist.train.next_batch(batch_size)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   sess.run(train_step, feed_dict={x:batch_xs, y:batch_ys, keep_prob:0.7})
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">acc</span>= sess.run(accuracy, feed_dict={x:mnist.test.images,y:mnist.test.labels, keep_prob:1.0})
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"&#22312;&#31532;"</span>+<span style="color: #4f97d7;">str</span>(epoch)+<span style="color: #2d9574;">"&#36718;&#65292;&#20934;&#30830;&#29575;&#20026;"</span>+<span style="color: #4f97d7;">str</span>(acc))

</pre>
</div>
</div>
</div>
<div id="outline-container-org3e321e1" class="outline-4">
<h4 id="org3e321e1"><span class="section-number-4">9.4.6.</span> classification</h4>
<div class="outline-text-4" id="text-9-4-6">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Youku video tutorial: http://i.youku.com/pythontutorial</span>

<span style="color: #9f8766;">"""</span>
<span style="color: #9f8766;">Please note, this code is only for python 3+. If you are using python 2+, please modify the code accordingly.</span>
<span style="color: #9f8766;">"""</span>
<span style="color: #4f97d7; font-weight: bold;">from</span> __future__ <span style="color: #4f97d7; font-weight: bold;">import</span> print_function
<span style="color: #4f97d7; font-weight: bold;">import</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">as</span> tf
<span style="color: #4f97d7; font-weight: bold;">from</span> tensorflow.examples.tutorials.mnist <span style="color: #4f97d7; font-weight: bold;">import</span> input_data
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">number 1 to 10 data</span>
<span style="color: #7590db;">mnist</span> = input_data.read_data_sets(<span style="color: #2d9574;">'MNIST_data'</span>, one_hot=<span style="color: #a45bad;">True</span>)

<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">add_layer</span>(inputs, in_size, out_size, activation_function=<span style="color: #a45bad;">None</span>,):
<span style="background-color: #292e34;"> </span>   <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">add one more layer and return the output of this layer</span>
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">Weights</span> = tf.Variable(tf.random_normal([in_size, out_size]))
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">biases</span> = tf.Variable(tf.zeros([1, out_size]) + 0.1,)
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">Wx_plus_b</span> = tf.matmul(inputs, Weights) + biases
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">if</span> activation_function <span style="color: #4f97d7; font-weight: bold;">is</span> <span style="color: #a45bad;">None</span>:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">outputs</span> = Wx_plus_b
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">else</span>:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">outputs</span> = activation_function(Wx_plus_b,)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> outputs

<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">compute_accuracy</span>(v_xs, v_ys):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">global</span> prediction
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">y_pre</span> = sess.run(prediction, feed_dict={xs: v_xs})
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">correct_prediction</span> = tf.equal(tf.argmax(y_pre,1), tf.argmax(v_ys,1))
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">accuracy</span> = tf.reduce_mean(tf.cast(correct_prediction, tf.float32))
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">result</span> = sess.run(accuracy, feed_dict={xs: v_xs, ys: v_ys})
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> result

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">define placeholder for inputs to network</span>
<span style="color: #7590db;">xs</span> = tf.placeholder(tf.float32, [<span style="color: #a45bad;">None</span>, 784]) <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">28x28</span>
<span style="color: #7590db;">ys</span> = tf.placeholder(tf.float32, [<span style="color: #a45bad;">None</span>, 10])

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">add output layer</span>
<span style="color: #7590db;">prediction</span> = add_layer(xs, 784, 10,  activation_function=tf.nn.softmax)

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">the error between prediction and real data</span>
<span style="color: #7590db;">cross_entropy</span> = tf.reduce_mean(-tf.reduce_sum(ys * tf.log(prediction),
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span> reduction_indices=[1]))       <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">loss</span>
<span style="color: #7590db;">train_step</span> = tf.train.GradientDescentOptimizer(0.5).minimize(cross_entropy)

<span style="color: #7590db;">sess</span> = tf.Session()
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">important step</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">tf.initialize_all_variables() no long valid from</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">2017-03-02 if using tensorflow &gt;= 0.12</span>
<span style="color: #4f97d7; font-weight: bold;">if</span> <span style="color: #4f97d7;">int</span>((tf.__version__).split(<span style="color: #2d9574;">'.'</span>)[1]) &lt; 12 <span style="color: #4f97d7; font-weight: bold;">and</span> <span style="color: #4f97d7;">int</span>((tf.__version__).split(<span style="color: #2d9574;">'.'</span>)[0]) &lt; 1:
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">init</span> = tf.initialize_all_variables()
<span style="color: #4f97d7; font-weight: bold;">else</span>:
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">init</span> = tf.global_variables_initializer()
sess.run(init)

<span style="color: #4f97d7; font-weight: bold;">for</span> i <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(1000):
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">batch_xs</span>, <span style="color: #7590db;">batch_ys</span> = mnist.train.next_batch(100)
<span style="background-color: #292e34;"> </span>   sess.run(train_step, feed_dict={xs: batch_xs, ys: batch_ys})
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">if</span> i % 50 == 0:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(compute_accuracy(
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   mnist.test.images, mnist.test.labels))


</pre>
</div>
</div>
</div>
<div id="outline-container-org255fa07" class="outline-4">
<h4 id="org255fa07"><span class="section-number-4">9.4.7.</span> optimizer varialbe (with error)</h4>
<div class="outline-text-4" id="text-9-4-7">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">View more python learning tutorial on my Youtube and Youku channel!!!</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Youtube video tutorial: https://www.youtube.com/channel/UCdyjiB5H8Pu7aDTNVXTTpcg</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Youku video tutorial: http://i.youku.com/pythontutorial</span>

<span style="color: #9f8766;">"""</span>
<span style="color: #9f8766;">Please note, this code is only for python 3+. If you are using python 2+, please modify the code accordingly.</span>
<span style="color: #9f8766;">"""</span>
<span style="color: #4f97d7; font-weight: bold;">from</span> __future__ <span style="color: #4f97d7; font-weight: bold;">import</span> print_function
<span style="color: #4f97d7; font-weight: bold;">import</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">as</span> tf
<span style="color: #4f97d7; font-weight: bold;">import</span> numpy <span style="color: #4f97d7; font-weight: bold;">as</span> np


<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">add_layer</span>(inputs, in_size, out_size, n_layer, activation_function=<span style="color: #a45bad;">None</span>):
<span style="background-color: #292e34;"> </span>   <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">add one more layer and return the output of this layer</span>
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">layer_name</span> = <span style="color: #2d9574;">'layer%s'</span> % n_layer
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">with</span> tf.name_scope(layer_name):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">with</span> tf.name_scope(<span style="color: #2d9574;">'weights'</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">Weights</span> = tf.Variable(tf.random_normal([in_size, out_size]), name=<span style="color: #2d9574;">'W'</span>)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   tf.summary.histogram(layer_name + <span style="color: #2d9574;">'/weights'</span>, Weights)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">with</span> tf.name_scope(<span style="color: #2d9574;">'biases'</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">biases</span> = tf.Variable(tf.zeros([1, out_size]) + 0.1, name=<span style="color: #2d9574;">'b'</span>)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   tf.summary.histogram(layer_name + <span style="color: #2d9574;">'/biases'</span>, biases)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">with</span> tf.name_scope(<span style="color: #2d9574;">'Wx_plus_b'</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">Wx_plus_b</span> = tf.add(tf.matmul(inputs, Weights), biases)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">if</span> activation_function <span style="color: #4f97d7; font-weight: bold;">is</span> <span style="color: #a45bad;">None</span>:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">outputs</span> = Wx_plus_b
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">else</span>:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">outputs</span> = activation_function(Wx_plus_b, )
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   tf.summary.histogram(layer_name + <span style="color: #2d9574;">'/outputs'</span>, outputs)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> outputs


<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Make up some real data</span>
<span style="color: #7590db;">x_data</span> = np.linspace(-1, 1, 300)[:, np.newaxis]
<span style="color: #7590db;">noise</span> = np.random.normal(0, 0.05, x_data.shape)
<span style="color: #7590db;">y_data</span> = np.square(x_data) - 0.5 + noise

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">define placeholder for inputs to network</span>
<span style="color: #4f97d7; font-weight: bold;">with</span> tf.name_scope(<span style="color: #2d9574;">'inputs'</span>):
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">xs</span> = tf.placeholder(tf.float32, [<span style="color: #a45bad;">None</span>, 1], name=<span style="color: #2d9574;">'x_input'</span>)
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">ys</span> = tf.placeholder(tf.float32, [<span style="color: #a45bad;">None</span>, 1], name=<span style="color: #2d9574;">'y_input'</span>)

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">add hidden layer</span>
<span style="color: #7590db;">l1</span> = add_layer(xs, 1, 10, n_layer=1, activation_function=tf.nn.relu)
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">add output layer</span>
<span style="color: #7590db;">prediction</span> = add_layer(l1, 10, 1, n_layer=2, activation_function=<span style="color: #a45bad;">None</span>)

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">the error between prediciton and real data</span>
<span style="color: #4f97d7; font-weight: bold;">with</span> tf.name_scope(<span style="color: #2d9574;">'loss'</span>):
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">loss</span> = tf.reduce_mean(tf.reduce_sum(tf.square(ys - prediction),
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   reduction_indices=[1]))
<span style="background-color: #292e34;"> </span>   tf.summary.scalar(<span style="color: #2d9574;">'loss'</span>, loss)

<span style="color: #4f97d7; font-weight: bold;">with</span> tf.name_scope(<span style="color: #2d9574;">'train'</span>):
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">train_step</span> = tf.train.GradientDescentOptimizer(0.1).minimize(loss)

<span style="color: #7590db;">sess</span> = tf.Session()
<span style="color: #7590db;">merged</span> = tf.summary.merge_all()

<span style="color: #7590db;">writer</span> = tf.summary.FileWriter(<span style="color: #2d9574;">"logs/"</span>, sess.graph)

<span style="color: #7590db;">init</span> = tf.global_variables_initializer()
sess.run(init)

<span style="color: #4f97d7; font-weight: bold;">for</span> i <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(1000):
<span style="background-color: #292e34;"> </span>   sess.run(train_step, feed_dict={xs: x_data, ys: y_data})
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">if</span> i % 50 == 0:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">result</span> = sess.run(merged,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span> feed_dict={xs: x_data, ys: y_data})
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   writer.add_summary(result, i)

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">direct to the local dir and run this in terminal:</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">$ tensorboard --logdir logs</span>


</pre>
</div>
</div>
</div>
<div id="outline-container-orga373b76" class="outline-4">
<h4 id="orga373b76"><span class="section-number-4">9.4.8.</span> dropout</h4>
<div class="outline-text-4" id="text-9-4-8">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">as</span> tf
<span style="color: #4f97d7; font-weight: bold;">import</span> numpy <span style="color: #4f97d7; font-weight: bold;">as</span> np
<span style="color: #4f97d7; font-weight: bold;">from</span> tensorflow.examples.tutorials.mnist <span style="color: #4f97d7; font-weight: bold;">import</span> input_data
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#36733;&#20837;&#25968;&#25454;&#38598;</span>
<span style="color: #7590db;">mnist</span>= input_data.read_data_sets(<span style="color: #2d9574;">'MNIST_data'</span>, one_hot = <span style="color: #a45bad;">True</span>)

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#35774;&#23450;&#27599;&#20010;&#25209;&#27425;&#30340;&#22823;&#23567;</span>
<span style="color: #7590db;">batch_size</span> = 100
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#35745;&#31639;&#24635;&#20849;&#30340;&#25209;&#27425;</span>
<span style="color: #7590db;">n_batch</span> = mnist.train.num_examples//batch_size

<span style="color: #7590db;">x</span> = tf.placeholder(tf.float32,[<span style="color: #a45bad;">None</span>,784])
<span style="color: #7590db;">y</span> = tf.placeholder(tf.float32,[<span style="color: #a45bad;">None</span>,10])
<span style="color: #7590db;">keep_prob</span> = tf.placeholder(tf.float32)
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#26500;&#24314;&#31070;&#32463;&#32593;&#32476;</span>
<span style="color: #7590db;">W</span> = tf.Variable(tf.truncated_normal([784,2000], stddev = 0.1))
<span style="color: #7590db;">B</span> = tf.Variable(tf.zeros([2000])+0.1)
<span style="color: #7590db;">p1</span> = tf.nn.softmax(tf.matmul(x,W)+B)
<span style="color: #7590db;">p1_dropout</span> = tf.nn.dropout(p1,keep_prob)

<span style="color: #7590db;">W1</span> = tf.Variable(tf.truncated_normal([2000,2000]))
<span style="color: #7590db;">B1</span> = tf.Variable(tf.zeros([2000])+0.1)
<span style="color: #7590db;">p2</span> = tf.nn.softmax(tf.matmul(p1_dropout,W1)+B1)
<span style="color: #7590db;">p2_dropout</span> = tf.nn.dropout(p2,keep_prob)

<span style="color: #7590db;">W2</span> = tf.Variable(tf.truncated_normal([2000,10]))
<span style="color: #7590db;">B2</span> = tf.Variable(tf.zeros([10])+0.1)
<span style="color: #7590db;">prediction</span> = tf.nn.softmax(tf.matmul(p2_dropout,W2)+B2)

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#23450;&#20041;&#20108;&#27425;&#20195;&#20215;&#20989;&#25968;</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">loss = tf.reduce_mean(tf.square(y-prediction))</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#37325;&#26032;&#23450;&#20041;&#23545;&#25968;(&#20132;&#21449;&#29109;)</span>
<span style="color: #7590db;">loss</span> =tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits(labels=y, logits=prediction))
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#20351;&#29992;&#26799;&#24230;&#19979;&#38477;&#27861;</span>
<span style="color: #7590db;">train_step</span> = tf.train.GradientDescentOptimizer(0.2).minimize(loss)

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#21021;&#22987;&#21270;</span>
<span style="color: #7590db;">init</span> = tf.global_variables_initializer()

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#27979;&#35797;&#20934;&#30830;&#29575;</span>
<span style="color: #7590db;">correct_prediction</span> = tf.equal(tf.argmax(y,1), tf.argmax(prediction,1))
<span style="color: #7590db;">accuracy</span> = tf.reduce_mean(tf.cast(correct_prediction,tf.float32))

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#35757;&#32451;&#24320;&#22987;</span>
<span style="color: #4f97d7; font-weight: bold;">with</span> tf.Session() <span style="color: #4f97d7; font-weight: bold;">as</span> sess:
<span style="background-color: #292e34;"> </span>   sess.run(init)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> epoch <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(21):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> batch <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(n_batch):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">batch_xs</span>, <span style="color: #7590db;">batch_ys</span> = mnist.train.next_batch(batch_size)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   sess.run(train_step, feed_dict={x:batch_xs, y:batch_ys,keep_prob:1.0})

<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">test_acc</span> = sess.run(accuracy,feed_dict={x:mnist.test.images, y:mnist.test.labels, keep_prob:1.0})
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">train_acc</span> = sess.run(accuracy,feed_dict={x:mnist.train.images, y:mnist.train.labels, keep_prob:1.0})
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"&#20934;&#30830;&#29575;&#20026;:&#12288;&#22312;"</span>+<span style="color: #4f97d7;">str</span>(epoch)+<span style="color: #2d9574;">"&#22238;,"</span>+<span style="color: #4f97d7;">str</span>(test_acc)+<span style="color: #2d9574;">", &#20294;&#26159;&#22312;&#35757;&#32451;&#38598;&#20013;&#20026;"</span>+<span style="color: #4f97d7;">str</span>(train_acc))


</pre>
</div>
</div>
</div>
<div id="outline-container-orgac284af" class="outline-4">
<h4 id="orgac284af"><span class="section-number-4">9.4.9.</span> number identification</h4>
<div class="outline-text-4" id="text-9-4-9">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">as</span> tf
<span style="color: #4f97d7; font-weight: bold;">from</span> tensorflow.examples.tutorials.mnist <span style="color: #4f97d7; font-weight: bold;">import</span> input_data
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#36733;&#20837;&#25968;&#25454;&#38598;</span>
<span style="color: #7590db;">mnist</span>= input_data.read_data_sets(<span style="color: #2d9574;">'MNIST_data'</span>, one_hot = <span style="color: #a45bad;">True</span>)

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#35774;&#23450;&#27599;&#20010;&#25209;&#27425;&#30340;&#22823;&#23567;</span>
<span style="color: #7590db;">batch_size</span> = 100
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#35745;&#31639;&#24635;&#20849;&#30340;&#25209;&#27425;</span>
<span style="color: #7590db;">n_batch</span> = mnist.train.num_examples // batch_size

<span style="color: #7590db;">x</span> = tf.placeholder(tf.float32,[<span style="color: #a45bad;">None</span>,784])
<span style="color: #7590db;">y</span> = tf.placeholder(tf.float32,[<span style="color: #a45bad;">None</span>,10])
<span style="color: #7590db;">keep_prob</span> = tf.placeholder(tf.float32)
<span style="color: #7590db;">lr</span>= tf.Variable(0.001,dtype=tf.float32)
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#26500;&#24314;&#31070;&#32463;&#32593;&#32476;</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">W = tf.Variable(tf.truncated_normal([784,10]))</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">B = tf.Variable(tf.zeros([10])+0.1)</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">prediction = tf.nn.softmax(tf.matmul(x,W)+B)</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">W = tf.Variable(tf.zeros([784,10]))</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">B = tf.Variable(tf.zeros([10]))</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">prediction = tf.nn.softmax(tf.matmul(x,W)+B)</span>

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#26500;&#24314;&#31070;&#32463;&#32593;&#32476;</span>
<span style="color: #7590db;">W</span> = tf.Variable(tf.truncated_normal([784,500],stddev =0.1))
<span style="color: #7590db;">B</span> = tf.Variable(tf.zeros([500])+0.1)
<span style="color: #7590db;">p1</span> = tf.nn.tanh(tf.matmul(x,W)+B)
<span style="color: #7590db;">p1_dropout</span> = tf.nn.dropout(p1,keep_prob)

<span style="color: #7590db;">W1</span> = tf.Variable(tf.truncated_normal([500,200],stddev=0.1))
<span style="color: #7590db;">B1</span> = tf.Variable(tf.zeros([200])+0.1)
<span style="color: #7590db;">p2</span> = tf.nn.tanh(tf.matmul(p1_dropout,W1)+B1)
<span style="color: #7590db;">p2_dropout</span> = tf.nn.dropout(p2,keep_prob)

<span style="color: #7590db;">W2</span> = tf.Variable(tf.truncated_normal([200,10],stddev = 0.1))
<span style="color: #7590db;">B2</span> = tf.Variable(tf.zeros([10])+0.1)
<span style="color: #7590db;">prediction</span> = tf.nn.softmax(tf.matmul(p2_dropout,W2)+B2)



<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#23450;&#20041;&#20108;&#27425;&#20195;&#20215;&#20989;&#25968;</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">loss = tf.reduce_mean(tf.square(y-prediction))</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#37325;&#26032;&#23450;&#20041;&#23545;&#25968;(&#20132;&#21449;&#29109;)</span>
<span style="color: #7590db;">loss</span> =tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits(labels=y,logits=prediction))
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#20351;&#29992;&#26799;&#24230;&#19979;&#38477;&#27861;</span>
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">train_step = tf.train.GradientDescentOptimizer(0.2).minimize(loss)</span>
<span style="color: #7590db;">train_step</span> = tf.train.AdamOptimizer(lr).minimize(loss)
<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#21021;&#22987;&#21270;</span>
<span style="color: #7590db;">init</span> = tf.global_variables_initializer()

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#27979;&#35797;&#20934;&#30830;&#29575;</span>
<span style="color: #7590db;">correct_prediction</span> = tf.equal(tf.argmax(y,1), tf.argmax(prediction,1))
<span style="color: #7590db;">accuracy</span> = tf.reduce_mean(tf.cast(correct_prediction,tf.float32))

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">#&#35757;&#32451;&#24320;&#22987;</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">with tf.Session() as sess:</span>
<span style="color: #2aa1ae; background-color: #292e34;">#     </span><span style="color: #2aa1ae; background-color: #292e34;">sess.run(init)</span>
<span style="color: #2aa1ae; background-color: #292e34;">#     </span><span style="color: #2aa1ae; background-color: #292e34;">for epoch in range(20):</span>
<span style="color: #2aa1ae; background-color: #292e34;">#         </span><span style="color: #2aa1ae; background-color: #292e34;">for batch in range(n_batch):</span>
<span style="color: #2aa1ae; background-color: #292e34;">#             </span><span style="color: #2aa1ae; background-color: #292e34;">batch_xs, batch_ys = mnist.train.next_batch(batch_size)</span>
<span style="color: #2aa1ae; background-color: #292e34;">#             </span><span style="color: #2aa1ae; background-color: #292e34;">sess.run(train_step, feed_dict={x:batch_xs, y:batch_ys})</span>
<span style="color: #2aa1ae; background-color: #292e34;">#         </span><span style="color: #2aa1ae; background-color: #292e34;">acc = sess.run(accuracy,feed_dict={x:mnist.test.images, y:mnist.test.labels})</span>
<span style="color: #2aa1ae; background-color: #292e34;">#         </span><span style="color: #2aa1ae; background-color: #292e34;">print("&#20934;&#30830;&#29575;&#20026;:&#12288;&#22312;"+str(epoch)+"&#22238;,"+str(acc))</span>


<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#35757;&#32451;&#24320;&#22987;</span>
<span style="color: #4f97d7; font-weight: bold;">with</span> tf.Session() <span style="color: #4f97d7; font-weight: bold;">as</span> sess:
<span style="background-color: #292e34;"> </span>   sess.run(init)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> epoch <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(41):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   sess.run(tf.assign(lr,0.001*(0.95**epoch)))
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> batch <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(n_batch):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">batch_xs</span>, <span style="color: #7590db;">batch_ys</span> = mnist.train.next_batch(batch_size)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   sess.run(train_step, feed_dict={x:batch_xs, y:batch_ys,keep_prob:1.0})
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">learing_rate</span> = sess.run(lr)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">test_acc</span> = sess.run(accuracy,feed_dict={x:mnist.test.images,
y:mnist.test.labels, keep_prob:1.0})
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">train_acc</span> = sess.run(accuracy,feed_dict={x:mnist.train.images,
y:mnist.train.labels, keep_prob:1.0})
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"&#20934;&#30830;&#29575;&#20026;:&#12288;&#22312;"</span>+<span style="color: #4f97d7;">str</span>(epoch)+<span style="color: #2d9574;">"&#22238;,"</span>+<span style="color: #4f97d7;">str</span>(test_acc)+<span style="color: #2d9574;">",&#20294;&#26159;&#22312;&#35757;&#32451;&#38598;&#20013;&#20026;"</span>+<span style="color: #4f97d7;">str</span>(train_acc)+<span style="color: #2d9574;">"&#21516;&#26102;&#23398;&#20064;&#29575;&#20026;"</span>+<span style="color: #4f97d7;">str</span>(learing_rate))


</pre>
</div>
</div>
</div>
<div id="outline-container-org7b4d031" class="outline-4">
<h4 id="org7b4d031"><span class="section-number-4">9.4.10.</span> with L regularizer</h4>
<div class="outline-text-4" id="text-9-4-10">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #4f97d7; font-weight: bold;">import</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">as</span> tf
<span style="color: #4f97d7; font-weight: bold;">import</span> numpy <span style="color: #4f97d7; font-weight: bold;">as</span> np
<span style="color: #4f97d7; font-weight: bold;">import</span> matplotlib.pyplot <span style="color: #4f97d7; font-weight: bold;">as</span> plt
<span style="color: #7590db;">BATCH_SIZE</span> = 30
<span style="color: #7590db;">seed</span> = 2
<span style="color: #7590db;">rdm</span> = np.random.RandomState(seed)
<span style="color: #7590db;">X</span> = rdm.randn(300,2)
<span style="color: #7590db;">Y_</span> = [<span style="color: #4f97d7;">int</span>(x0*x0 + x1*x1 &lt; 2) <span style="color: #4f97d7; font-weight: bold;">for</span> (x0,x1) <span style="color: #4f97d7; font-weight: bold;">in</span> X]
<span style="color: #7590db;">Y_c</span> = [[<span style="color: #2d9574;">'red'</span> <span style="color: #4f97d7; font-weight: bold;">if</span> y <span style="color: #4f97d7; font-weight: bold;">else</span> <span style="color: #2d9574;">'blue'</span>] <span style="color: #4f97d7; font-weight: bold;">for</span> y <span style="color: #4f97d7; font-weight: bold;">in</span> Y_]
<span style="color: #7590db;">X</span> = np.vstack(X).reshape(-1,2)
<span style="color: #7590db;">Y_</span> = np.vstack(Y_).reshape(-1,1)
<span style="color: #4f97d7;">print</span>(X)
<span style="color: #4f97d7;">print</span>(Y_)
<span style="color: #4f97d7;">print</span>(Y_c)
plt.scatter(X[:,0],X[:,1], c = np.squeeze(Y_c))
plt.show()

<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">get_weight</span>(shape, regularizer):
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">w</span> = tf.Variable(tf.random_normal(shape), dtype = tf.float32)
<span style="background-color: #292e34;"> </span>   tf.add_to_collection(<span style="color: #2d9574;">'losses'</span>, tf.contrib.layers.l2_regularizer(regularizer)(w))
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> w
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">get_bias</span>(shape):
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">b</span> = tf.Variable(tf.constant(0.01, shape=shape))
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> b
<span style="color: #7590db;">x</span> = tf.placeholder(tf.float32, shape=(<span style="color: #a45bad;">None</span>, 2))
<span style="color: #7590db;">y_</span> = tf.placeholder(tf.float32, shape = (<span style="color: #a45bad;">None</span> , 1))
<span style="color: #7590db;">w1</span> = get_weight([2,11], 0.01)
<span style="color: #7590db;">b1</span> = get_bias([11])
<span style="color: #7590db;">y1</span> = tf.nn.relu(tf.matmul(x,w1)+b1)
<span style="color: #7590db;">w2</span> = get_weight([11,1],0.01)
<span style="color: #7590db;">b2</span> = get_bias([1])
<span style="color: #7590db;">y</span> = tf.matmul(y1,w2)+b2

<span style="color: #7590db;">loss_mse</span> = tf.reduce_mean(tf.square(y-y_))
<span style="color: #7590db;">loss_total</span> = loss_mse + tf.add_n(tf.get_collection(<span style="color: #2d9574;">'losses'</span>))


<span style="color: #7590db;">train_step_l</span> = tf.train.AdamOptimizer(0.0001).minimize(loss_total)
<span style="color: #4f97d7; font-weight: bold;">with</span> tf.Session() <span style="color: #4f97d7; font-weight: bold;">as</span> sess:
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">init_op</span> = tf.global_variables_initializer()
<span style="background-color: #292e34;"> </span>   sess.run(init_op)
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">STEPS</span> = 40000
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> i <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(STEPS):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">start</span> = (i*BATCH_SIZE) % 300
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">end</span> = start + BATCH_SIZE
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   sess.run(train_step_l, feed_dict = {x:X[start:end], y_:Y_[start:end]})
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">if</span> i % 2000 == 0:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">loss_total_v</span> = sess.run(loss_total, feed_dict={x:X,y_:Y_})
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'After %d steps, loss is: %f'</span> %(i, loss_total_v))
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">xx</span>, <span style="color: #7590db;">yy</span> = np.mgrid[-3:3:0.01, -3:3:0.01]
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">grid</span> = np.c_[xx.ravel(), yy.ravel()]
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">probs</span> = sess.run(y, feed_dict={x:grid})
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">probs</span> = probs.reshape(xx.shape)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span> (<span style="color: #2d9574;">'w1 is </span><span style="color: #a45bad;">\n</span><span style="color: #2d9574;">:'</span>, sess.run(w1))
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span> (<span style="color: #2d9574;">'b1 is </span><span style="color: #a45bad;">\n</span><span style="color: #2d9574;">:'</span>, sess.run(b1))
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span> (<span style="color: #2d9574;">'w2 is </span><span style="color: #a45bad;">\n</span><span style="color: #2d9574;">:'</span>, sess.run(w2))
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span> (<span style="color: #2d9574;">'b2 is </span><span style="color: #a45bad;">\n</span><span style="color: #2d9574;">:'</span>, sess.run(b2))
plt.scatter(X[:,0], X[:,1], c = np.squeeze(Y_c))
plt.contour(xx, yy, probs, levels = [.5])
plt.show()


<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'loss_mse_v * loss_total_v is :'</span>, loss_mse_v*loss_total_v)


</pre>
</div>
</div>
</div>
<div id="outline-container-org0ae5eea" class="outline-4">
<h4 id="org0ae5eea"><span class="section-number-4">9.4.11.</span> without L regularizer</h4>
<div class="outline-text-4" id="text-9-4-11">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">as</span> tf
<span style="color: #4f97d7; font-weight: bold;">import</span> numpy <span style="color: #4f97d7; font-weight: bold;">as</span> np
<span style="color: #4f97d7; font-weight: bold;">import</span> matplotlib.pyplot <span style="color: #4f97d7; font-weight: bold;">as</span> plt
<span style="color: #7590db;">BATCH_SIZE</span> = 30
<span style="color: #7590db;">seed</span> = 2
<span style="color: #7590db;">rdm</span> = np.random.RandomState(seed)
<span style="color: #7590db;">X</span> = rdm.randn(300,2)
<span style="color: #7590db;">Y_</span> = [<span style="color: #4f97d7;">int</span>(x0*x0 + x1*x1 &lt; 2) <span style="color: #4f97d7; font-weight: bold;">for</span> (x0,x1) <span style="color: #4f97d7; font-weight: bold;">in</span> X]
<span style="color: #7590db;">Y_c</span> = [[<span style="color: #2d9574;">'red'</span> <span style="color: #4f97d7; font-weight: bold;">if</span> y <span style="color: #4f97d7; font-weight: bold;">else</span> <span style="color: #2d9574;">'blue'</span>] <span style="color: #4f97d7; font-weight: bold;">for</span> y <span style="color: #4f97d7; font-weight: bold;">in</span> Y_]
<span style="color: #7590db;">X</span> = np.vstack(X).reshape(-1,2)
<span style="color: #7590db;">Y_</span> = np.vstack(Y_).reshape(-1,1)
<span style="color: #4f97d7;">print</span>(X)
<span style="color: #4f97d7;">print</span>(Y_)
<span style="color: #4f97d7;">print</span>(Y_c)
plt.scatter(X[:,0],X[:,1], c = np.squeeze(Y_c))
plt.show()

<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">get_weight</span>(shape, regularizer):
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">w</span> = tf.Variable(tf.random_normal(shape), dtype = tf.float32)
<span style="background-color: #292e34;"> </span>   tf.add_to_collection(<span style="color: #2d9574;">'losses'</span>, tf.contrib.layers.l2_regularizer(regularizer)(w))
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> w
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">get_bias</span>(shape):
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">b</span> = tf.Variable(tf.constant(0.01, shape=shape))
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> b
<span style="color: #7590db;">x</span> = tf.placeholder(tf.float32, shape=(<span style="color: #a45bad;">None</span>, 2))
<span style="color: #7590db;">y_</span> = tf.placeholder(tf.float32, shape = (<span style="color: #a45bad;">None</span> , 1))
<span style="color: #7590db;">w1</span> = get_weight([2,11], 0.01)
<span style="color: #7590db;">b1</span> = get_bias([11])
<span style="color: #7590db;">y1</span> = tf.nn.relu(tf.matmul(x,w1)+b1)
<span style="color: #7590db;">w2</span> = get_weight([11,1],0.01)
<span style="color: #7590db;">b2</span> = get_bias([1])
<span style="color: #7590db;">y</span> = tf.matmul(y1,w2)+b2

<span style="color: #7590db;">loss_mse</span> = tf.reduce_mean(tf.square(y-y_))
<span style="color: #7590db;">loss_total</span> = loss_mse + tf.add_n(tf.get_collection(<span style="color: #2d9574;">'losses'</span>))

<span style="color: #7590db;">train_step</span> = tf.train.AdamOptimizer(0.0001).minimize(loss_mse)
<span style="color: #4f97d7; font-weight: bold;">with</span> tf.Session() <span style="color: #4f97d7; font-weight: bold;">as</span> sess:
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">init_op</span> = tf.global_variables_initializer()
<span style="background-color: #292e34;"> </span>   sess.run(init_op)
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">STEPS</span> = 40000
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> i <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(STEPS):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">start</span> = (i*BATCH_SIZE) % 300
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">end</span> = start + BATCH_SIZE
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   sess.run(train_step, feed_dict = {x:X[start:end], y_:Y_[start:end]})
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">if</span> i % 2000 == 0:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">loss_mse_v</span> = sess.run(loss_mse, feed_dict={x:X,y_:Y_})
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'After %d steps, loss is: %f'</span> %(i, loss_mse_v))
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">xx</span>, <span style="color: #7590db;">yy</span> = np.mgrid[-3:3:0.01, -3:3:0.01]
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">grid</span> = np.c_[xx.ravel(), yy.ravel()]
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">probs</span> = sess.run(y, feed_dict={x:grid})
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">probs</span> = probs.reshape(xx.shape)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span> (<span style="color: #2d9574;">'w1 is </span><span style="color: #a45bad;">\n</span><span style="color: #2d9574;">:'</span>, sess.run(w1))
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span> (<span style="color: #2d9574;">'b1 is </span><span style="color: #a45bad;">\n</span><span style="color: #2d9574;">:'</span>, sess.run(b1))
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span> (<span style="color: #2d9574;">'w2 is </span><span style="color: #a45bad;">\n</span><span style="color: #2d9574;">:'</span>, sess.run(w2))
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span> (<span style="color: #2d9574;">'b2 is </span><span style="color: #a45bad;">\n</span><span style="color: #2d9574;">:'</span>, sess.run(b2))
plt.scatter(X[:,0], X[:,1], c = np.squeeze(Y_c))
plt.contour(xx, yy, probs, levels = [.5])
plt.show()


</pre>
</div>
</div>
</div>
<div id="outline-container-orgd8d660d" class="outline-4">
<h4 id="orgd8d660d"><span class="section-number-4">9.4.12.</span> exponen decay with L regularizer(this has error)</h4>
<div class="outline-text-4" id="text-9-4-12">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> numpy <span style="color: #4f97d7; font-weight: bold;">as</span> np
<span style="color: #4f97d7; font-weight: bold;">import</span> matplotlib.pyplot <span style="color: #4f97d7; font-weight: bold;">as</span> plt


<span style="color: #4f97d7; font-weight: bold;">try</span>:
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">import</span> opt4_8_generateds
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">import</span> opt4_8_forward
<span style="color: #4f97d7; font-weight: bold;">except</span>:
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">import</span> pip 
<span style="background-color: #292e34;"> </span>   pip.main([<span style="color: #2d9574;">'install'</span>,<span style="color: #2d9574;">'opt4_8_forward'</span>])
<span style="background-color: #292e34;"> </span>   pip.main([<span style="color: #2d9574;">'install'</span>,<span style="color: #2d9574;">'opt4_8_generateds'</span>])
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">import</span> opt4_8_generateds
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">import</span> opt4_8_forward



<span style="color: #7590db;">STEPS</span> = 40000
<span style="color: #7590db;">BATCH_SIZE</span> = 30
<span style="color: #7590db;">LEARNING_RATE_BASE</span> = 0.001
<span style="color: #7590db;">LEARNING_RATE_DECAY</span> = 0.999
<span style="color: #7590db;">REGULARIZER</span> = 0.01

<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">backward</span>():
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">x</span> = tf.placeholder(tf.float32, shape = (<span style="color: #a45bad;">None</span>,2))
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">y_</span> = tf.placeholder(tf.float32, shape = (<span style="color: #a45bad;">None</span>,1))

<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">x</span> , <span style="color: #7590db;">Y_</span>, <span style="color: #7590db;">Y_c</span> = opt4_8_generateds.generateds()
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">y</span> = opt4_8_forward.forward(x,REGULARIZER)

<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">global_steps</span> = tf.Variable(0, trainable= <span style="color: #a45bad;">False</span>)
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">learning_rate</span> = tf.train.exponential_decay(
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   LEARNING_RATE_BASE,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   global_steps,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   300/BATCH_SIZE,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   LEARNING_RATE_DECAY,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   staircase = <span style="color: #a45bad;">True</span>)
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">loss_mse</span> = tf.reduce_mean(tf.square(y-y_))
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">loss_total</span> = loss_mse + tf.add_n(tf.get_collection(<span style="color: #2d9574;">'losses'</span>))

<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">train_step</span> = tf.train.AdamOptimizer(learning_rate).minimizer(loss_total)

<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">with</span> tf.Session() <span style="color: #4f97d7; font-weight: bold;">as</span> sess:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">init_op</span> = tf.global_variables_initializer()
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   sess.run(init_op)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> i <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(STEPS):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">start</span> = (i*BATCH_SIZE) % 300
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">end</span> = start + BATCH_SIZE
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   sess.run(train_step, feed_dict = {x:X[start:end], y_:Y_[start:end]})
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">if</span> i % 2000 == 0:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">loss_v</span> = sess.run(loss_total, feed_dict={x:X,y_:Y_})
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'After %d steps, loss is: %f'</span> %(i, loss_v))
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">xx</span>, <span style="color: #7590db;">yy</span> = np.mgrid[-3:3:0.01, -3:3:0.01]
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">grid</span> = np.c_[xx.ravel(), yy.ravel()]
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">probs</span> = sess.run(y, feed_dict={x:grid})
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">probs</span> = probs.reshape(xx.shape)

<span style="background-color: #292e34;"> </span>   plt.scatter(X[:,0], X[:,1], c = np.squeeze(Y_c))
<span style="background-color: #292e34;"> </span>   plt.contour(xx, yy, probs, levels = [.5])
<span style="background-color: #292e34;"> </span>   plt.show()

<span style="color: #4f97d7; font-weight: bold;">if</span> <span style="color: #4f97d7;">__name__</span> == <span style="color: #2d9574;">'__main__'</span>:
<span style="background-color: #292e34;"> </span>   backward()


</pre>
</div>
</div>
</div>
<div id="outline-container-org600a8b8" class="outline-4">
<h4 id="org600a8b8"><span class="section-number-4">9.4.13.</span> read date for variables</h4>
<div class="outline-text-4" id="text-9-4-13">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">from</span> tensorflow.examples.tutorials.mnist <span style="color: #4f97d7; font-weight: bold;">import</span> input_data
<span style="color: #7590db;">mnist</span> = input_data.read_data_sets(<span style="color: #2d9574;">'./data'</span>, one_hot = <span style="color: #a45bad;">True</span>)

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">print(mnist.train.labels[0])</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">print(mnist.train.images[0])</span>

<span style="color: #7590db;">BATCH_SIZE</span> = 200
<span style="color: #7590db;">xs</span>, <span style="color: #7590db;">ys</span> = mnist.train.next_batch(BATCH_SIZE)
<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"xs shape :"</span>, xs.shape)
<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"ys shape :"</span>, ys.shape)


</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org6de7c97" class="outline-3">
<h3 id="org6de7c97"><span class="section-number-3">9.5.</span> keras</h3>
<div class="outline-text-3" id="text-9-5">
</div>
<div id="outline-container-org7342ee3" class="outline-4">
<h4 id="org7342ee3"><span class="section-number-4">9.5.1.</span> classification</h4>
<div class="outline-text-4" id="text-9-5-1">
<div class="org-src-container">
<pre class="src src-python">

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">please note, all tutorial code are running under python3.5.</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">If you use the version like python2.7, please modify the code accordingly</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">5 - Classifier example</span>

<span style="color: #4f97d7; font-weight: bold;">import</span> numpy <span style="color: #4f97d7; font-weight: bold;">as</span> np
np.random.seed(1337)  <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">for reproducibility</span>
<span style="color: #4f97d7; font-weight: bold;">from</span> keras.datasets <span style="color: #4f97d7; font-weight: bold;">import</span> mnist
<span style="color: #4f97d7; font-weight: bold;">from</span> keras.utils <span style="color: #4f97d7; font-weight: bold;">import</span> np_utils
<span style="color: #4f97d7; font-weight: bold;">from</span> keras.models <span style="color: #4f97d7; font-weight: bold;">import</span> Sequential
<span style="color: #4f97d7; font-weight: bold;">from</span> keras.layers <span style="color: #4f97d7; font-weight: bold;">import</span> Dense, Activation
<span style="color: #4f97d7; font-weight: bold;">from</span> keras.optimizers <span style="color: #4f97d7; font-weight: bold;">import</span> RMSprop

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">download the mnist to the path '~/.keras/datasets/' if it is the first time to be called</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">X shape (60,000 28x28), y shape (10,000, )</span>
(X_train, y_train), (<span style="color: #7590db;">X_test</span>, <span style="color: #7590db;">y_test</span>) = mnist.load_data()

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">data pre-processing</span>
<span style="color: #7590db;">X_train</span> = X_train.reshape(X_train.shape[0], -1) / 255.   <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">normalize</span>
<span style="color: #7590db;">X_test</span> = X_test.reshape(X_test.shape[0], -1) / 255.      <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">normalize</span>
<span style="color: #7590db;">y_train</span> = np_utils.to_categorical(y_train, num_classes=10)
<span style="color: #7590db;">y_test</span> = np_utils.to_categorical(y_test, num_classes=10)

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Another way to build your neural net</span>
<span style="color: #7590db;">model</span> = Sequential([
<span style="background-color: #292e34;"> </span>   Dense(32, input_dim=784),
<span style="background-color: #292e34;"> </span>   Activation(<span style="color: #2d9574;">'relu'</span>),
<span style="background-color: #292e34;"> </span>   Dense(10),
<span style="background-color: #292e34;"> </span>   Activation(<span style="color: #2d9574;">'softmax'</span>),
])

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Another way to define your optimizer</span>
<span style="color: #7590db;">rmsprop</span> = RMSprop(lr=0.001, rho=0.9, epsilon=1e-08, decay=0.0)

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">We add metrics to get more results you want to see</span>
model.<span style="color: #4f97d7;">compile</span>(optimizer=rmsprop,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span> loss=<span style="color: #2d9574;">'categorical_crossentropy'</span>,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span> metrics=[<span style="color: #2d9574;">'accuracy'</span>])

<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'Training ------------'</span>)
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Another way to train the model</span>
model.fit(X_train, y_train, epochs=2, batch_size=32)

<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'</span><span style="color: #a45bad;">\n</span><span style="color: #2d9574;">Testing ------------'</span>)
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Evaluate the model with the metrics we defined earlier</span>
<span style="color: #7590db;">loss</span>, <span style="color: #7590db;">accuracy</span> = model.evaluate(X_test, y_test)

<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'test loss: '</span>, loss)
<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'test accuracy: '</span>, accuracy)

</pre>
</div>
</div>
</div>
<div id="outline-container-orgf415757" class="outline-4">
<h4 id="orgf415757"><span class="section-number-4">9.5.2.</span> regression</h4>
<div class="outline-text-4" id="text-9-5-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;"># please note, all tutorial code are running under python3.5.</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;"># If you use the version like python2.7, please modify the code accordingly</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;"># 4 - Regressor example</span>

<span style="color: #4f97d7; font-weight: bold;">import</span> numpy <span style="color: #4f97d7; font-weight: bold;">as</span> np
np.random.seed(1337)  <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">for reproducibility</span>
<span style="color: #4f97d7; font-weight: bold;">from</span> keras.models <span style="color: #4f97d7; font-weight: bold;">import</span> Sequential
<span style="color: #4f97d7; font-weight: bold;">from</span> keras.layers <span style="color: #4f97d7; font-weight: bold;">import</span> Dense
<span style="color: #4f97d7; font-weight: bold;">import</span> matplotlib.pyplot <span style="color: #4f97d7; font-weight: bold;">as</span> plt

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">create some data</span>
<span style="color: #7590db;">X</span> = np.linspace(-1, 1, 200)
np.random.shuffle(X)    <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">randomize the data</span>
<span style="color: #7590db;">Y</span> = 0.5 * X + 2 + np.random.normal(0, 0.05, (200 ))
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">plot data</span>
plt.scatter(X, Y)
plt.show()

<span style="color: #7590db;">X_train</span>, <span style="color: #7590db;">Y_train</span> = X[:160], Y[:160]     <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">first 160 data points</span>
<span style="color: #7590db;">X_test</span>, <span style="color: #7590db;">Y_test</span> = X[160:], Y[160:]       <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">last 40 data points</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">build a neural network from the 1st layer to the last layer</span>
<span style="color: #7590db;">model</span> = Sequential()

model.add(Dense(units=1, input_dim=1)) 

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">choose loss function and optimizing method</span>
model.<span style="color: #4f97d7;">compile</span>(loss=<span style="color: #2d9574;">'mse'</span>, optimizer=<span style="color: #2d9574;">'sgd'</span>)

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">training</span>
<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'Training -----------'</span>)
<span style="color: #4f97d7; font-weight: bold;">for</span> step <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(301):
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">cost</span> = model.train_on_batch(X_train, Y_train)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">if</span> step % 100 == 0:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'train cost: '</span>, cost)

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">test</span>
<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'</span><span style="color: #a45bad;">\n</span><span style="color: #2d9574;">Testing ------------'</span>)
<span style="color: #7590db;">cost</span> = model.evaluate(X_test, Y_test, batch_size=40)
<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'test cost:'</span>, cost)
<span style="color: #7590db;">W</span>, <span style="color: #7590db;">b</span> = model.layers[0].get_weights()
<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'Weights='</span>, W, <span style="color: #2d9574;">'</span><span style="color: #a45bad;">\n</span><span style="color: #2d9574;">biases='</span>, b)

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">plotting the prediction</span>
<span style="color: #7590db;">Y_pred</span> = model.predict(X_test)
plt.scatter(X_test, Y_test)
plt.plot(X_test, Y_pred)
plt.show()
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org2d2e91e" class="outline-3">
<h3 id="org2d2e91e"><span class="section-number-3">9.6.</span> sklearn</h3>
<div class="outline-text-3" id="text-9-6">
</div>
<div id="outline-container-org4d00eb9" class="outline-4">
<h4 id="org4d00eb9"><span class="section-number-4">9.6.1.</span> decisiontree</h4>
<div class="outline-text-4" id="text-9-6-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.feature_extraction <span style="color: #4f97d7; font-weight: bold;">import</span> DictVectorizer
<span style="color: #4f97d7; font-weight: bold;">import</span> csv
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn <span style="color: #4f97d7; font-weight: bold;">import</span> preprocessing
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn <span style="color: #4f97d7; font-weight: bold;">import</span> tree
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.externals.six <span style="color: #4f97d7; font-weight: bold;">import</span> StringIO
<span style="color: #4f97d7; font-weight: bold;">import</span> numpy <span style="color: #4f97d7; font-weight: bold;">as</span> np
<span style="color: #4f97d7; font-weight: bold;">import</span> pandas <span style="color: #4f97d7; font-weight: bold;">as</span> pd
<span style="color: #4f97d7; font-weight: bold;">from</span> pylab <span style="color: #4f97d7; font-weight: bold;">import</span> *

<span style="color: #7590db;">allElectronicsData</span> = <span style="color: #4f97d7;">open</span>(<span style="color: #2d9574;">"computer.csv"</span>)
<span style="color: #7590db;">reader</span> = csv.reader(allElectronicsData)
<span style="color: #7590db;">headers</span> = <span style="color: #4f97d7;">next</span>(reader)
<span style="color: #4f97d7;">print</span>(headers)
<span style="color: #4f97d7;">print</span>(reader)

<span style="color: #7590db;">featureList</span> = []
<span style="color: #7590db;">labelList</span> = []
<span style="color: #4f97d7; font-weight: bold;">for</span> row <span style="color: #4f97d7; font-weight: bold;">in</span> reader:
<span style="background-color: #292e34;"> </span>   labelList.append(row[<span style="color: #4f97d7;">len</span>(row)-1])
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">rowDict</span> = {}
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> i <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(1,<span style="color: #4f97d7;">len</span>(row)-1):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   rowDict[headers[i]] = row[i]
<span style="background-color: #292e34;"> </span>   featureList.append(rowDict)
<span style="color: #4f97d7;">print</span>(featureList)

<span style="color: #7590db;">vec</span> = DictVectorizer()
<span style="color: #7590db;">dummyX</span> = vec.fit_transform(featureList).toarray()
<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"dummyX: "</span> + <span style="color: #4f97d7;">str</span>(dummyX))
<span style="color: #4f97d7;">print</span>(vec.get_feature_names())

<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"labeList"</span> + <span style="color: #4f97d7;">str</span>(labelList))
<span style="color: #7590db;">lb</span> = preprocessing.LabelBinarizer()
<span style="color: #7590db;">dummyY</span> = lb.fit_transform(labelList)
<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"dummyY:"</span> + <span style="color: #4f97d7;">str</span>(dummyY))

<span style="color: #7590db;">clf</span> = tree.DecisionTreeClassifier(criterion= <span style="color: #2d9574;">'entropy'</span>)
<span style="color: #7590db;">clf</span> = clf.fit(dummyX,dummyY)
<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"clf :"</span> + <span style="color: #4f97d7;">str</span>(clf))

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">save as dot</span>
<span style="color: #4f97d7; font-weight: bold;">with</span> <span style="color: #4f97d7;">open</span>(<span style="color: #2d9574;">"output.dot"</span>,<span style="color: #2d9574;">"w"</span>) <span style="color: #4f97d7; font-weight: bold;">as</span> f:
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">f</span> = tree.export_graphviz(clf, feature_names= vec.get_feature_names(), out_file = f)

<span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">in terminnal gives the flowwing comands</span>

<span style="color: #2aa1ae; background-color: #292e34;">#    </span><span style="color: #2aa1ae; background-color: #292e34;">dot -Tpdf -O output.dot</span>
<span style="color: #2aa1ae; background-color: #292e34;">#    </span><span style="color: #2aa1ae; background-color: #292e34;">xdg-open output.pdf</span>

</pre>
</div>
</div>
</div>
<div id="outline-container-org6027ca0" class="outline-4">
<h4 id="org6027ca0"><span class="section-number-4">9.6.2.</span> cross validation 1</h4>
<div class="outline-text-4" id="text-9-6-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">View more python learning tutorial on my Youtube and Youku channel!!!</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Youtube video tutorial: https://www.youtube.com/channel/UCdyjiB5H8Pu7aDTNVXTTpcg</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Youku video tutorial: http://i.youku.com/pythontutorial</span>

<span style="color: #9f8766;">"""</span>
<span style="color: #9f8766;">Please note, this code is only for python 3+. If you are using python 2+, please modify the code accordingly.</span>
<span style="color: #9f8766;">"""</span>
<span style="color: #4f97d7; font-weight: bold;">from</span> __future__ <span style="color: #4f97d7; font-weight: bold;">import</span> print_function
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.datasets <span style="color: #4f97d7; font-weight: bold;">import</span> load_iris
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.cross_validation <span style="color: #4f97d7; font-weight: bold;">import</span> train_test_split
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.neighbors <span style="color: #4f97d7; font-weight: bold;">import</span> KNeighborsClassifier

<span style="color: #7590db;">iris</span> = load_iris()
<span style="color: #7590db;">X</span> = iris.data
<span style="color: #7590db;">y</span> = iris.target

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">test train split #</span>
<span style="color: #7590db;">X_train</span>, <span style="color: #7590db;">X_test</span>, <span style="color: #7590db;">y_train</span>, <span style="color: #7590db;">y_test</span> = train_test_split(X, y, random_state=4)
<span style="color: #7590db;">knn</span> = KNeighborsClassifier(n_neighbors=5)
knn.fit(X_train, y_train)
<span style="color: #7590db;">y_pred</span> = knn.predict(X_test)
<span style="color: #4f97d7;">print</span>(knn.score(X_test, y_test))

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">this is cross_val_score #</span>
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.cross_validation <span style="color: #4f97d7; font-weight: bold;">import</span> cross_val_score
<span style="color: #7590db;">knn</span> = KNeighborsClassifier(n_neighbors=5)
<span style="color: #7590db;">scores</span> = cross_val_score(knn, X, y, cv=5, scoring=<span style="color: #2d9574;">'accuracy'</span>)
<span style="color: #4f97d7;">print</span>(scores)

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">this is how to use cross_val_score to choose model and configs #</span>
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.cross_validation <span style="color: #4f97d7; font-weight: bold;">import</span> cross_val_score
<span style="color: #4f97d7; font-weight: bold;">import</span> matplotlib.pyplot <span style="color: #4f97d7; font-weight: bold;">as</span> plt
<span style="color: #7590db;">k_range</span> = <span style="color: #4f97d7;">range</span>(1, 31)
<span style="color: #7590db;">k_scores</span> = []
<span style="color: #4f97d7; font-weight: bold;">for</span> k <span style="color: #4f97d7; font-weight: bold;">in</span> k_range:
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">knn</span> = KNeighborsClassifier(n_neighbors=k)
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">loss</span> = -cross_val_score(knn, X, y, cv=10, scoring=<span style="color: #2d9574;">'mean_squared_error'</span>) <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">for regression</span>
<span style="background-color: #292e34;"> </span>   k_scores.append(loss.mean())

plt.plot(k_range, k_scores)
plt.xlabel(<span style="color: #2d9574;">'Value of K for KNN'</span>)
plt.ylabel(<span style="color: #2d9574;">'Cross-Validated Accuracy'</span>)
plt.show()


</pre>
</div>
</div>
</div>

<div id="outline-container-org5437b22" class="outline-4">
<h4 id="org5437b22"><span class="section-number-4">9.6.3.</span> cross validation 2</h4>
<div class="outline-text-4" id="text-9-6-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">View more python learning tutorial on my Youtube and Youku channel!!!</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Youtube video tutorial: https://www.youtube.com/channel/UCdyjiB5H8Pu7aDTNVXTTpcg</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Youku video tutorial: http://i.youku.com/pythontutorial</span>

<span style="color: #9f8766;">"""</span>
<span style="color: #9f8766;">Please note, this code is only for python 3+. If you are using python 2+, please modify the code accordingly.</span>
<span style="color: #9f8766;">"""</span>
<span style="color: #4f97d7; font-weight: bold;">from</span> __future__ <span style="color: #4f97d7; font-weight: bold;">import</span> print_function
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.learning_curve <span style="color: #4f97d7; font-weight: bold;">import</span>  learning_curve
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.datasets <span style="color: #4f97d7; font-weight: bold;">import</span> load_digits
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.svm <span style="color: #4f97d7; font-weight: bold;">import</span> SVC
<span style="color: #4f97d7; font-weight: bold;">import</span> matplotlib.pyplot <span style="color: #4f97d7; font-weight: bold;">as</span> plt
<span style="color: #4f97d7; font-weight: bold;">import</span> numpy <span style="color: #4f97d7; font-weight: bold;">as</span> np

<span style="color: #7590db;">digits</span> = load_digits()
<span style="color: #7590db;">X</span> = digits.data
<span style="color: #7590db;">y</span> = digits.target
<span style="color: #7590db;">train_sizes</span>, <span style="color: #7590db;">train_loss</span>, <span style="color: #7590db;">test_loss</span>= learning_curve(
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   SVC(gamma=0.01), X, y, cv=10, scoring=<span style="color: #2d9574;">'mean_squared_error'</span>,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   train_sizes=[0.1, 0.25, 0.5, 0.75, 1])
<span style="color: #7590db;">train_loss_mean</span> = -np.mean(train_loss, axis=1)
<span style="color: #7590db;">test_loss_mean</span> = -np.mean(test_loss, axis=1)

plt.plot(train_sizes, train_loss_mean, <span style="color: #2d9574;">'o-'</span>, color=<span style="color: #2d9574;">"r"</span>,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>label=<span style="color: #2d9574;">"Training"</span>)
plt.plot(train_sizes, test_loss_mean, <span style="color: #2d9574;">'o-'</span>, color=<span style="color: #2d9574;">"g"</span>,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>label=<span style="color: #2d9574;">"Cross-validation"</span>)

plt.xlabel(<span style="color: #2d9574;">"Training examples"</span>)
plt.ylabel(<span style="color: #2d9574;">"Loss"</span>)
plt.legend(loc=<span style="color: #2d9574;">"best"</span>)
plt.show()


</pre>
</div>
</div>
</div>

<div id="outline-container-org404160e" class="outline-4">
<h4 id="org404160e"><span class="section-number-4">9.6.4.</span> corss validation 3</h4>
<div class="outline-text-4" id="text-9-6-4">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">View more python learning tutorial on my Youtube and Youku channel!!!</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Youtube video tutorial: https://www.youtube.com/channel/UCdyjiB5H8Pu7aDTNVXTTpcg</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Youku video tutorial: http://i.youku.com/pythontutorial</span>

<span style="color: #9f8766;">"""</span>
<span style="color: #9f8766;">Please note, this code is only for python 3+. If you are using python 2+, please modify the code accordingly.</span>
<span style="color: #9f8766;">"""</span>
<span style="color: #4f97d7; font-weight: bold;">from</span> __future__ <span style="color: #4f97d7; font-weight: bold;">import</span> print_function
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.learning_curve <span style="color: #4f97d7; font-weight: bold;">import</span>  validation_curve
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.datasets <span style="color: #4f97d7; font-weight: bold;">import</span> load_digits
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.svm <span style="color: #4f97d7; font-weight: bold;">import</span> SVC
<span style="color: #4f97d7; font-weight: bold;">import</span> matplotlib.pyplot <span style="color: #4f97d7; font-weight: bold;">as</span> plt
<span style="color: #4f97d7; font-weight: bold;">import</span> numpy <span style="color: #4f97d7; font-weight: bold;">as</span> np

<span style="color: #7590db;">digits</span> = load_digits()
<span style="color: #7590db;">X</span> = digits.data
<span style="color: #7590db;">y</span> = digits.target
<span style="color: #7590db;">param_range</span> = np.logspace(-6, -2.3, 5)
<span style="color: #7590db;">train_loss</span>, <span style="color: #7590db;">test_loss</span> = validation_curve(
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   SVC(), X, y, param_name=<span style="color: #2d9574;">'gamma'</span>, param_range=param_range, cv=10,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   scoring=<span style="color: #2d9574;">'mean_squared_error'</span>)
<span style="color: #7590db;">train_loss_mean</span> = -np.mean(train_loss, axis=1)
<span style="color: #7590db;">test_loss_mean</span> = -np.mean(test_loss, axis=1)

plt.plot(param_range, train_loss_mean, <span style="color: #2d9574;">'o-'</span>, color=<span style="color: #2d9574;">"r"</span>,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>label=<span style="color: #2d9574;">"Training"</span>)
plt.plot(param_range, test_loss_mean, <span style="color: #2d9574;">'o-'</span>, color=<span style="color: #2d9574;">"g"</span>,
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>label=<span style="color: #2d9574;">"Cross-validation"</span>)

plt.xlabel(<span style="color: #2d9574;">"gamma"</span>)
plt.ylabel(<span style="color: #2d9574;">"Loss"</span>)
plt.legend(loc=<span style="color: #2d9574;">"best"</span>)
plt.show()


</pre>
</div>
</div>
</div>
<div id="outline-container-org2f65a35" class="outline-4">
<h4 id="org2f65a35"><span class="section-number-4">9.6.5.</span> data application</h4>
<div class="outline-text-4" id="text-9-6-5">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">View more python learning tutorial on my Youtube and Youku channel!!!</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Youtube video tutorial: https://www.youtube.com/channel/UCdyjiB5H8Pu7aDTNVXTTpcg</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Youku video tutorial: http://i.youku.com/pythontutorial</span>

<span style="color: #9f8766;">"""</span>
<span style="color: #9f8766;">Please note, this code is only for python 3+. If you are using python 2+, please modify the code accordingly.</span>
<span style="color: #9f8766;">"""</span>
<span style="color: #4f97d7; font-weight: bold;">from</span> __future__ <span style="color: #4f97d7; font-weight: bold;">import</span> print_function
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn <span style="color: #4f97d7; font-weight: bold;">import</span> datasets
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.linear_model <span style="color: #4f97d7; font-weight: bold;">import</span> LinearRegression
<span style="color: #4f97d7; font-weight: bold;">import</span> matplotlib.pyplot <span style="color: #4f97d7; font-weight: bold;">as</span> plt

<span style="color: #7590db;">loaded_data</span> = datasets.load_boston()
<span style="color: #7590db;">data_X</span> = loaded_data.data
<span style="color: #7590db;">data_y</span> = loaded_data.target

<span style="color: #7590db;">model</span> = LinearRegression()
model.fit(data_X, data_y)

<span style="color: #4f97d7;">print</span>(model.predict(data_X[:4, :]))
<span style="color: #4f97d7;">print</span>(data_y[:4])

<span style="color: #7590db;">X</span>, <span style="color: #7590db;">y</span> = datasets.make_regression(n_samples=100, n_features=1, n_targets=1, noise=1)
plt.scatter(X, y)
plt.show()


</pre>
</div>
</div>
</div>
<div id="outline-container-orga505df7" class="outline-4">
<h4 id="orga505df7"><span class="section-number-4">9.6.6.</span> eigenschaft function</h4>
<div class="outline-text-4" id="text-9-6-6">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">View more python learning tutorial on my Youtube and Youku channel!!!</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Youtube video tutorial: https://www.youtube.com/channel/UCdyjiB5H8Pu7aDTNVXTTpcg</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Youku video tutorial: http://i.youku.com/pythontutorial</span>

<span style="color: #9f8766;">"""</span>
<span style="color: #9f8766;">Please note, this code is only for python 3+. If you are using python 2+, please modify the code accordingly.</span>
<span style="color: #9f8766;">"""</span>
<span style="color: #4f97d7; font-weight: bold;">from</span> __future__ <span style="color: #4f97d7; font-weight: bold;">import</span> print_function
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn <span style="color: #4f97d7; font-weight: bold;">import</span> datasets
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.linear_model <span style="color: #4f97d7; font-weight: bold;">import</span> LinearRegression

<span style="color: #7590db;">loaded_data</span> = datasets.load_boston()
<span style="color: #7590db;">data_X</span> = loaded_data.data
<span style="color: #7590db;">data_y</span> = loaded_data.target

<span style="color: #7590db;">model</span> = LinearRegression()
model.fit(data_X, data_y)

<span style="color: #4f97d7;">print</span>(model.predict(data_X[:4, :]))
<span style="color: #4f97d7;">print</span>(model.coef_)
<span style="color: #4f97d7;">print</span>(model.intercept_)
<span style="color: #4f97d7;">print</span>(model.get_params())
<span style="color: #4f97d7;">print</span>(model.score(data_X, data_y)) <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">R^2 coefficient of determination</span>


</pre>
</div>
</div>
</div>
<div id="outline-container-orgad2040e" class="outline-4">
<h4 id="orgad2040e"><span class="section-number-4">9.6.7.</span> iris</h4>
<div class="outline-text-4" id="text-9-6-7">
<p>
View more python learning tutorial on my Youtube and Youku channel!!!
</p>

<p>
Youtube video tutorial: <a href="https://www.youtube.com/channel/UCdyjiB5H8Pu7aDTNVXTTpcg">https://www.youtube.com/channel/UCdyjiB5H8Pu7aDTNVXTTpcg</a>
Youku video tutorial: <a href="http://i.youku.com/pythontutorial">http://i.youku.com/pythontutorial</a>
</p>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #9f8766;">"""</span>
<span style="color: #9f8766;">Please note, this code is only for python 3+. If you are using python 2+, please modify the code accordingly.</span>
<span style="color: #9f8766;">"""</span>
<span style="color: #4f97d7; font-weight: bold;">from</span> __future__ <span style="color: #4f97d7; font-weight: bold;">import</span> print_function
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn <span style="color: #4f97d7; font-weight: bold;">import</span> datasets
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.model_selection <span style="color: #4f97d7; font-weight: bold;">import</span> train_test_split
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.neighbors <span style="color: #4f97d7; font-weight: bold;">import</span> KNeighborsClassifier

<span style="color: #7590db;">iris</span> = datasets.load_iris()
<span style="color: #7590db;">iris_X</span> = iris.data
<span style="color: #7590db;">iris_y</span> = iris.target


<span style="color: #7590db;">X_train</span>, <span style="color: #7590db;">X_test</span>, <span style="color: #7590db;">y_train</span>, <span style="color: #7590db;">y_test</span> = train_test_split(
<span style="background-color: #292e34;"> </span>   iris_X, iris_y, test_size=0.3)


<span style="color: #7590db;">knn</span> = KNeighborsClassifier()
knn.fit(X_train, y_train)
<span style="color: #4f97d7;">print</span>(knn.predict(X_test))
<span style="color: #4f97d7;">print</span>(y_test)


</pre>
</div>
</div>
</div>
<div id="outline-container-org24199c4" class="outline-4">
<h4 id="org24199c4"><span class="section-number-4">9.6.8.</span> normnalization</h4>
<div class="outline-text-4" id="text-9-6-8">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">View more python learning tutorial on my Youtube and Youku channel!!!</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Youtube video tutorial: https://www.youtube.com/channel/UCdyjiB5H8Pu7aDTNVXTTpcg</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Youku video tutorial: http://i.youku.com/pythontutorial</span>

<span style="color: #9f8766;">"""</span>
<span style="color: #9f8766;">Please note, this code is only for python 3+. If you are using python 2+, please modify the code accordingly.</span>
<span style="color: #9f8766;">"""</span>
<span style="color: #4f97d7; font-weight: bold;">from</span> __future__ <span style="color: #4f97d7; font-weight: bold;">import</span> print_function
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn <span style="color: #4f97d7; font-weight: bold;">import</span> preprocessing
<span style="color: #4f97d7; font-weight: bold;">import</span> numpy <span style="color: #4f97d7; font-weight: bold;">as</span> np
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.model_selection <span style="color: #4f97d7; font-weight: bold;">import</span> train_test_split
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.datasets.samples_generator <span style="color: #4f97d7; font-weight: bold;">import</span> make_classification
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.svm <span style="color: #4f97d7; font-weight: bold;">import</span> SVC
<span style="color: #4f97d7; font-weight: bold;">import</span> matplotlib.pyplot <span style="color: #4f97d7; font-weight: bold;">as</span> plt

<span style="color: #7590db;">a</span> = np.array([[10, 2.7, 3.6],
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>[-100, 5, -2],
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>[120, 20, 40]], dtype=np.float64)
<span style="color: #4f97d7;">print</span>(a)
<span style="color: #4f97d7;">print</span>(preprocessing.scale(a))

<span style="color: #7590db;">X</span>, <span style="color: #7590db;">y</span> = make_classification(n_samples=300, n_features=2 , n_redundant=0, n_informative=2, random_state=22, n_clusters_per_class=1, scale=100)
plt.scatter(X[:, 0], X[:, 1], c=y)
plt.show()
<span style="color: #7590db;">X</span> = preprocessing.scale(X)    <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">normalization step</span>
<span style="color: #7590db;">X_train</span>, <span style="color: #7590db;">X_test</span>, <span style="color: #7590db;">y_train</span>, <span style="color: #7590db;">y_test</span> = train_test_split(X, y, test_size=.3)
<span style="color: #7590db;">clf</span> = SVC()
clf.fit(X_train, y_train)
<span style="color: #4f97d7;">print</span>(clf.score(X_test, y_test))


</pre>
</div>
</div>
</div>
<div id="outline-container-orgbc23632" class="outline-4">
<h4 id="orgbc23632"><span class="section-number-4">9.6.9.</span> save load</h4>
<div class="outline-text-4" id="text-9-6-9">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">View more python tutorials on my Youtube and Youku channel!!!</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Youtube video tutorial: https://www.youtube.com/channel/UCdyjiB5H8Pu7aDTNVXTTpcg</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Youku video tutorial: http://i.youku.com/pythontutorial</span>

<span style="color: #9f8766;">"""</span>
<span style="color: #9f8766;">Please note, this code is only for python 3+. If you are using python 2+, please modify the code accordingly.</span>
<span style="color: #9f8766;">"""</span>
<span style="color: #4f97d7; font-weight: bold;">from</span> __future__ <span style="color: #4f97d7; font-weight: bold;">import</span> print_function
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn <span style="color: #4f97d7; font-weight: bold;">import</span> svm
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn <span style="color: #4f97d7; font-weight: bold;">import</span> datasets

<span style="color: #7590db;">clf</span> = svm.SVC()
<span style="color: #7590db;">iris</span> = datasets.load_iris()
<span style="color: #7590db;">X</span>, <span style="color: #7590db;">y</span> = iris.data, iris.target
clf.fit(X, y)

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;"># method 1: pickle</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">import pickle</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;"># save</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">with open('save/clf.pickle', 'wb') as f:</span>
<span style="color: #2aa1ae; background-color: #292e34;">#     </span><span style="color: #2aa1ae; background-color: #292e34;">pickle.dump(clf, f)</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;"># restore</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">with open('save/clf.pickle', 'rb') as f:</span>
<span style="color: #2aa1ae; background-color: #292e34;">#    </span><span style="color: #2aa1ae; background-color: #292e34;">clf2 = pickle.load(f)</span>
<span style="color: #2aa1ae; background-color: #292e34;">#    </span><span style="color: #2aa1ae; background-color: #292e34;">print(clf2.predict(X[0:1]))</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">method 2: joblib</span>
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.externals <span style="color: #4f97d7; font-weight: bold;">import</span> joblib
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Save</span>
joblib.dump(clf, <span style="color: #2d9574;">'save/clf.pkl'</span>)
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">restore</span>
<span style="color: #7590db;">clf3</span> = joblib.load(<span style="color: #2d9574;">'save/clf.pkl'</span>)
<span style="color: #4f97d7;">print</span>(clf3.predict(X[0:1]))


</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org5c17284" class="outline-3">
<h3 id="org5c17284"><span class="section-number-3">9.7.</span> theano</h3>
<div class="outline-text-3" id="text-9-7">
</div>
<div id="outline-container-orgb5a4280" class="outline-4">
<h4 id="orgb5a4280"><span class="section-number-4">9.7.1.</span> basic</h4>
<div class="outline-text-4" id="text-9-7-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">View more python tutorials on my Youtube and Youku channel!!!</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Youtube video tutorial: https://www.youtube.com/channel/UCdyjiB5H8Pu7aDTNVXTTpcg</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Youku video tutorial: http://i.youku.com/pythontutorial</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">4 - basic usage</span>
<span style="color: #2aa1ae; background-color: #292e34;">#   </span><span style="color: #2aa1ae; background-color: #292e34;">from __future__ import print_function</span>
<span style="color: #4f97d7; font-weight: bold;">import</span> numpy <span style="color: #4f97d7; font-weight: bold;">as</span> np
<span style="color: #4f97d7; font-weight: bold;">import</span> theano.tensor <span style="color: #4f97d7; font-weight: bold;">as</span> T
<span style="color: #4f97d7; font-weight: bold;">from</span> theano <span style="color: #4f97d7; font-weight: bold;">import</span> function

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">basic</span>
<span style="color: #7590db;">x</span> = T.dscalar(<span style="color: #2d9574;">'x'</span>)
<span style="color: #7590db;">y</span> = T.dscalar(<span style="color: #2d9574;">'y'</span>)
<span style="color: #7590db;">z</span> = x+y     <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">define the actual function in here</span>
<span style="color: #7590db;">f</span> = function([x, y], z)  <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">the inputs are in [], and the output in the "z"</span>

<span style="color: #4f97d7;">print</span>(f(2,3))  <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">only give the inputs "x and y" for this function, then it will calculate the output "z"</span>

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;"># to pretty-print the function</span>
<span style="color: #4f97d7; font-weight: bold;">from</span> theano <span style="color: #4f97d7; font-weight: bold;">import</span> pp
<span style="color: #4f97d7;">print</span>(pp(z))

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;"># how about matrix</span>
<span style="color: #7590db;">x</span> = T.dmatrix(<span style="color: #2d9574;">'x'</span>)
<span style="color: #7590db;">y</span> = T.dmatrix(<span style="color: #2d9574;">'y'</span>)
<span style="color: #7590db;">z</span> = x + y
<span style="color: #7590db;">f</span> = function([x, y], z)
<span style="color: #4f97d7;">print</span>(f(np.arange(12).reshape((3,4)), 10*np.ones((3,4))))


</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc235c28" class="outline-2">
<h2 id="orgc235c28"><span class="section-number-2">10.</span> Tensorflow 2</h2>
<div class="outline-text-2" id="text-10">
</div>
<div id="outline-container-org1198e72" class="outline-3">
<h3 id="org1198e72"><span class="section-number-3">10.1.</span> Tensorflow foundation</h3>
<div class="outline-text-3" id="text-10-1">
</div>
<div id="outline-container-org3ee66d6" class="outline-4">
<h4 id="org3ee66d6"><span class="section-number-4">10.1.1.</span> 数值类型</h4>
<div class="outline-text-4" id="text-10-1-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">type</td>
<td class="org-right">diam</td>
<td class="org-left">shape</td>
<td class="org-left">function</td>
</tr>

<tr>
<td class="org-left">Scalar</td>
<td class="org-right">0</td>
<td class="org-left">[]</td>
<td class="org-left">acc</td>
</tr>

<tr>
<td class="org-left">Vector</td>
<td class="org-right">1</td>
<td class="org-left">[n,]</td>
<td class="org-left">bias (b)</td>
</tr>

<tr>
<td class="org-left">Matrix</td>
<td class="org-right">2</td>
<td class="org-left">[n, m]</td>
<td class="org-left">weight (W)</td>
</tr>

<tr>
<td class="org-left">Tensor</td>
<td class="org-right">lg 3</td>
<td class="org-left">[n,m,p]</td>
<td class="org-left">input ( [n, h, w, 3]</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #7590db;">a</span> = tf.constant(example)
tf.constant()  <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#21151;&#33021;&#31867;&#20284;&#20110;tf.convert_to_tensor()</span>
<span style="color: #7590db;">b</span> = tf.constant(<span style="color: #2d9574;">'Hello Deep learning'</span>)
<span style="color: #7590db;">c</span> = tf.constant(<span style="color: #a45bad;">True</span>)
<span style="color: #7590db;">dtype</span>=tf.int16, int32, int64,tf.float16, tf.float32, tf.float64
tf.cast(a, tf.float64)
tf.Variable(a)    <span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#21487;&#20197;&#28155;&#21152;a&#30340;&#21487;&#35757;&#32451;&#23646;&#24615;</span>
tf.zeros([n,m])  tf.zeros_like(a)  == tf.zeros(a.shape)
tf.ones([n,m])   tf.ones_like(a)   == tf.ones(a.shape)
tf.fill([2,2],10)
tf.random.normal([2,2]) == tf.random.normal([2,2], mean=0, stddev=1)
tf.random.uniform(shape, minval=0,maxval=10,dtype=tf.float32)
tf.<span style="color: #4f97d7;">range</span>(10) == tf.<span style="color: #4f97d7;">range</span>(0,10, delta = 2)

</pre>
</div>
</div>
</div>

<div id="outline-container-org1e44052" class="outline-4">
<h4 id="org1e44052"><span class="section-number-4">10.1.2.</span> Reference(,) and Segment(:)</h4>
<div class="outline-text-4" id="text-10-1-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #7590db;">x</span> = tf.random.normal([4,32,32,3])
x[2][1][0][1]  == x[2,1,0,1]

[start:end:step] <span style="color: #4f97d7; font-weight: bold;">for</span> each dimension.
x[1:3:2, 1:4:2, 2:4:2, 1:3:2]

</pre>
</div>
</div>
</div>

<div id="outline-container-org8ade28e" class="outline-4">
<h4 id="org8ade28e"><span class="section-number-4">10.1.3.</span> 改变视图</h4>
<div class="outline-text-4" id="text-10-1-3">
<p>
x = tf.random.normal([4,32,32,3]) 的数据是整体贮存的，可以合法的
reshape. 从后往前合并，拆分。
</p>
</div>

<ol class="org-ol">
<li><a id="orgf492e60"></a>增加维度<br />
<div class="outline-text-5" id="text-10-1-3-1">
<p>
增加前置维度
tf.expand<sub>dims</sub>(x, axis=0)
增加后置维度
tf.expand<sub>dims</sub>(x, axis=-1)
也可以是其他值，表示在相应的位置增加一个维度
</p>
</div>
</li>

<li><a id="org6f98879"></a>删除维度<br />
<div class="outline-text-5" id="text-10-1-3-2">
<p>
删除前置
tf.squeeze(x, axis=0)
后置和其他位置一样，删除dia=1的维度
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgec9d2c6" class="outline-4">
<h4 id="orgec9d2c6"><span class="section-number-4">10.1.4.</span> 交换维度</h4>
<div class="outline-text-4" id="text-10-1-4">
<p>
这会改变数据的贮存顺序
x = tf.random.normal([2,32,32,3])
x = tf.transpose(x, perm=[0,3,1,2])
以前的维度下表变换为perm
</p>
</div>
</div>

<div id="outline-container-orgd72f59b" class="outline-4">
<h4 id="orgd72f59b"><span class="section-number-4">10.1.5.</span> Broadcasting</h4>
</div>
<div id="outline-container-org367fb08" class="outline-4">
<h4 id="org367fb08"><span class="section-number-4">10.1.6.</span> tile</h4>
<div class="outline-text-4" id="text-10-1-6">
<p>
x = tf.random.normal([4,32,32,3])
y = tf.tile(x,[2,3,3,1]) 对应维度各复制成原来的2，3，3，1倍。
</p>
</div>
</div>

<div id="outline-container-orge645736" class="outline-4">
<h4 id="orge645736"><span class="section-number-4">10.1.7.</span> Concatenate &amp; Stack &amp; Split &amp; unstack</h4>
<div class="outline-text-4" id="text-10-1-7">
<p>
tf.concat([a,b],axis=0) 除了axis=0外的所有维度都应该一样
tf.stack([a,b],axis=0) a,b的所有维度应该都一样，插入的位置和
expand<sub>dims</sub>() 遵守相同规则
tf.split(x, num<sub>or</sub><sub>size</sub><sub>splits</sub>=10, axis=0) 拆分的维度不消失
tf.unstack(x, axis=0) 拆为步长为1           拆分的维度消失
</p>
</div>
</div>

<div id="outline-container-org285769a" class="outline-4">
<h4 id="org285769a"><span class="section-number-4">10.1.8.</span> Statistik</h4>
<div class="outline-text-4" id="text-10-1-8">
<p>
L1 Norm  \(||x_{1}|| = \sum_{i}|x_{i}|\)
tf.norm(x, ord=1)
L2 Norm  \(||x_{2}|| = \sqrt{\sum_{i}|x_{i}|^2 }\)
tf.norm(x,ord=2)
</p>

<p>
tf.reduce<sub>max</sub>(x, axis=0)
tf.reduce<sub>min</sub>()
tf.reduce<sub>mean</sub>()
tf.reduce<sub>sum</sub>()
不指明axis则是对全局求解
tf.argmax(x, axis) 
tf.argmin(x,axis) axis 轴的极值坐标
</p>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #7590db;">out</span> = tf.random.normal([100,10])
<span style="color: #7590db;">out</span> = tf.nn.softmax(out, axis=1)
<span style="color: #7590db;">pred</span> = tf.argmax(out, axis=1)
<span style="color: #7590db;">y</span> = tf.random.uniform([100],dtype=tf.int64,maxval=10)
<span style="color: #7590db;">out</span> = tf.equal(pred, y)
<span style="color: #7590db;">out</span> = tf.cast(out, dtype=tf.float32)
<span style="color: #7590db;">cor</span> = tf.reduce_sum(out)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc736a0f" class="outline-4">
<h4 id="orgc736a0f"><span class="section-number-4">10.1.9.</span> Padding</h4>
<div class="outline-text-4" id="text-10-1-9">
<pre class="example">
x = tf.pad(x,[[0,2]]) []内是padding 填充的方案，每个[]表示一个维度
</pre>
</div>
</div>


<div id="outline-container-org343e3aa" class="outline-4">
<h4 id="org343e3aa"><span class="section-number-4">10.1.10.</span> advance manipulation</h4>
</div>
<div id="outline-container-org47e2aad" class="outline-4">
<h4 id="org47e2aad"><span class="section-number-4">10.1.11.</span> tf.minimum</h4>
<div class="outline-text-4" id="text-10-1-11">
<p>
tf.minimum(x, a) 最小a
tf.maximum(x, b) 最大b
tf.minimum(tf.maximum(x,2),7) == tf.clip<sub>by</sub><sub>value</sub>(x,2,7)
</p>
</div>
</div>

<div id="outline-container-orgf904bb7" class="outline-4">
<h4 id="orgf904bb7"><span class="section-number-4">10.1.12.</span> tf.gather</h4>
<div class="outline-text-4" id="text-10-1-12">
<p>
tf.gather(x, [0,2,4,5,7],axis =1) 抽取在axis=1上的[0,2,4,5,7]坐标的组
成数据，并可以重新定义组成数据的顺序
</p>
</div>
</div>
<div id="outline-container-orgf04359d" class="outline-4">
<h4 id="orgf04359d"><span class="section-number-4">10.1.13.</span> tf.gather<sub>nd</sub></h4>
<div class="outline-text-4" id="text-10-1-13">
<p>
后面根的[]说明了所有成员要操作的维度，
第一成员的第一维坐标为1，第二维坐标为1..
所有成员组成List
</p>
</div>
</div>
<div id="outline-container-orga4d3f13" class="outline-4">
<h4 id="orga4d3f13"><span class="section-number-4">10.1.14.</span> tf.boolean<sub>mask</sub></h4>
<div class="outline-text-4" id="text-10-1-14">
<p>
tf.boolean<sub>mask</sub>(x, mask=[True, False, True, False],axis =0)
在axis=0的轴上，只有mask成员是True才会被选中，mask 长度等于axis=0 轴的
长度。
</p>
</div>
</div>
<div id="outline-container-org29cf680" class="outline-4">
<h4 id="org29cf680"><span class="section-number-4">10.1.15.</span> tf.where</h4>
<div class="outline-text-4" id="text-10-1-15">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #7590db;">a</span> = tf.ones([3,3])
<span style="color: #7590db;">b</span> = tf.zeros([3,3])
<span style="color: #7590db;">cond</span> = tf.constant([<span style="color: #a45bad;">True</span>,<span style="color: #a45bad;">False</span>,<span style="color: #a45bad;">False</span>],[<span style="color: #a45bad;">False</span>, <span style="color: #a45bad;">True</span>, <span style="color: #a45bad;">True</span>],[<span style="color: #a45bad;">False</span>, <span style="color: #a45bad;">False</span>, <span style="color: #a45bad;">False</span>])
<span style="color: #7590db;">c</span> = tf.where(cond, a,b)
</pre>
</div>
<p>
tf.where(cond) 返回所有值为True元素的下标
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #7590db;">x</span> = tf.random.normal([3.3])
<span style="color: #7590db;">mask</span> = x&gt;0
<span style="color: #7590db;">ind</span> = tf.where(mask)
<span style="color: #7590db;">a</span> = tf.gather_nd(x,ind)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcdc1e04" class="outline-4">
<h4 id="orgcdc1e04"><span class="section-number-4">10.1.16.</span> tf.scatter<sub>nd</sub></h4>
<div class="outline-text-4" id="text-10-1-16">
<p>
在一个长度为8的空白向量（全为0）里，将updates按照indices的位置写入
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #7590db;">indices</span> = tf.constant([[4],[3],[2],[1]])
<span style="color: #7590db;">updates</span> = tf.constant([3,1,0,2])
tf.scatter_nd(indices, updates, [8])

</pre>
</div>
</div>
</div>

<div id="outline-container-orgc0e8788" class="outline-4">
<h4 id="orgc0e8788"><span class="section-number-4">10.1.17.</span> tf.meshgrid</h4>
<div class="outline-text-4" id="text-10-1-17">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #7590db;">x</span> = tf.linspace(-8., 8, 100)   <span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">-8&#21518;&#38754;&#30340;. &#19981;&#33021;&#30465;&#30053;</span>
<span style="color: #7590db;">y</span> = tf.linspace(-8., 8, 100)
x.<span style="color: #7590db;">shape</span> = 100
<span style="color: #7590db;">x</span>, <span style="color: #7590db;">y</span> = tf.meshgrid(x,y)
x.<span style="color: #7590db;">shape</span> = [100,100]
ax.contour3D(x.numpy(), y.numpy(), z.numpy(), 50)

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org662bcd0" class="outline-3">
<h3 id="org662bcd0"><span class="section-number-3">10.2.</span> chapter 01 code</h3>
<div class="outline-text-3" id="text-10-2">
<p>
一个很简单的例子，用tf来求某个函数的导数
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">as</span> tf
<span style="color: #7590db;">a</span> = tf.constant(1.)
<span style="color: #7590db;">b</span> = tf.constant(2.)
<span style="color: #7590db;">c</span> = tf.constant(3.)
<span style="color: #7590db;">w</span> = tf.constant(4.)

<span style="color: #4f97d7; font-weight: bold;">with</span> tf.GradientTape() <span style="color: #4f97d7; font-weight: bold;">as</span> tape:
<span style="background-color: #292e34;"> </span>   tape.watch([w])
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">y</span> = a*w**2 + b*w + c
[<span style="color: #7590db;">dy_dw</span>] = tape.gradient(y, [w])
<span style="color: #4f97d7;">print</span>(dy_dw)

</pre>
</div>


<p>
检测cpu和gpu运行时的时间对比
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">as</span> tf
<span style="color: #4f97d7; font-weight: bold;">import</span> timeit

<span style="color: #7590db;">n</span> = 10000000
<span style="color: #4f97d7; font-weight: bold;">with</span> tf.device(<span style="color: #2d9574;">'/cpu:0'</span>):
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">cpu_a</span> = tf.random.normal([1, n])
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">cpu_b</span> = tf.random.normal([n, 1])

<span style="color: #4f97d7; font-weight: bold;">with</span> tf.device(<span style="color: #2d9574;">'/gpu:0'</span>):
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">gpu_a</span> = tf.random.normal([1, n])
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">gpu_b</span> = tf.random.normal([n, 1])

<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">cpu_run</span>():
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">with</span> tf.device(<span style="color: #2d9574;">'/cpu:0'</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">c</span> = tf.matmul(cpu_a, cpu_b)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> c

<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">gpu_run</span>():
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">with</span> tf.device(<span style="color: #2d9574;">'/gpu:0'</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">c</span> = tf.matmul(gpu_a, cpu_b)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> c

<span style="color: #7590db;">cpu_time</span> = timeit.timeit(cpu_run, number=10)
<span style="color: #7590db;">gpu_time</span> = timeit.timeit(cpu_run, number=10)
<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'run time: '</span>, cpu_time, gpu_time)



</pre>
</div>

<p>
不用tensorflow的API，使用纯函数来实现神经网络训练的例子
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> numpy <span style="color: #4f97d7; font-weight: bold;">as</span> np
<span style="color: #7590db;">data</span> = []
<span style="color: #4f97d7; font-weight: bold;">for</span> i <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(100):
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">x</span> = np.random.uniform(-10., 10)
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">y</span> = 1.477*x + 0.089 + np.random.normal(0., 0.01)
<span style="background-color: #292e34;"> </span>   data.append([x, y])
<span style="color: #7590db;">data</span> = np.array(data)


<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">mse</span>(b, w, points):
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">totalError</span> = 0
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> i <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(0, <span style="color: #4f97d7;">len</span>(points)):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">x</span> = points[i, 0]
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">y</span> = points[i, 1]
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">totalError</span> += (y-(w*x+b))**2
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> totalError/<span style="color: #4f97d7;">float</span>(<span style="color: #4f97d7;">len</span>(points))


<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">step_gradient</span>(b_current, w_current, points, lr):
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">b_gradient</span> = 0
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">w_gradient</span> = 0
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">M</span> = <span style="color: #4f97d7;">float</span>(<span style="color: #4f97d7;">len</span>(points))
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> i <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(0, <span style="color: #4f97d7;">len</span>(points)):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">x</span> = points[i, 0]
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">y</span> = points[i, 1]
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">b_gradient</span> += (2/M)*((w_current*x+b_current)-y)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">w_gradient</span> += (2/M)*x*((w_current*x + b_current)-y)
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">new_b</span> = b_current - (lr*b_gradient)
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">new_w</span> = w_current - (lr*w_gradient)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> [new_b, new_w]


<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">gradient_descent</span>(points, staring_b, staring_w, lr, num_iterations):
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">b</span> = staring_b
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">w</span> = staring_w
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> step <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(num_iterations):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">b</span>, <span style="color: #7590db;">w</span> = step_gradient(b, w, np.array(points), lr)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">loss</span> = mse(b, w, points)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">if</span> step % 5000  == 0:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(f<span style="color: #2d9574;">"iterations:</span>{step}<span style="color: #2d9574;">, loss :</span>{loss}<span style="color: #2d9574;">, w:</span>{w}<span style="color: #2d9574;">, b:</span>{b}<span style="color: #2d9574;">"</span>)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> [b, w]


<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">main</span>():
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">lr</span> = 0.001
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">initial_b</span> = 0
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">initial_w</span> = 0
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">num_iterations</span> = 100000
<span style="background-color: #292e34;"> </span>   [<span style="color: #7590db;">b</span>, <span style="color: #7590db;">w</span>] = gradient_descent(data, initial_b, initial_w, lr, num_iterations)
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">loss</span> = mse(b, w, data)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(f<span style="color: #2d9574;">"Final loss :</span>{loss}<span style="color: #2d9574;">, w:</span>{w}<span style="color: #2d9574;">, b:</span>{b}<span style="color: #2d9574;">"</span>)


<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">if __name__ ==' __main__':</span>
main()


</pre>
</div>
</div>
</div>

<div id="outline-container-org7faa39e" class="outline-3">
<h3 id="org7faa39e"><span class="section-number-3">10.3.</span> MNIST dataset</h3>
<div class="outline-text-3" id="text-10-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">as</span> tf
<span style="color: #4f97d7; font-weight: bold;">from</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">import</span> keras
<span style="color: #4f97d7; font-weight: bold;">from</span> tensorflow.keras <span style="color: #4f97d7; font-weight: bold;">import</span> layers, optimizers, datasets
<span style="color: #7590db;">w1</span> = tf.Variable(tf.random.truncated_normal([784, 256], stddev=0.1))
<span style="color: #7590db;">b1</span> = tf.Variable(tf.zeros([256]))
<span style="color: #7590db;">w2</span> = tf.Variable(tf.random.truncated_normal([256, 128], stddev=0.1))
<span style="color: #7590db;">b2</span> = tf.Variable(tf.zeros([128]))
<span style="color: #7590db;">w3</span> = tf.Variable(tf.random.truncated_normal([128, 10], stddev=0.1))
<span style="color: #7590db;">b3</span> = tf.Variable(tf.zeros([10]))
(x,y),(<span style="color: #7590db;">x_val</span>, <span style="color: #7590db;">y_val</span>)=datasets.mnist.load_data()
<span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'x:'</span>,x.shape, <span style="color: #2d9574;">'y:'</span>, y.shape,<span style="color: #2d9574;">'x test:'</span>, x_val.shape, <span style="color: #2d9574;">'y test:'</span>, y_val)
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">preprocess</span>(x, y):
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">x</span> = tf.cast(x, dtype = tf.float32)/255.
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">x</span> = tf.reshape(x, [-1,28*28])
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">y</span> = tf.cast(y,dtype=tf.int32)
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">y</span> = tf.one_hot(y, depth=10)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> x,y
<span style="color: #7590db;">train_db</span> = tf.data.Dataset.from_tensor_slices((x,y))  <span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#26500;&#24314;Dataset &#23545;&#35937;</span>
<span style="color: #7590db;">train_db</span> = train_db.shuffle(10000)                    <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#25171;&#25955;&#26679;&#26412;&#39034;&#24207;</span>
<span style="color: #7590db;">train_db</span> = train_db.batch(128)                        <span style="color: #2aa1ae; background-color: #292e34;">#</span><span style="color: #2aa1ae; background-color: #292e34;">&#25209;&#35757;&#32451;</span>
<span style="color: #7590db;">train_db</span> = train_db.<span style="color: #4f97d7;">map</span>(preprocess)
<span style="color: #7590db;">test_db</span> = tf.data.Dataset.from_tensor_slices((x_val, y_val))
<span style="color: #7590db;">test_db</span> = test_db.shuffle(1000)
<span style="color: #7590db;">test_db</span> = test_db.batch(128)
<span style="color: #7590db;">test_db</span> = test_db.<span style="color: #4f97d7;">map</span>(preprocess)
<span style="color: #7590db;">lr</span> = 0.001
<span style="color: #4f97d7; font-weight: bold;">for</span> epoch <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(8):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> step, (x,y) <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">enumerate</span>(train_db):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">with</span> tf.GradientTape() <span style="color: #4f97d7; font-weight: bold;">as</span> tape:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">h1</span> = x@w1 + tf.broadcast_to(b1, [x.shape[0], 256])
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">h1</span> = tf.nn.relu(h1)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">h2</span> = h1@w2 + b2
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">h2</span> = tf.nn.relu(h2)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">out</span> = h2@w3 + b3
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">loss</span> = tf.square(y - out)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">loss</span> = tf.reduce_mean(loss)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">grads</span> = tape.gradient(loss, [w1,b1,w2,b2,w3,b3])
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   w1.assign_sub(lr *grads[0])
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   b1.assign_sub(lr * grads[1])
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   w2.assign_sub(lr *grads[2])
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   b2.assign_sub(lr * grads[3])
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   w3.assign_sub(lr *grads[4])
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   b3.assign_sub(lr * grads[5])
<span style="color: #4f97d7; font-weight: bold;">for</span> x, y <span style="color: #4f97d7; font-weight: bold;">in</span> test_db:
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">h1</span> = x@w1 + b1
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">h1</span> = tf.nn.relu(h1)
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">h2</span> = h1@w2 + b2
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">h2</span> = tf.nn.relu(h2)
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">out</span> = h2@w3 + b3
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">pred</span> = tf.argmax(out,axis=1)
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">y</span> = tf.argmax(y, axis=1)
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">correct</span> = tf.equal(pred, y)
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">total_correct</span> +=tf.reduce_sum(tf.cast(correct,dty=tf.int32)).numpy()



</pre>
</div>
</div>
</div>

<div id="outline-container-org862ec32" class="outline-3">
<h3 id="org862ec32"><span class="section-number-3">10.4.</span> Make<sub>moons</sub></h3>
<div class="outline-text-3" id="text-10-4">
<p>
all import 
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> seaborn <span style="color: #4f97d7; font-weight: bold;">as</span> sns
<span style="color: #4f97d7; font-weight: bold;">import</span> matplotlib.pyplot <span style="color: #4f97d7; font-weight: bold;">as</span> plt
</pre>
</div>


<p>
generate the data
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.datasets <span style="color: #4f97d7; font-weight: bold;">import</span> make_moons
<span style="color: #4f97d7; font-weight: bold;">from</span> sklearn.model_selection <span style="color: #4f97d7; font-weight: bold;">import</span> train_test_split
<span style="color: #7590db;">N_samples</span> = 2000
<span style="color: #7590db;">Test_size</span> = 0.3
<span style="color: #7590db;">X</span>, <span style="color: #7590db;">y</span> = make_moons(n_samples = N_samples, noise = 0.2, random_state=100)
<span style="color: #7590db;">X_train</span>, <span style="color: #7590db;">X_test</span>, <span style="color: #7590db;">y_train</span>, <span style="color: #7590db;">y_test</span> = train_test_split(X, y,test_size = Test_size, random_state = 42)
<span style="color: #4f97d7;">print</span>(X.shape, y.shape)
<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">make_plot</span>(X, y, plot_name, file_name=<span style="color: #a45bad;">None</span>, XX=<span style="color: #a45bad;">None</span>, YY=<span style="color: #a45bad;">None</span>, preds=<span style="color: #a45bad;">None</span>,dark=<span style="color: #a45bad;">False</span>):
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">if</span>(dark):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   plt.style.use(<span style="color: #2d9574;">'dark_background'</span>)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">else</span>:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   sns.set_style(<span style="color: #2d9574;">"whitegrid"</span>)
<span style="background-color: #292e34;"> </span>   plt.figure(figsize=(16,12))
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">axes</span> = plt.gca()
<span style="background-color: #292e34;"> </span>   axes.<span style="color: #4f97d7;">set</span>(xlabel=<span style="color: #2d9574;">"$x_1$"</span>, ylabel=<span style="color: #2d9574;">"$x_2$"</span>)
<span style="background-color: #292e34;"> </span>   plt.title(plot_name,fontsize=30)
<span style="background-color: #292e34;"> </span>   plt.subplots_adjust(left=0.20)
<span style="background-color: #292e34;"> </span>   plt.subplots_adjust(right=0.8)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">if</span>(XX <span style="color: #4f97d7; font-weight: bold;">is</span> <span style="color: #4f97d7; font-weight: bold;">not</span> <span style="color: #a45bad;">None</span> <span style="color: #4f97d7; font-weight: bold;">and</span> YY <span style="color: #4f97d7; font-weight: bold;">is</span> <span style="color: #4f97d7; font-weight: bold;">not</span> <span style="color: #a45bad;">None</span> <span style="color: #4f97d7; font-weight: bold;">and</span> preds <span style="color: #4f97d7; font-weight: bold;">is</span> <span style="color: #4f97d7; font-weight: bold;">not</span> <span style="color: #a45bad;">None</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   plt.contourf(XX,YY,preds.reshape(XX.shape), 25, alpha=1,cmap = cm.Spectral)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   plt.contour(XX,YY, preds.reshape(XX.shape), levels=[.5],cmap=<span style="color: #2d9574;">"Greys"</span>, vmin=0,vmax=0.6)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   plt.scatter(X[:,0],X[:,1],c=y.ravel(), s=40, cmap=plt.cm.Spectral,edgecolors=<span style="color: #2d9574;">'none'</span>)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   plt.savefig(<span style="color: #2d9574;">'data.svg'</span>)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   plt.close()
make_plot(X,y,<span style="color: #a45bad;">None</span>,<span style="color: #2d9574;">"Classification Dataset Visualization"</span>)
</pre>
</div>


<p>
generate the  signal Layer class
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">Layer</span>:
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">__init__</span>(<span style="color: #4f97d7; font-weight: bold;">self</span>, n_input, n_neurons,activation=<span style="color: #a45bad;">None</span>, weight=<span style="color: #a45bad;">None</span>,bias=<span style="color: #a45bad;">None</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">weight</span> = weight <span style="color: #4f97d7; font-weight: bold;">if</span> weight <span style="color: #4f97d7; font-weight: bold;">is</span> <span style="color: #4f97d7; font-weight: bold;">not</span> <span style="color: #a45bad;">None</span> <span style="color: #4f97d7; font-weight: bold;">else</span> np.random.randn(n_input,n_neurons)*np.sqrt(1/n_neurons)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">bias</span> = bias <span style="color: #4f97d7; font-weight: bold;">if</span> bias <span style="color: #4f97d7; font-weight: bold;">is</span> <span style="color: #4f97d7; font-weight: bold;">not</span> <span style="color: #a45bad;">None</span> <span style="color: #4f97d7; font-weight: bold;">else</span> np.random.rand(n_neurons)*0.1
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">activation</span> = activation
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">last_activation</span> = <span style="color: #a45bad;">None</span>
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">error</span> = <span style="color: #a45bad;">None</span>
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">delta</span> = <span style="color: #a45bad;">None</span>
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">activate</span>(<span style="color: #4f97d7; font-weight: bold;">self</span>,x):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">r</span> = np.dot(x, <span style="color: #4f97d7; font-weight: bold;">self</span>.weight)+<span style="color: #4f97d7; font-weight: bold;">self</span>.bias
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">last_activation</span> = <span style="color: #4f97d7; font-weight: bold;">self</span>._apply_activation(r)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #4f97d7; font-weight: bold;">self</span>.last_activation
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">_apply_activation</span>(<span style="color: #4f97d7; font-weight: bold;">self</span>, r):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">if</span> <span style="color: #4f97d7; font-weight: bold;">self</span>.activation <span style="color: #4f97d7; font-weight: bold;">is</span> <span style="color: #a45bad;">None</span>:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> r
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">elif</span> <span style="color: #4f97d7; font-weight: bold;">self</span>.activation == <span style="color: #2d9574;">'relu'</span>:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> np.maximum(r,0)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">elif</span> <span style="color: #4f97d7; font-weight: bold;">self</span>.activation == <span style="color: #2d9574;">'tanh'</span>:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> np.tanh(r)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">elif</span> <span style="color: #4f97d7; font-weight: bold;">self</span>.activation == <span style="color: #2d9574;">'sigmoid'</span>:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> 1/(1+np.exp(-r))
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> r
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">apply_activation_derivative</span>(<span style="color: #4f97d7; font-weight: bold;">self</span>, r):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">if</span> <span style="color: #4f97d7; font-weight: bold;">self</span>.activation <span style="color: #4f97d7; font-weight: bold;">is</span> <span style="color: #a45bad;">None</span>:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> np.ones_like(r)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">elif</span> <span style="color: #4f97d7; font-weight: bold;">self</span>.activation == <span style="color: #2d9574;">'relu'</span>:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">grad</span> = np.array(r, copy=<span style="color: #a45bad;">True</span>)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">grad</span>[r&gt;0] = 1.
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">grad</span>[r&lt;=0] =0.
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> grad
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">elif</span> <span style="color: #4f97d7; font-weight: bold;">self</span>.activation == <span style="color: #2d9574;">'tanh'</span>:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> 1-r**2
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">elif</span> <span style="color: #4f97d7; font-weight: bold;">self</span>.activation == <span style="color: #2d9574;">'sigmoid'</span>:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> r*(1-r)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> r

</pre>
</div>

<p>
generate the multi Layers Class NeuralNetwork
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">NeuralNetwork</span>:
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">__init__</span>(<span style="color: #4f97d7; font-weight: bold;">self</span>):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">self</span>.<span style="color: #7590db;">_layers</span> = []
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">add_layer</span>(<span style="color: #4f97d7; font-weight: bold;">self</span>, layer):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">self</span>._layers.append(layer)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">feed_forward</span>(<span style="color: #4f97d7; font-weight: bold;">self</span>, X):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> layer <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7; font-weight: bold;">self</span>._layers:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">X</span> = layer.activate(X)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> X

<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">backpropagation</span>(<span style="color: #4f97d7; font-weight: bold;">self</span>, X, y,learning_rate):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">output</span> = <span style="color: #4f97d7; font-weight: bold;">self</span>.feed_forward(X)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> i <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">reversed</span>(<span style="color: #4f97d7;">range</span>(<span style="color: #4f97d7;">len</span>(<span style="color: #4f97d7; font-weight: bold;">self</span>._layers))):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">layer</span> = <span style="color: #4f97d7; font-weight: bold;">self</span>._layers[i]
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">if</span> layer == <span style="color: #4f97d7; font-weight: bold;">self</span>._layers[-1]:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   layer.<span style="color: #7590db;">error</span> = y-output
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   layer.<span style="color: #7590db;">delta</span> = layer.error*layer.apply_activation_derivative(output)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">else</span>:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">next_layer</span> = <span style="color: #4f97d7; font-weight: bold;">self</span>._layers[i+1]
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   layer.<span style="color: #7590db;">error</span> = np.dot(next_layer.weights, next_layer.delta)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   layer.<span style="color: #7590db;">delta</span> = layer.error*layer.apply_activation_derivative(layer.last_activation)

<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> i <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(<span style="color: #4f97d7;">len</span>(<span style="color: #4f97d7; font-weight: bold;">self</span>._layers)):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">layer</span> = <span style="color: #4f97d7; font-weight: bold;">self</span>._layers[i]
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">o_i</span> = np.atleast_2d(X <span style="color: #4f97d7; font-weight: bold;">if</span> i == 0 <span style="color: #4f97d7; font-weight: bold;">else</span>  <span style="color: #4f97d7; font-weight: bold;">self</span>._layers[i-1].last_activation)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   layer.<span style="color: #7590db;">weights</span> += layer.delta*o_i.T*learning_rate


<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">train</span>(<span style="color: #4f97d7; font-weight: bold;">self</span>, X_train, X_test, y_train, y_test, learning_rate, max_epochs):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">y_onehot</span> = np.zeros((y_train.shape[0],2))
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   y_onehot[np.arange(y_train.shape[0]),y_train] =1
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">mses</span> = []
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> i <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(max_epochs):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> j <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(<span style="color: #4f97d7;">len</span>(X_train)):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">self</span>.backpropagation(X_train[j], y_onehot[j], learning_rate)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">if</span> i%10 == 0:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">mse</span> = np.mean(np.square(y_onehot - <span style="color: #4f97d7; font-weight: bold;">self</span>.feed_forward(X_train)))
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   mses.<span style="color: #4f97d7;">apply</span>(mse)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'Epoch : #%s, MSE: %f'</span> %(i, <span style="color: #4f97d7;">float</span>(mse)))
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">'Accuracy: %.2f%%'</span> %(<span style="color: #4f97d7; font-weight: bold;">self</span>.accuracy(<span style="color: #4f97d7; font-weight: bold;">self</span>.predict(X_test),y_test.flatten())*100))
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">return</span> mses


</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #7590db;">nn</span> = Neuralnetwork()
nn.add_layer(Layer (2, 25, <span style="color: #2d9574;">'sigmoid'</span>))
nn.add_layer(Layer(25, 50, <span style="color: #2d9574;">'sigmoid'</span>))
nn.add_layer(Layer(50, 25, <span style="color: #2d9574;">'sigmoid'</span>))
nn.add_layer(Layer(25, 2, <span style="color: #2d9574;">'sigmoid'</span>))
nn.backpropagation(X_train,y_train,0.001)
nn.train(X_train, X_test, y_train, y_test, 0.001,20)


</pre>
</div>

<p>
different Layers
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">for</span> n <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(5):
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">model</span> = Sequential()
<span style="background-color: #292e34;"> </span>   model.add(Dense(8,input_dim=2,activation=<span style="color: #2d9574;">'relu'</span>))
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">for</span> _ <span style="color: #4f97d7; font-weight: bold;">in</span> <span style="color: #4f97d7;">range</span>(n):
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   model.add(Dense(32,activation=<span style="color: #2d9574;">'relu'</span>))
<span style="background-color: #292e34;"> </span>   model.add(Dense(1,activation=<span style="color: #2d9574;">'sigmoid'</span>))
<span style="background-color: #292e34;"> </span>   model.<span style="color: #4f97d7;">compile</span>(loss=<span style="color: #2d9574;">'binary_crossentropy'</span>,optimizer=<span style="color: #2d9574;">'adam'</span>,metrics=[<span style="color: #2d9574;">'accuracy'</span>])
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">history</span> = model.fit(X_train,y_train,epochs = 20, verbose=1)
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">preds</span> = model.predict_classes(np.c_[XX.ravel(), YY_ravel()])
<span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">title</span> = <span style="color: #2d9574;">"&#32593;&#32476;&#23618;&#25968;({})"</span>.<span style="color: #4f97d7;">format</span>(n)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">file</span> = <span style="color: #2d9574;">"&#32593;&#32476;&#23481;&#37327; %f.png"</span> %(2+n*1)
<span style="background-color: #292e34;"> </span>   make_plot(X_train,y_train, title,<span style="color: #4f97d7;">file</span>,XX,YY,preds)


</pre>
</div>
</div>
</div>

<div id="outline-container-orga95bea1" class="outline-3">
<h3 id="orga95bea1"><span class="section-number-3">10.5.</span> Keras</h3>
<div class="outline-text-3" id="text-10-5">
</div>
<div id="outline-container-orgd556147" class="outline-4">
<h4 id="orgd556147"><span class="section-number-4">10.5.1.</span> tf.keras</h4>
<div class="outline-text-4" id="text-10-5-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">as</span> tf
<span style="color: #4f97d7; font-weight: bold;">from</span> tensorflow <span style="color: #4f97d7; font-weight: bold;">import</span> keras
<span style="color: #4f97d7; font-weight: bold;">from</span> tensorflow.keras <span style="color: #4f97d7; font-weight: bold;">import</span> layers

<span style="color: #7590db;">x</span> = tf.constant([2., 1., 0.1])
<span style="color: #4f97d7;">print</span>(tf.keras.layers.Softmax(axis=-1)(x))
<span style="color: #4f97d7;">print</span>(tf.nn.softmax(x))

</pre>
</div>

<p>
tf.keras.Model 是tf.keras.Sequential的父类(网络类）
Sequential类还有方法：
Sequential.compile()
Sequential.fit()
Sequential.predict()
</p>

<p>
tf.keras.layers.Layer 是网络层类的父类（网络层类）
</p>
</div>
</div>

<div id="outline-container-orgb953dd8" class="outline-4">
<h4 id="orgb953dd8"><span class="section-number-4">10.5.2.</span> 模型的保存和加载</h4>
<div class="outline-text-4" id="text-10-5-2">
</div>
<ol class="org-ol">
<li><a id="org80f039a"></a>保存数值<br />
<div class="outline-text-5" id="text-10-5-2-1">
<p>
Sequential.save<sub>weights</sub>('weights.ckpt')
重建了一样的网络后，重新加载
Sequential.load<sub>weights</sub>('weights.ckpt')
</p>
</div>
</li>
<li><a id="orgc3a68cf"></a>保存框架<br />
<div class="outline-text-5" id="text-10-5-2-2">
<p>
tf.keras.Sequential.save('model.h5')
不需要重构模型，可以直接生成保存的模型
network = tf.keras.models.load<sub>model</sub>('model.h5')
</p>
</div>
</li>
<li><a id="orga75c778"></a>跨系统平台保存恢复<br />
<div class="outline-text-5" id="text-10-5-2-3">
<p>
tf.saved<sub>model.save</sub>(network, 'model-savedmodel')
复制，分发该文件后，在跨平台上复现
network = tf.saved<sub>model.load</sub>('model-savedmodel')
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgf858045" class="outline-4">
<h4 id="orgf858045"><span class="section-number-4">10.5.3.</span> self-def</h4>
<div class="outline-text-4" id="text-10-5-3">
<p>
自定义网络层类，继承Layer
自定义网络类，继承Model
</p>
</div>
</div>
</div>

<div id="outline-container-orged73fd1" class="outline-3">
<h3 id="orged73fd1"><span class="section-number-3">10.6.</span> Dropout</h3>
<div class="outline-text-3" id="text-10-6">
<p>
tf.nn.dropout(x, rate = 0.5)
model.add(layers.Dropout(rate=0.5))
</p>
</div>
</div>
<div id="outline-container-org95601ef" class="outline-3">
<h3 id="org95601ef"><span class="section-number-3">10.7.</span> Data Augmentation</h3>
<div class="outline-text-3" id="text-10-7">
</div>
<div id="outline-container-org6482b98" class="outline-4">
<h4 id="org6482b98"><span class="section-number-4">10.7.1.</span> resize</h4>
<div class="outline-text-4" id="text-10-7-1">
<p>
tf.image.resize(x,[244,244])
</p>
</div>
</div>
<div id="outline-container-orgc396477" class="outline-4">
<h4 id="orgc396477"><span class="section-number-4">10.7.2.</span> rote</h4>
<div class="outline-text-4" id="text-10-7-2">
<p>
tf.image.rot90(x,1) k为1时，代表一个90度的g逆时针旋转
</p>
</div>
</div>
<div id="outline-container-orge044106" class="outline-4">
<h4 id="orge044106"><span class="section-number-4">10.7.3.</span> flip</h4>
<div class="outline-text-4" id="text-10-7-3">
<p>
tf.image.random<sub>flip</sub><sub>left</sub><sub>right</sub>(x)
tf.image.random<sub>flip</sub><sub>up</sub><sub>down</sub>(x)
</p>
</div>
</div>
<div id="outline-container-org3731d69" class="outline-4">
<h4 id="org3731d69"><span class="section-number-4">10.7.4.</span> crop</h4>
<div class="outline-text-4" id="text-10-7-4">
<p>
先放大，再剪裁
tf.image.resize(x,[244,244])
tf.image.random<sub>crop</sub>(x,[224,224,3])
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org1e5a7e3" class="outline-2">
<h2 id="org1e5a7e3"><span class="section-number-2">11.</span> IDE</h2>
<div class="outline-text-2" id="text-11">
</div>
<div id="outline-container-org1b8b6ab" class="outline-3">
<h3 id="org1b8b6ab"><span class="section-number-3">11.1.</span> emacs</h3>
</div>
<div id="outline-container-orgd97ba9d" class="outline-3">
<h3 id="orgd97ba9d"><span class="section-number-3">11.2.</span> Pycharm</h3>
<div class="outline-text-3" id="text-11-2">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">M-1</td>
<td class="org-left">open projects</td>
</tr>

<tr>
<td class="org-left">C-M-c</td>
<td class="org-left">collapse 折叠代码</td>
</tr>

<tr>
<td class="org-left">C-M-e</td>
<td class="org-left">expand  打开代码</td>
</tr>

<tr>
<td class="org-left">C-M-s</td>
<td class="org-left">open Settings</td>
</tr>

<tr>
<td class="org-left">C-S-+</td>
<td class="org-left">increasing fonts</td>
</tr>

<tr>
<td class="org-left">C-S+-</td>
<td class="org-left">decreasing fonts</td>
</tr>

<tr>
<td class="org-left">C-S-0</td>
<td class="org-left">reset fonts</td>
</tr>

<tr>
<td class="org-left">S-Esc</td>
<td class="org-left">close</td>
</tr>

<tr>
<td class="org-left">S-tab</td>
<td class="org-left">open in Emacs</td>
</tr>

<tr>
<td class="org-left">S-Enter</td>
<td class="org-left">execute/run</td>
</tr>

<tr>
<td class="org-left">C-S-i</td>
<td class="org-left">go to define file</td>
</tr>

<tr>
<td class="org-left">C-M-l</td>
<td class="org-left">show line</td>
</tr>

<tr>
<td class="org-left">C-F12</td>
<td class="org-left">close main bar</td>
</tr>

<tr>
<td class="org-left">C-M-x</td>
<td class="org-left">exit</td>
</tr>

<tr>
<td class="org-left">C-A-[]</td>
<td class="org-left">change in between opened projects</td>
</tr>

<tr>
<td class="org-left">C-ins</td>
<td class="org-left">in project add a new file</td>
</tr>

<tr>
<td class="org-left">C-c C-p</td>
<td class="org-left">execute python file</td>
</tr>

<tr>
<td class="org-left">C-c C-o</td>
<td class="org-left">close (python) tab</td>
</tr>

<tr>
<td class="org-left">f11</td>
<td class="org-left">Full screen</td>
</tr>

<tr>
<td class="org-left">A-.</td>
<td class="org-left">open the relate source file</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org39dc3b1" class="outline-3">
<h3 id="org39dc3b1"><span class="section-number-3">11.3.</span> jupyter</h3>
<div class="outline-text-3" id="text-11-3">
<div class="org-src-container">
<pre class="src src-sh">sudo apt install jupyter
sudo apt install jupyter lab
pip install jupyterthemes
jt -t monokai -f fira -fs 13 -nf ptsans -nfs 11 -N -kl -cursw 5 -cursc r -cellw 95% -T

</pre>
</div>
<p>
Helf -&gt; edit shortcut
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">j</td>
<td class="org-left">next cell</td>
</tr>

<tr>
<td class="org-left">k</td>
<td class="org-left">previous cell</td>
</tr>

<tr>
<td class="org-left">f</td>
<td class="org-left">pull the cell to the top</td>
</tr>

<tr>
<td class="org-left">i</td>
<td class="org-left">intercept cell</td>
</tr>

<tr>
<td class="org-left">c</td>
<td class="org-left">clear results</td>
</tr>

<tr>
<td class="org-left">space</td>
<td class="org-left">next site</td>
</tr>

<tr>
<td class="org-left">ctrl space</td>
<td class="org-left">previous site</td>
</tr>

<tr>
<td class="org-left">ctrl enter</td>
<td class="org-left">execute and to the next cell</td>
</tr>

<tr>
<td class="org-left">C-M-m</td>
<td class="org-left">close mainbar</td>
</tr>

<tr>
<td class="org-left">C-M-n</td>
<td class="org-left">close toolbar</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org43629be" class="outline-2">
<h2 id="org43629be"><span class="section-number-2">12.</span> Flask</h2>
<div class="outline-text-2" id="text-12">
<p>
open development and debug mode
</p>
<pre class="example">
export FLASK_APP=app
export FLASK_DEBUG=1
export FLASK_ENV=development
flask run

</pre>
</div>
</div>

<div id="outline-container-orgde6337a" class="outline-2">
<h2 id="orgde6337a"><span class="section-number-2">13.</span> Django</h2>
<div class="outline-text-2" id="text-13">
</div>
<div id="outline-container-org263cab8" class="outline-3">
<h3 id="org263cab8"><span class="section-number-3">13.1.</span> deployment</h3>
<div class="outline-text-3" id="text-13-1">
<ul class="org-ul">
<li>null=True
if allow this to be empty in the input interface</li>
<li>blank=True
if it's empty from the interface, if set it to be NULL(not good for strings filed)</li>
</ul>
</div>
</div>
</div>




<div id="outline-container-org4b5be08" class="outline-2">
<h2 id="org4b5be08"><span class="section-number-2">14.</span> Golab notebook with Vim</h2>
<div class="outline-text-2" id="text-14">
<ol class="org-ol">
<li><p>
Cell model
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">j/k  C-n/C-p</td>
<td class="org-left">Cell之间上下移动</td>
</tr>

<tr>
<td class="org-left">Enter</td>
<td class="org-left">to normal model or insert model</td>
</tr>
</tbody>
</table></li>

<li><p>
Normal Model
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">M-n/M-p</td>
<td class="org-left">Cell 之间上下移动</td>
</tr>

<tr>
<td class="org-left">Markdown</td>
<td class="org-left">双击右边的视图回到Cell model</td>
</tr>

<tr>
<td class="org-left">Code</td>
<td class="org-left">点击左边执行框内阴影回到Cell model</td>
</tr>

<tr>
<td class="org-left">i</td>
<td class="org-left">to insert model</td>
</tr>
</tbody>
</table></li>
<li><p>
Insert model
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Up/Down</td>
<td class="org-left">行之间上下移动</td>
</tr>

<tr>
<td class="org-left">C-Left/C-right</td>
<td class="org-left">词语之间左右移动</td>
</tr>

<tr>
<td class="org-left">M-Up/M-Down</td>
<td class="org-left">行的上下互换</td>
</tr>

<tr>
<td class="org-left">Markdown</td>
<td class="org-left">双击右边的视图回到Cell model</td>
</tr>

<tr>
<td class="org-left">Code</td>
<td class="org-left">点击左边执行框内阴影回到Cell model</td>
</tr>
</tbody>
</table></li>
</ol>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">w</td>
<td class="org-left">next word front</td>
</tr>

<tr>
<td class="org-left">b</td>
<td class="org-left">previous word front</td>
</tr>

<tr>
<td class="org-left">e</td>
<td class="org-left">end of word</td>
</tr>

<tr>
<td class="org-left">i</td>
<td class="org-left">insert front word</td>
</tr>

<tr>
<td class="org-left">I</td>
<td class="org-left">insert front line</td>
</tr>

<tr>
<td class="org-left">a</td>
<td class="org-left">insert end word</td>
</tr>

<tr>
<td class="org-left">A</td>
<td class="org-left">insert end line</td>
</tr>

<tr>
<td class="org-left">o</td>
<td class="org-left">insert line up</td>
</tr>

<tr>
<td class="org-left">O</td>
<td class="org-left">insert line down</td>
</tr>

<tr>
<td class="org-left">u</td>
<td class="org-left">redo</td>
</tr>

<tr>
<td class="org-left">x</td>
<td class="org-left">delete char</td>
</tr>

<tr>
<td class="org-left">y</td>
<td class="org-left">copy</td>
</tr>

<tr>
<td class="org-left">yy</td>
<td class="org-left">copy line</td>
</tr>

<tr>
<td class="org-left">d</td>
<td class="org-left">delete</td>
</tr>

<tr>
<td class="org-left">dd</td>
<td class="org-left">delete line</td>
</tr>

<tr>
<td class="org-left">p</td>
<td class="org-left">pasta</td>
</tr>

<tr>
<td class="org-left">gg</td>
<td class="org-left">document begin</td>
</tr>

<tr>
<td class="org-left">G</td>
<td class="org-left">document end</td>
</tr>
</tbody>
</table>
</div>
</div>



<div id="outline-container-org80c4002" class="outline-2">
<h2 id="org80c4002"><span class="section-number-2">15.</span> test</h2>
<div class="outline-text-2" id="text-15">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">import</span> os
os.system(<span style="color: #2d9574;">"ls -l"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orga438ad4" class="outline-2">
<h2 id="orga438ad4"><span class="section-number-2">16.</span> Exception</h2>
<div class="outline-text-2" id="text-16">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">example1</span>():
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"example 01"</span>)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">try</span>:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #7590db;">a</span> = 10 / 0
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">except</span> <span style="color: #ce537a; font-weight: bold;">ZeroDivisionError</span> <span style="color: #4f97d7; font-weight: bold;">as</span> e:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"catched"</span>)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">raise</span> <span style="color: #ce537a; font-weight: bold;">RuntimeError</span>(<span style="color: #2d9574;">"Runtime error"</span>) <span style="color: #4f97d7; font-weight: bold;">from</span> e
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">except</span> <span style="color: #ce537a; font-weight: bold;">Exception</span> <span style="color: #4f97d7; font-weight: bold;">as</span> e:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(e.__class__.<span style="color: #4f97d7;">__name__</span>)

<span style="color: #4f97d7; font-weight: bold;">def</span> <span style="color: #bc6ec5; font-weight: bold;">call</span>():
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">try</span>:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   example1()
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">except</span> <span style="color: #ce537a; font-weight: bold;">RuntimeError</span> <span style="color: #4f97d7; font-weight: bold;">as</span> e:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(e.__class__.<span style="color: #4f97d7;">__name__</span>)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(e.args)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(<span style="color: #2d9574;">"Runtime Error"</span>)
<span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7; font-weight: bold;">except</span> <span style="color: #ce537a; font-weight: bold;">Exception</span> <span style="color: #4f97d7; font-weight: bold;">as</span> e:
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(e.__class__.<span style="color: #4f97d7;">__name__</span>)
<span style="background-color: #292e34;"> </span>   <span style="background-color: #292e34;"> </span>   <span style="color: #4f97d7;">print</span>(e.args)

call()

</pre>
</div>




<p>
.env not be share
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: si</p>
<p class="date">Created: 2025-01-24 Fr 19:48</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
