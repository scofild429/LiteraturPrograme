<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-11-04 Di 00:40 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>k8s</title>
<meta name="author" content="Silin Zhao" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/code-copy.css"/>
<link rel="stylesheet" type="text/css" href="src/readtheorg_theme/css/search.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/search.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/code-copy.js"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">k8s</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orga0489e7">1. Docker</a>
<ul>
<li><a href="#org23125cf">1.1. pull</a></li>
<li><a href="#org55ee176">1.2. build</a></li>
<li><a href="#org63823c7">1.3. tag</a></li>
<li><a href="#org16b1809">1.4. Microservices</a></li>
</ul>
</li>
<li><a href="#orgba79655">2. Dokcerfile</a>
<ul>
<li><a href="#org877b1a3">2.1. EXPOSE</a></li>
<li><a href="#orgaad7940">2.2. CMD echo "Hello World" &amp;&amp; CMD ["echo", "Hello World"]</a></li>
<li><a href="#org5ebdf23">2.3. ENTRYPORT</a></li>
<li><a href="#org25739a1">2.4. Docker's multi-stage</a></li>
</ul>
</li>
<li><a href="#org3b60e8b">3. Kubernetes</a>
<ul>
<li><a href="#org351a7e9">3.1. Pod</a></li>
<li><a href="#org4c2abb3">3.2. Labels</a></li>
<li><a href="#org61f06fe">3.3. Selectors</a>
<ul>
<li><a href="#orgf90608b">3.3.1. Equality-Based</a></li>
<li><a href="#org35d17e0">3.3.2. Set-Based</a></li>
</ul>
</li>
<li><a href="#org5e4d4ba">3.4. ReplicationController</a></li>
<li><a href="#org4e409bb">3.5. ReplicaSet</a></li>
<li><a href="#org52180f3">3.6. Deployment</a>
<ul>
<li><a href="#org1c6b6e2">3.6.1. Annotation</a></li>
</ul>
</li>
<li><a href="#org17e154b">3.7. Service</a>
<ul>
<li><a href="#org269d8cf">3.7.1. ClusterIP</a></li>
<li><a href="#orge4fdeb3">3.7.2. NordPort</a></li>
<li><a href="#orga33be7f">3.7.3. Loadbalance</a></li>
<li><a href="#org61365ad">3.7.4. ExternalName</a></li>
</ul>
</li>
<li><a href="#org4208630">3.8. Manual scheduling</a></li>
<li><a href="#org0de13f7">3.9. Static pods</a></li>
<li><a href="#org13b27e7">3.10. Node Selector</a>
<ul>
<li><a href="#org1099e8d">3.10.1. label: Apply label to node</a></li>
<li><a href="#org24ae3b6">3.10.2. selector apply to pod/Deployment</a></li>
<li><a href="#org6f3783f">3.10.3. Takeaway: Pure lebel matching mechanismus,l ack of flexibility, only with key-value matching selection</a></li>
</ul>
</li>
<li><a href="#org531e10a">3.11. Taints and Tolerations</a>
<ul>
<li><a href="#org4c1df54">3.11.1. Taints Apply to node</a></li>
<li><a href="#orgdf8114e">3.11.2. Toleration Apply to pod</a></li>
<li><a href="#org7163c97">3.11.3. Takeaway: Lebel matching with hardness configuation, NoExecute supports re-evaluation. If a node’s taints change and a pod doesn’t tolerate them, it will be evicted</a></li>
</ul>
</li>
<li><a href="#orgdd4aed1">3.12. Node Affinity</a>
<ul>
<li><a href="#org85984b3">3.12.1. Takeaway: The most flexible way to optimize the resource utilization</a></li>
</ul>
</li>
<li><a href="#orge5091f3">3.13. Request and limits</a>
<ul>
<li><a href="#org8d5e11e">3.13.1. Monitoring</a></li>
</ul>
</li>
<li><a href="#orgcd2f715">3.14. Scaling</a>
<ul>
<li><a href="#orgdc50ecc">3.14.1. Horizontal Scaling</a></li>
<li><a href="#orga43bdda">3.14.2. Vertical Scaling</a></li>
<li><a href="#org90b4fb1">3.14.3. Node side</a></li>
</ul>
</li>
<li><a href="#org23d3611">3.15. Horizontal Pod Autoscaler (HPA)</a></li>
<li><a href="#org18f4d15">3.16. namespace</a></li>
<li><a href="#org01054f1">3.17. Vertical Pod Autoscaler (VPA)</a></li>
<li><a href="#org2643b05">3.18. Multi-container pods</a>
<ul>
<li><a href="#org09a0464">3.18.1. Init Containers</a></li>
<li><a href="#orgbef37bd">3.18.2. Sidecar Pattern</a></li>
<li><a href="#orgc37f746">3.18.3. Ambassador Pattern</a></li>
<li><a href="#orge8446fa">3.18.4. Adapter Pattern</a></li>
</ul>
</li>
<li><a href="#orgd329ac1">3.19. Pod Policies</a>
<ul>
<li><a href="#org8ae1b9d">3.19.1. Delete policies</a></li>
<li><a href="#org042ac3d">3.19.2. Restart Policies</a></li>
<li><a href="#org30e9ab9">3.19.3. Image Pull Policies</a></li>
<li><a href="#org6d84fc4">3.19.4. Pod Lifecycle and debugging see Day 22</a></li>
</ul>
</li>
<li><a href="#orgc1d5149">3.20. health probes</a>
<ul>
<li><a href="#orgdd82c11">3.20.1. Readiness Probes</a></li>
<li><a href="#orgb38c005">3.20.2. Liveness Probes</a></li>
<li><a href="#org84d9a62">3.20.3. Startup Probes</a></li>
</ul>
</li>
<li><a href="#org86b96be">3.21. Ephemeral Storage</a>
<ul>
<li><a href="#org3360ce9">3.21.1. emptyDir</a></li>
<li><a href="#org4cf7667">3.21.2. Downward API</a></li>
</ul>
</li>
<li><a href="#orgc8f9cde">3.22. Volume</a>
<ul>
<li><a href="#orgc7e042e">3.22.1. PV vs PVC</a></li>
<li><a href="#org5ad1643">3.22.2. hostPath</a></li>
<li><a href="#orgdc8dc4e">3.22.3. storageClassName</a></li>
<li><a href="#orgf1ac4f2">3.22.4. volumeName</a></li>
<li><a href="#org092840e">3.22.5. usage</a></li>
</ul>
</li>
<li><a href="#orgd7e4b99">3.23. Matrics server</a></li>
<li><a href="#org2e25486">3.24. selector</a></li>
<li><a href="#org0a194c3">3.25. nodeAffinity</a></li>
<li><a href="#org5bac9ac">3.26. networkPolicy</a></li>
<li><a href="#org8611e41">3.27. update and rollback</a>
<ul>
<li><a href="#org8768d60">3.27.1. 1. create the deployment and  add description in metadata</a></li>
<li><a href="#orgd02c3d3">3.27.2. 2. make change</a></li>
<li><a href="#orgb9f25d5">3.27.3. 3. rollback to wanted version and check again</a></li>
<li><a href="#org368651f">3.27.4. 4. clean</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org20beb78">4. Kubectl imperative</a>
<ul>
<li><a href="#org047a513">4.1. Deployment</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-orga0489e7" class="outline-2">
<h2 id="orga0489e7"><span class="section-number-2">1.</span> Docker</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org23125cf" class="outline-3">
<h3 id="org23125cf"><span class="section-number-3">1.1.</span> pull</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Docker daemon prefixes docker.io/library/ for default images on Docker Hub when no registry is specified
</p>
</div>
</div>
<div id="outline-container-org55ee176" class="outline-3">
<h3 id="org55ee176"><span class="section-number-3">1.2.</span> build</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">
<pre class="src src-nil">docker build -t name:tag .
docker build -t entry-image -f /path/to/custom-dockerfile /path/to/build-context
</pre>
</div>
<p>
-t:  Name and optionally a tag (format: "name:tag")
</p>
<ul class="org-ul">
<li>ADD and COPY can only access files within the build context specified in the docker build command (e.g., /path/to/build-context). Files outside the build context cannot be directly referenced in the Dockerfile.</li>
</ul>
</div>
</div>
<div id="outline-container-org63823c7" class="outline-3">
<h3 id="org63823c7"><span class="section-number-3">1.3.</span> tag</h3>
<div class="outline-text-3" id="text-1-3">
<div class="org-src-container">
<pre class="src src-nil">docker tag my-current-image:tag my-username-in-dockerhub/my-wanted-image-name:mytag
docker push my-current-image:tag my-username-in-dockerhub/my-wanted-image-name:mytag
</pre>
</div>
<p>
tag change the name(with dockerhub name) and the tag for pushing
</p>
</div>
</div>
<div id="outline-container-org16b1809" class="outline-3">
<h3 id="org16b1809"><span class="section-number-3">1.4.</span> Microservices</h3>
<div class="outline-text-3" id="text-1-4">
<ul class="org-ul">
<li>Scalability	Each microservice can scale independently based on demand.</li>
<li>Fault Isolation	Failure in one service does not crash the entire application.</li>
<li>Faster Deployment	Teams can deploy and update services independently.</li>
<li>Technology Flexibility	Different services can use different programming languages.</li>
<li>Easier Maintenance	Smaller codebases are easier to manage and debug.</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgba79655" class="outline-2">
<h2 id="orgba79655"><span class="section-number-2">2.</span> Dokcerfile</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org877b1a3" class="outline-3">
<h3 id="org877b1a3"><span class="section-number-3">2.1.</span> EXPOSE</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Missing EXPOSE 5000 won’t break your setup if you explicitly map ports with -p 80:5000. It’s primarily a documentation and automation feature. For clarity and best practices, include EXPOSE 5000 in your Dockerfile to indicate the port your application uses.
</p>
</div>
</div>
<div id="outline-container-orgaad7940" class="outline-3">
<h3 id="orgaad7940"><span class="section-number-3">2.2.</span> CMD echo "Hello World" &amp;&amp; CMD ["echo", "Hello World"]</h3>
<div class="outline-text-3" id="text-2-2">
<ul class="org-ul">
<li>CMD echo "Hello World":  start a shell and run the command, with shell features</li>
<li>CMD ["echo", "Hello World"]:  run the command directly, withour to start a shell</li>
<li>CMD: can be easyly overridden by docker run &#x2026;</li>
</ul>
</div>
</div>
<div id="outline-container-org5ebdf23" class="outline-3">
<h3 id="org5ebdf23"><span class="section-number-3">2.3.</span> ENTRYPORT</h3>
<div class="outline-text-3" id="text-2-3">
<ul class="org-ul">
<li>Can only be explicitly overridden by docker run &#x2026; &#x2013;entryport &#x2026;</li>
<li>Implicity run without &#x2013;entryport  after docker run&#x2026; will append arguments at end</li>
</ul>
</div>
</div>
<div id="outline-container-org25739a1" class="outline-3">
<h3 id="org25739a1"><span class="section-number-3">2.4.</span> Docker's multi-stage</h3>
<div class="outline-text-3" id="text-2-4">
<p>
builds offer a powerful way to manage production environments by separating build and runtime stages, ensuring smaller images, faster deployments, and enhanced security.
</p>
</div>
</div>
</div>
<div id="outline-container-org3b60e8b" class="outline-2">
<h2 id="org3b60e8b"><span class="section-number-2">3.</span> Kubernetes</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org351a7e9" class="outline-3">
<h3 id="org351a7e9"><span class="section-number-3">3.1.</span> Pod</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Basic Pod-Related Commands
</p>
<ul class="org-ul">
<li>Create a Pod: kubectl apply -f pod.yaml</li>
<li>List all Pods: kubectl get pods</li>
<li>List Pods with details: kubectl get pods -o wide</li>
<li>Describe a Pod: kubectl describe pod &lt;pod-name&gt;</li>
<li>View Pod logs: kubectl logs &lt;pod-name&gt;</li>
<li>View logs for a specific container: kubectl logs &lt;pod-name&gt; -c &lt;container-name&gt;</li>
<li>Stream live Pod logs: kubectl logs -f &lt;pod-name&gt;</li>
<li>Execute a command in a Pod: kubectl exec -it &lt;pod-name&gt; &#x2013; /bin/bash</li>
<li>Execute a command in a specific container: kubectl exec -it &lt;pod-name&gt; -c &lt;container-name&gt; &#x2013; /bin/bash</li>
<li>Delete a Pod: kubectl delete pod &lt;pod-name&gt;</li>
</ul>
</div>
</div>
<div id="outline-container-org4c2abb3" class="outline-3">
<h3 id="org4c2abb3"><span class="section-number-3">3.2.</span> Labels</h3>
<div class="outline-text-3" id="text-3-2">
<ul class="org-ul">
<li>Labels: Key-value pairs attached to Kubernetes objects like pods, enabling logical grouping and selection.</li>

<li>Kubernetes Features That Use Labels and Selectors:
<ul class="org-ul">
<li>ReplicationController,</li>
<li>ReplicaSet,</li>
<li>Deployments,</li>
<li>StatefulSets,</li>
<li>DaemonSets,</li>
<li>Services,</li>
<li>Jobs,</li>
<li>CronJobs,</li>
<li>and NetworkPolicies.</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org61f06fe" class="outline-3">
<h3 id="org61f06fe"><span class="section-number-3">3.3.</span> Selectors</h3>
<div class="outline-text-3" id="text-3-3">
<ul class="org-ul">
<li>Selectors: Expressions or equality-based filters used to match objects based on their labels, enabling precise control over resource management.</li>
<li>It only apply to the Pod level(Node or Service), not to the container level</li>
</ul>
</div>
<div id="outline-container-orgf90608b" class="outline-4">
<h4 id="orgf90608b"><span class="section-number-4">3.3.1.</span> Equality-Based</h4>
<div class="outline-text-4" id="text-3-3-1">
<p>
for
</p>
<ul class="org-ul">
<li>rc,</li>
<li>rs,</li>
<li><p>
deployment
</p>
<div class="org-src-container">
<pre class="src src-nil">selector:
  matchLabels:
    app: nginx
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org35d17e0" class="outline-4">
<h4 id="org35d17e0"><span class="section-number-4">3.3.2.</span> Set-Based</h4>
<div class="outline-text-4" id="text-3-3-2">
<ul class="org-ul">
<li>for rs, and deloyment</li>
<li><p>
usign: In, NotIn, Exists, DoesNotExist
</p>
<div class="org-src-container">
<pre class="src src-nil">selector:
  matchExpressions:
    - key: app
      operator: In
      values:
        - nginx
        - apache
    - key: environment
      operator: NotIn
      values:
        - development
    - key: tier
      operator: Exists
    - key: debug
      operator: DoesNotExist
</pre>
</div></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org5e4d4ba" class="outline-3">
<h3 id="org5e4d4ba"><span class="section-number-3">3.4.</span> ReplicationController</h3>
<div class="outline-text-3" id="text-3-4">
<ul class="org-ul">
<li>Ensures a specified number of pod replicas are running at any given time</li>
</ul>
</div>
</div>
<div id="outline-container-org4e409bb" class="outline-3">
<h3 id="org4e409bb"><span class="section-number-3">3.5.</span> ReplicaSet</h3>
<div class="outline-text-3" id="text-3-5">
<ul class="org-ul">
<li>ReplicaSet is an improved version of ReplicationController.</li>
<li>It supports set-based selectors, providing more flexibility in managing pods.</li>
<li>ReplicaSets are often managed by Deployments, which add advanced capabilities.</li>
</ul>
</div>
</div>
<div id="outline-container-org52180f3" class="outline-3">
<h3 id="org52180f3"><span class="section-number-3">3.6.</span> Deployment</h3>
<div class="outline-text-3" id="text-3-6">
<ul class="org-ul">
<li>build on top of ReplicaSets, with rolling update and rollbacks, automated update, scaling and simplified management</li>
</ul>
</div>
<div id="outline-container-org1c6b6e2" class="outline-4">
<h4 id="org1c6b6e2"><span class="section-number-4">3.6.1.</span> Annotation</h4>
<div class="outline-text-4" id="text-3-6-1">
<p>
<b>A</b>: 
</p>
<div class="org-src-container">
<pre class="src src-nil">apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kubernetes.io/change-cause: "Initial release with nginx 1.19"
  name: nginx-deployment
spec:
  ....
</pre>
</div>

<p>
<b>B</b>: 
after applying the file and check the annoation
</p>
<div class="org-src-container">
<pre class="src src-nil">kubectl rollout history deployment nginx-deployment
</pre>
</div>
<p>
I would able to see the default annotation.
</p>

<p>
<b>C</b>:
Then I can update my container for next version(only for deployment, not rc and rs)
</p>
<div class="org-src-container">
<pre class="src src-nil">kubectl set image deployment nginx-deployment nginx-container=nginx:1.20
</pre>
</div>
<p>
and set new annotation with
</p>
<div class="org-src-container">
<pre class="src src-nil">kubectl annotate deployments nginx-deployment kubernetes.io/change-cause="Upgraded my container"
</pre>
</div>
<p>
OR modify my Deployment manifest and apply.
Now verify the history with
</p>
<div class="org-src-container">
<pre class="src src-nil">kubectl rollout history deployment nginx-deployment
</pre>
</div>


<p>
<b>D</b>:
rollback to special version with
</p>
<div class="org-src-container">
<pre class="src src-nil">kubectl rollout undo deployment nginx-deployment --to-revision=1
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org17e154b" class="outline-3">
<h3 id="org17e154b"><span class="section-number-3">3.7.</span> Service</h3>
<div class="outline-text-3" id="text-3-7">
<ul class="org-ul">
<li>A fixed IP and DNS name so that pods can always be found, even if their individual IPs change.</li>
<li>Load balancing across multiple pod replicas to distribute traffic evenly.</li>
<li>Internal and external communication</li>
</ul>
</div>
<div id="outline-container-org269d8cf" class="outline-4">
<h4 id="org269d8cf"><span class="section-number-4">3.7.1.</span> ClusterIP</h4>
</div>

<div id="outline-container-orge4fdeb3" class="outline-4">
<h4 id="orge4fdeb3"><span class="section-number-4">3.7.2.</span> NordPort</h4>
</div>
<div id="outline-container-orga33be7f" class="outline-4">
<h4 id="orga33be7f"><span class="section-number-4">3.7.3.</span> Loadbalance</h4>
</div>
<div id="outline-container-org61365ad" class="outline-4">
<h4 id="org61365ad"><span class="section-number-4">3.7.4.</span> ExternalName</h4>
</div>
</div>
<div id="outline-container-org4208630" class="outline-3">
<h3 id="org4208630"><span class="section-number-3">3.8.</span> Manual scheduling</h3>
<div class="outline-text-3" id="text-3-8">
<ul class="org-ul">
<li>Explicitly assigning a pod to a node using the nodeName field in the pod’s YAML manifest</li>
</ul>
<div class="org-src-container">
<pre class="src src-nil">apiVersion: v1
kind: Pod
metadata:
  name: nginx-manual
spec:
  nodeName: my-second-cluster-worker2  # Assign pod to a specific worker node
  containers:
    - name: nginx
      image: nginx
</pre>
</div>
</div>
</div>
<div id="outline-container-org0de13f7" class="outline-3">
<h3 id="org0de13f7"><span class="section-number-3">3.9.</span> Static pods</h3>
<div class="outline-text-3" id="text-3-9">
<ul class="org-ul">
<li>Static pods are defined in <i>etc/kubernetes/manifests</i> and  not managed by the Kubernetes API server</li>
<li>To ensure visibility in kubectl get pods, Kubelet creates a read-only "mirror pod" on the API server</li>
</ul>
</div>
</div>
<div id="outline-container-org13b27e7" class="outline-3">
<h3 id="org13b27e7"><span class="section-number-3">3.10.</span> Node Selector</h3>
<div class="outline-text-3" id="text-3-10">
</div>
<div id="outline-container-org1099e8d" class="outline-4">
<h4 id="org1099e8d"><span class="section-number-4">3.10.1.</span> label: Apply label to node</h4>
<div class="outline-text-4" id="text-3-10-1">
<div class="org-src-container">
<pre class="src src-nil">kubectl label nodes my-second-cluster-worker storage=ssd
kubectl label nodes my-second-cluster-worker storage-
</pre>
</div>
</div>
</div>
<div id="outline-container-org24ae3b6" class="outline-4">
<h4 id="org24ae3b6"><span class="section-number-4">3.10.2.</span> selector apply to pod/Deployment</h4>
<div class="outline-text-4" id="text-3-10-2">
<div class="org-src-container">
<pre class="src src-nil">apiVersion: apps/v1
kind: Deployment
metadata:
  name: ns-deploy
spec:
  replicas: 3
  selector:
    matchLabels:
      app: app1
  template:
    metadata:
      labels:
        app: app1
    spec:
      nodeSelector:
        storage: ssd
      containers:
        - name: nginx
          image: nginx
</pre>
</div>

<ul class="org-ul">
<li>A node can have multiple labels. A pod will only be scheduled if all labels in nodeSelector match.</li>
</ul>
</div>
</div>
<div id="outline-container-org6f3783f" class="outline-4">
<h4 id="org6f3783f"><span class="section-number-4">3.10.3.</span> Takeaway: Pure lebel matching mechanismus,l ack of flexibility, only with key-value matching selection</h4>
</div>
</div>
<div id="outline-container-org531e10a" class="outline-3">
<h3 id="org531e10a"><span class="section-number-3">3.11.</span> Taints and Tolerations</h3>
<div class="outline-text-3" id="text-3-11">
<ul class="org-ul">
<li>Taints and Tolerations help control which pods can be scheduled on which nodes</li>
<li>Taints and tolerations are applied during scheduling</li>
</ul>
</div>
<div id="outline-container-org4c1df54" class="outline-4">
<h4 id="org4c1df54"><span class="section-number-4">3.11.1.</span> Taints Apply to node</h4>
<div class="outline-text-4" id="text-3-11-1">
<div class="org-src-container">
<pre class="src src-nil">kubectl taint nodes my-second-cluster-worker storage=ssd:NoSchedule
kubectl taint nodes my-second-cluster-worker2 storage=hdd:NoSchedule
kubectl taint nodes my-second-cluster-worker storage=ssd:NoSchedule-  
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Effect</th>
<th scope="col" class="org-left">Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">NoSchedule</td>
<td class="org-left">New pods will not be scheduled unless they have a matching toleration.</td>
</tr>

<tr>
<td class="org-left">PreferNoSchedule</td>
<td class="org-left">Kubernetes tries to avoid scheduling pods but doesn’t enforce it strictly.</td>
</tr>

<tr>
<td class="org-left">NoExecute</td>
<td class="org-left">Existing pods without a matching toleration will be evicted from the node.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orgdf8114e" class="outline-4">
<h4 id="orgdf8114e"><span class="section-number-4">3.11.2.</span> Toleration Apply to pod</h4>
<div class="outline-text-4" id="text-3-11-2">
<div class="org-src-container">
<pre class="src src-nil">tolerations:
- key: "storage"
  operator: "Equal"
  value: "ssd"
  effect: "NoSchedule"
</pre>
</div>

<ul class="org-ul">
<li>This tolerates nodes that have the taint storage=ssd:NoSchedule, allowing the pod to be scheduled on them.</li>
<li>The Effect in the toleration must match the Effect in the taint for it to take effect.</li>
</ul>
</div>
</div>
<div id="outline-container-org7163c97" class="outline-4">
<h4 id="org7163c97"><span class="section-number-4">3.11.3.</span> Takeaway: Lebel matching with hardness configuation, NoExecute supports re-evaluation. If a node’s taints change and a pod doesn’t tolerate them, it will be evicted</h4>
</div>
</div>
<div id="outline-container-orgdd4aed1" class="outline-3">
<h3 id="orgdd4aed1"><span class="section-number-3">3.12.</span> Node Affinity</h3>
<div class="outline-text-3" id="text-3-12">
<ul class="org-ul">
<li>requiredDuringSchedulingIgnoredDuringExecution: Hard rule, must match</li>
<li>preferredDuringSchedulingIgnoredDuringExecution: Soft rule, NOT must</li>
<li>node labels are the same with node selector</li>
<li>all requests from matchExpressions need to be filled</li>
</ul>
<div class="org-src-container">
<pre class="src src-nil">apiVersion: apps/v1
kind: Deployment
metadata:
  name: preferred-na-deploy
spec:
  replicas: 5
  selector:
    matchLabels:
      app: app1
  template:
    metadata:
      labels:
        app: app1
    spec:
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: storage
                operator: In
                values:
                  - ssd
                  - hdd
          preferredDuringSchedulingIgnoredDuringExecution:
            - weight: 10
              preference:
                matchExpressions:
                  - key: storage
                    operator: In
                    values:
                      - ssd
            - weight: 5
              preference:
                matchExpressions:
                  - key: storage
                    operator: In
                    values:
                      - hdd
      containers:
        - name: nginx
          image: nginx
</pre>
</div>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Operator</th>
<th scope="col" class="org-left">Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">In</td>
<td class="org-left">Matches if the node’s label exists in the provided values.</td>
</tr>

<tr>
<td class="org-left">NotIn</td>
<td class="org-left">Matches if the node’s label does not exist in the provided values.</td>
</tr>

<tr>
<td class="org-left">Exists</td>
<td class="org-left">Matches if the node has the specified key, regardless of its value.</td>
</tr>

<tr>
<td class="org-left">DoesNotExist</td>
<td class="org-left">Matches if the node does not have the specified key.</td>
</tr>

<tr>
<td class="org-left">Gt</td>
<td class="org-left">Matches if the label’s value is greater than the specified number.</td>
</tr>

<tr>
<td class="org-left">Lt</td>
<td class="org-left">Matches if the label’s value is less than the specified number.</td>
</tr>
</tbody>
</table>
</div>
<div id="outline-container-org85984b3" class="outline-4">
<h4 id="org85984b3"><span class="section-number-4">3.12.1.</span> Takeaway: The most flexible way to optimize the resource utilization</h4>
</div>
</div>
<div id="outline-container-orge5091f3" class="outline-3">
<h3 id="orge5091f3"><span class="section-number-3">3.13.</span> Request and limits</h3>
<div class="outline-text-3" id="text-3-13">
<ul class="org-ul">
<li>Requests and limits must be defined per container inside a Pod.</li>
<li>If a container exceeds its requested resources, it can still use more resources if available on the node.</li>
<li>If a container exceeds its requested CPU resource: CPU is a compressible resource, so workloads slow down instead of failing</li>
<li>If a container exceeds its requested Memary resource: the kernel may kill it,  But If there is no memory pressure, the container may not be killed immediately</li>
</ul>
</div>
<div id="outline-container-org8d5e11e" class="outline-4">
<h4 id="org8d5e11e"><span class="section-number-4">3.13.1.</span> Monitoring</h4>
<div class="outline-text-4" id="text-3-13-1">
<p>
Install metrics server on Kubernetes
</p>
<div class="org-src-container">
<pre class="src src-nil">kubectl top nodes
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgcd2f715" class="outline-3">
<h3 id="orgcd2f715"><span class="section-number-3">3.14.</span> Scaling</h3>
<div class="outline-text-3" id="text-3-14">
<ul class="org-ul">
<li>Scaling refers to adjusting the resources available to an application based on its demand/load.</li>
</ul>
</div>
<div id="outline-container-orgdc50ecc" class="outline-4">
<h4 id="orgdc50ecc"><span class="section-number-4">3.14.1.</span> Horizontal Scaling</h4>
<div class="outline-text-4" id="text-3-14-1">
<ul class="org-ul">
<li>Scale-Out: Increasing the number of pod replicas</li>
<li>Scaling In: Removing instances/pods when load decreases</li>
<li>Manually: Editing the Deployment YAML (replicas field) and apply</li>
<li>Automatic: HPA (Horizontal Pod Autoscaler)</li>
</ul>
</div>
</div>
<div id="outline-container-orga43bdda" class="outline-4">
<h4 id="orga43bdda"><span class="section-number-4">3.14.2.</span> Vertical Scaling</h4>
<div class="outline-text-4" id="text-3-14-2">
<ul class="org-ul">
<li>Scaling Up: Increasing CPU/Memory resources of the existing pod or VM.</li>
<li>Scaling Down: Reducing CPU/Memory.</li>
<li>Manually: Editing the Deployment YAML (replicas field) and apply</li>
<li>Automatic: VPA (Vertical Pod Autoscaler)</li>
</ul>
</div>
</div>
<div id="outline-container-org90b4fb1" class="outline-4">
<h4 id="org90b4fb1"><span class="section-number-4">3.14.3.</span> Node side</h4>
<div class="outline-text-4" id="text-3-14-3">
<p>
clusters rely on horizontal scaling of nodes to maintain availability. vertical scaling requeir restarting, which is not working for production environment
</p>
</div>
</div>
</div>
<div id="outline-container-org23d3611" class="outline-3">
<h3 id="org23d3611"><span class="section-number-3">3.15.</span> Horizontal Pod Autoscaler (HPA)</h3>
<div class="outline-text-3" id="text-3-15">
<p>
based on the default/custom/External Resource Metrics to automatically scale out/in
</p>
</div>
</div>
<div id="outline-container-org18f4d15" class="outline-3">
<h3 id="org18f4d15"><span class="section-number-3">3.16.</span> namespace</h3>
<div class="outline-text-3" id="text-3-16">
<ul class="org-ul">
<li>Context contains cluster, users, and namespace, they are not coupled, we can change the namespace of a contex.</li>
</ul>
<div class="org-src-container">
<pre class="src src-nil">kubectl config set-context --current --namespace=app1-ns
</pre>
</div>
</div>
</div>
<div id="outline-container-org01054f1" class="outline-3">
<h3 id="org01054f1"><span class="section-number-3">3.17.</span> Vertical Pod Autoscaler (VPA)</h3>
</div>
<div id="outline-container-org2643b05" class="outline-3">
<h3 id="org2643b05"><span class="section-number-3">3.18.</span> Multi-container pods</h3>
<div class="outline-text-3" id="text-3-18">
<p>
a primary container complemented by one or more helper containers
</p>
</div>
<div id="outline-container-org09a0464" class="outline-4">
<h4 id="org09a0464"><span class="section-number-4">3.18.1.</span> Init Containers</h4>
<div class="outline-text-4" id="text-3-18-1">
<p>
successfully complete before the primary container runs as pre-requests
</p>
<div class="org-src-container">
<pre class="src src-nil">apiVersion: v1
kind: Pod
metadata:
  name: init-demo
spec:
  initContainers:
  - name: check-api
    image: curlimages/curl:latest
    command:
      - sh
      - -c
      - |
        echo 'Checking API availability...'
        sleep 25
        until curl -s https://kubernetes.io &gt; /dev/null; do
          echo 'Waiting for API...'
          sleep 5
        done
        echo 'API is accessible, proceeding to main-app container!'
  containers:
  - name: main-app
    image: nginx:latest
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbef37bd" class="outline-4">
<h4 id="orgbef37bd"><span class="section-number-4">3.18.2.</span> Sidecar Pattern</h4>
<div class="outline-text-4" id="text-3-18-2">
<p>
run alongside the primary container and operate independently to extend or complement the main container's functionality.
</p>
<div class="org-src-container">
<pre class="src src-nil">apiVersion: v1
kind: Pod
metadata:
  name: sidecar-logging-demo
spec:
  containers:
  # Main application container
  - name: main-app
    image: nginx:latest
    ports:
    - containerPort: 80
  # Sidecar container
  - name: health-logger
    image: curlimages/curl:latest
    command:
    - sh
    - -c
    - |
      while true; do
        curl -s http://localhost:80 &gt; /dev/null &amp;&amp; echo 'Main app is healthy' || echo 'Main app is unhealthy'
        sleep 5
      done

</pre>
</div>
</div>
</div>
<div id="outline-container-orgc37f746" class="outline-4">
<h4 id="orgc37f746"><span class="section-number-4">3.18.3.</span> Ambassador Pattern</h4>
<div class="outline-text-4" id="text-3-18-3">
<p>
like sidecar but only focus on handling external communication
</p>
</div>
</div>
<div id="outline-container-orge8446fa" class="outline-4">
<h4 id="orge8446fa"><span class="section-number-4">3.18.4.</span> Adapter Pattern</h4>
<div class="outline-text-4" id="text-3-18-4">
<p>
like sidecar but only focus on data transforming or normalizing
</p>
</div>
</div>
</div>
<div id="outline-container-orgd329ac1" class="outline-3">
<h3 id="orgd329ac1"><span class="section-number-3">3.19.</span> Pod Policies</h3>
<div class="outline-text-3" id="text-3-19">
</div>
<div id="outline-container-org8ae1b9d" class="outline-4">
<h4 id="org8ae1b9d"><span class="section-number-4">3.19.1.</span> Delete policies</h4>
<div class="outline-text-4" id="text-3-19-1">
<ul class="org-ul">
<li><p>
graceful termination for 30 seconds, after that SIGKILL will terminate it immediately if it still lives
</p>
<div class="org-src-container">
<pre class="src src-nil">apiVersion: v1
kind: Pod
metadata:
  name: nginx- graceful
spec:
  terminationGracePeriodSeconds: 30
  containers:
  - name: nginx
    image: nginx:latest
</pre>
</div></li>
</ul>
<p>
apply and delete
</p>
<div class="org-src-container">
<pre class="src src-nil">kubectl delete pod xxx
</pre>
</div>

<p>
for forceful deletion:
</p>
<div class="org-src-container">
<pre class="src src-nil">kubectl delete pod mypod --force=true --grace-period=0
</pre>
</div>
</div>
</div>
<div id="outline-container-org042ac3d" class="outline-4">
<h4 id="org042ac3d"><span class="section-number-4">3.19.2.</span> Restart Policies</h4>
<div class="outline-text-4" id="text-3-19-2">
<p>
how Kubernetes responds when containers within a pod terminate, it's at the pod level and apply to all containers within the pod
</p>
<ul class="org-ul">
<li>Always(whether it succeeds with exit code 0 or fails with a non-zero exit code): Pods, Deployments, ReplicaSets, StatefulSets, DaemonSets</li>
<li>OnFailure (exit code 0): Jobs, Cronjobs</li>
<li><p>
Never: not restarted, regardless of the exit code (whether it succeeds or fails)
</p>

<div class="org-src-container">
<pre class="src src-nil">apiVersion: batch/v1
kind: Job
metadata:
  name: batch-job-example
spec:
  template:
    spec:
      restartPolicy: OnFailure
      containers:
      - name: processor
        image: my-batch-job:latest
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org30e9ab9" class="outline-4">
<h4 id="org30e9ab9"><span class="section-number-4">3.19.3.</span> Image Pull Policies</h4>
<div class="outline-text-4" id="text-3-19-3">
<p>
how the container runtime pulls container images for initialization. At Container level for each containter customizable
</p>
<div class="org-src-container">
<pre class="src src-nil">apiVersion: v1
kind: Pod
metadata:
  name: always-example
spec:
  containers:
  - name: my-app
    image: myrepo/my-app:latest
    imagePullPolicy: Always
</pre>
</div>

<ul class="org-ul">
<li>Always, default, prefer for development</li>
<li>IfNotPresent, only NOT available on the node cache</li>
<li>Never, assuming the image is already present on the node.</li>
<li>if Image tag is latest, default police is Always,</li>
<li>if image tag is with specific version tag, default police is IfNotPresent</li>
</ul>
</div>
</div>
<div id="outline-container-org6d84fc4" class="outline-4">
<h4 id="org6d84fc4"><span class="section-number-4">3.19.4.</span> Pod Lifecycle and debugging see <a href="https://github.com/CloudWithVarJosh/CKA-Certification-Course-2025/tree/main/Day%2022">Day 22</a></h4>
</div>
</div>
<div id="outline-container-orgc1d5149" class="outline-3">
<h3 id="orgc1d5149"><span class="section-number-3">3.20.</span> health probes</h3>
<div class="outline-text-3" id="text-3-20">
<p>
The kubelet is responsible for performing these probes. 
</p>
</div>
<div id="outline-container-orgdd82c11" class="outline-4">
<h4 id="orgdd82c11"><span class="section-number-4">3.20.1.</span> Readiness Probes</h4>
<div class="outline-text-4" id="text-3-20-1">
<p>
only health pods receiving traffic, otherwise removed, no restart
</p>
</div>
</div>
<div id="outline-container-orgb38c005" class="outline-4">
<h4 id="orgb38c005"><span class="section-number-4">3.20.2.</span> Liveness Probes</h4>
<div class="outline-text-4" id="text-3-20-2">
<p>
with restarting if failed
</p>
</div>
</div>
<div id="outline-container-org84d9a62" class="outline-4">
<h4 id="org84d9a62"><span class="section-number-4">3.20.3.</span> Startup Probes</h4>
<div class="outline-text-4" id="text-3-20-3">
<p>
set threshold times of attempts before marked as failed for slow-starting
</p>
</div>
</div>
</div>
<div id="outline-container-org86b96be" class="outline-3">
<h3 id="org86b96be"><span class="section-number-3">3.21.</span> Ephemeral Storage</h3>
<div class="outline-text-3" id="text-3-21">
</div>
<div id="outline-container-org3360ce9" class="outline-4">
<h4 id="org3360ce9"><span class="section-number-4">3.21.1.</span> emptyDir</h4>
<div class="outline-text-4" id="text-3-21-1">
<p>
It is ideal for scratch space (Temporary workspace for processing.), caching, or temporary computations where data persistence isn’t required.
</p>

<div class="org-src-container">
<pre class="src src-nil">apiVersion: v1  # Specifies the API version used to create the Pod.
kind: Pod       # Declares the resource type as a Pod.
metadata:
  name: emptydir-example  # Name of the Pod.
spec:
  containers:
  - name: busybox-container  # Name of the container inside the Pod.
    image: busybox           # Using the lightweight BusyBox image.
    command: ["/bin/sh", "-c", "sleep 3600"]  # Overrides the default command. Keeps the container running for 1 hour (3600 seconds).
    volumeMounts:
    - mountPath: /data       # Mount point inside the container where the volume will be accessible.
      name: temp-storage     # Refers to the volume defined in the `volumes` section below.
  - name: busybox-container-2  # Name of the container inside the Pod.
    image: busybox           # Using the lightweight BusyBox image.
    command: ["/bin/sh", "-c", "sleep 3600"]
    volumeMounts:
    - mountPath: /data
      name: temp-storage
  volumes:
  - name: temp-storage       # Name of the volume, must match the name in `volumeMounts`.
    emptyDir: {}             # Creates a temporary directory that lives as long as the Pod exists.
                            # Useful for storing transient data that doesn't need to persist.

</pre>
</div>
<p>
all containter by applying this yaml will access the same data as in volume.
</p>
</div>
</div>
<div id="outline-container-org4cf7667" class="outline-4">
<h4 id="org4cf7667"><span class="section-number-4">3.21.2.</span> Downward API</h4>
<div class="outline-text-4" id="text-3-21-2">
<ul class="org-ul">
<li>It injectes into containers in a Pod either as environment variables or through mounted files via volumes</li>
<li>Just like Sidecar pattern, This helps sidecar containter to get matrics from the main contrainter.</li>
<li>please refer <a href="https://github.com/CloudWithVarJosh/CKA-Certification-Course-2025/tree/main/Day%2026">env and file mount at github</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgc8f9cde" class="outline-3">
<h3 id="orgc8f9cde"><span class="section-number-3">3.22.</span> Volume</h3>
<div class="outline-text-3" id="text-3-22">
<p>
<a href="https://github.com/CloudWithVarJosh/CKA-Certification-Course-2025/blob/main/Day%2027/README.md">link</a>
</p>
<ul class="org-ul">
<li>hostPath: Persistent change map to host machine, the data can be shared between different pods only if they are scheduled on the same node.</li>
<li>Storage class, a replace of pv</li>
<li>pv (persistentvolume) clain a  physical  storage(retain, delete) global at cluster level</li>
<li>pvc(persistentvolumeClaim) use the pv under a namespace, all the charactore muss be passend</li>
<li>pod, chaim the volume and mount it to somewhere in container</li>
<li>to delete, pod at first, otherwise pv/pvc hold still until pod died</li>
</ul>
</div>
<div id="outline-container-orgc7e042e" class="outline-4">
<h4 id="orgc7e042e"><span class="section-number-4">3.22.1.</span> PV vs PVC</h4>
<div class="outline-text-4" id="text-3-22-1">
<ul class="org-ul">
<li>common: storageClassName, accessModes,</li>
<li>PV: capacity, PersistentVolumeReclaimPolicy, hostPath</li>
<li>PVC: resource, volumeName</li>
</ul>
</div>
</div>
<div id="outline-container-org5ad1643" class="outline-4">
<h4 id="org5ad1643"><span class="section-number-4">3.22.2.</span> hostPath</h4>
<div class="outline-text-4" id="text-3-22-2">
</div>
<ol class="org-ol">
<li><a id="org7163d66"></a>in volumes<br />
<div class="outline-text-5" id="text-3-22-2-1">
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #dcaeea;">apiVersion</span>: v1
<span style="color: #dcaeea;">kind</span>: Pod
<span style="color: #dcaeea;">metadata</span>:
<span style="color: #dcaeea;">spec</span>:
  <span style="color: #dcaeea;">containers</span>:
    <span style="color: #dcaeea;">volumeMounts</span>:
    - <span style="color: #dcaeea;">name</span>: mypd
      <span style="color: #dcaeea;">mountPath</span>: <span style="color: #98be65;">"/var/www/html/1"</span>

  <span style="color: #dcaeea;">volumes</span>:
  - <span style="color: #dcaeea;">name</span>: myvol1
    <span style="color: #dcaeea;">hostPath</span>:
      <span style="color: #dcaeea;">path</span>: /any/path/it/will/be/replaced
</pre>
</div>
</div>
</li>
<li><a id="org1a09220"></a>in PV<br />
<div class="outline-text-5" id="text-3-22-2-2">
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #dcaeea;">apiVersion</span>: v1
<span style="color: #dcaeea;">kind</span>: PersistentVolume
<span style="color: #dcaeea;">metadata</span>:
<span style="color: #dcaeea;">spec</span>:
  <span style="color: #dcaeea;">hostPath</span>:
    <span style="color: #dcaeea;">path</span>: /opt/volume/nginx
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgdc8dc4e" class="outline-4">
<h4 id="orgdc8dc4e"><span class="section-number-4">3.22.3.</span> storageClassName</h4>
<div class="outline-text-4" id="text-3-22-3">
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #dcaeea;">apiVersion</span>: v1
<span style="color: #dcaeea;">kind</span>: PersistentVolume
<span style="color: #dcaeea;">metadata</span>:
<span style="color: #dcaeea;">spec</span>:
  <span style="color: #dcaeea;">storageClassName</span>: maunal
</pre>
</div>

<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #dcaeea;">apiVersion</span>: v1
<span style="color: #dcaeea;">kind</span>: PersistentVolumeClaim
<span style="color: #dcaeea;">metadata</span>:
<span style="color: #dcaeea;">spec</span>:
  <span style="color: #dcaeea;">storageClassName</span>: maunal
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf1ac4f2" class="outline-4">
<h4 id="orgf1ac4f2"><span class="section-number-4">3.22.4.</span> volumeName</h4>
<div class="outline-text-4" id="text-3-22-4">
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #dcaeea;">apiVersion</span>: v1
<span style="color: #dcaeea;">kind</span>: PersistentVolumeClaim
<span style="color: #dcaeea;">metadata</span>:
<span style="color: #dcaeea;">spec</span>:
  <span style="color: #dcaeea;">volumeName</span>: log-volume

</pre>
</div>
</div>
</div>
<div id="outline-container-org092840e" class="outline-4">
<h4 id="org092840e"><span class="section-number-4">3.22.5.</span> usage</h4>
<div class="outline-text-4" id="text-3-22-5">
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #dcaeea;">apiVersion</span>: v1
<span style="color: #dcaeea;">kind</span>: Pod
<span style="color: #dcaeea;">metadata</span>:
  <span style="color: #dcaeea;">name</span>: mypod
<span style="color: #dcaeea;">spec</span>:
  <span style="color: #dcaeea;">containers</span>:
    - <span style="color: #dcaeea;">name</span>: mynginx
      <span style="color: #dcaeea;">image</span>: nginx
      <span style="color: #dcaeea;">volumeMounts</span>:
          - <span style="color: #dcaeea;">name</span>: my-vol1
            <span style="color: #dcaeea;">path</span>: /www/html/v1
          - <span style="color: #dcaeea;">name</span>: my-vol2
            <span style="color: #dcaeea;">path</span>: /www/html/v2

  <span style="color: #dcaeea;">volumes</span>:
    - <span style="color: #dcaeea;">name</span>: my-vol1
      <span style="color: #dcaeea;">hostPath</span>:
        <span style="color: #dcaeea;">path</span>: /my/loacl/path
    - <span style="color: #dcaeea;">name</span>: my-vol2
      <span style="color: #dcaeea;">persistentVolumeClaim</span>:
        <span style="color: #dcaeea;">chainName</span>: my-pvc

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd7e4b99" class="outline-3">
<h3 id="orgd7e4b99"><span class="section-number-3">3.23.</span> Matrics server</h3>
<div class="outline-text-3" id="text-3-23">
<p>
kubectl apply -f <a href="https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml">https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml</a>
</p>
</div>
</div>
<div id="outline-container-org2e25486" class="outline-3">
<h3 id="org2e25486"><span class="section-number-3">3.24.</span> selector</h3>
<div class="outline-text-3" id="text-3-24">
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #dcaeea;">selector</span>:
<span style="color: #dcaeea;">matchLabels</span>:
  <span style="color: #dcaeea;">component</span>: redis
<span style="color: #dcaeea;">matchExpressions</span>:
  - { <span style="color: #dcaeea;">key</span>: tier, <span style="color: #dcaeea;">operator</span>: In, <span style="color: #dcaeea;">values</span>: [cache] }
  - { <span style="color: #dcaeea;">key</span>: environment, <span style="color: #dcaeea;">operator</span>: NotIn, <span style="color: #dcaeea;">values</span>: [dev] }
</pre>
</div>
</div>
</div>
<div id="outline-container-org0a194c3" class="outline-3">
<h3 id="org0a194c3"><span class="section-number-3">3.25.</span> nodeAffinity</h3>
<div class="outline-text-3" id="text-3-25">
<div class="org-src-container">
<pre class="src src-yaml">  <span style="color: #dcaeea;">apiVersion</span>: v1
<span style="color: #dcaeea;">kind</span>: Pod
<span style="color: #dcaeea;">metadata</span>:
<span style="color: #dcaeea;">spec</span>:
  <span style="color: #dcaeea;">affinity</span>:
    <span style="color: #dcaeea;">nodeAffinity</span>:
      <span style="color: #dcaeea;">requiredDuringSchedulingIgnoredDuringExecution</span>:
        <span style="color: #dcaeea;">nodeSelectorTerms</span>:
        - <span style="color: #dcaeea;">matchExpressions</span>:
          - <span style="color: #dcaeea;">key</span>: topology.kubernetes.io/zone
            <span style="color: #dcaeea;">operator</span>: In
            <span style="color: #dcaeea;">values</span>:
            - antarctica-east1
            - antarctica-west1
      <span style="color: #dcaeea;">preferredDuringSchedulingIgnoredDuringExecution</span>:
      - <span style="color: #dcaeea;">weight</span>: 1
        <span style="color: #dcaeea;">preference</span>:
          <span style="color: #dcaeea;">matchExpressions</span>:
          - <span style="color: #dcaeea;">key</span>: another-node-label-key
            <span style="color: #dcaeea;">operator</span>: In
            <span style="color: #dcaeea;">values</span>:
            - another-node-label-value
</pre>
</div>
</div>
</div>
<div id="outline-container-org5bac9ac" class="outline-3">
<h3 id="org5bac9ac"><span class="section-number-3">3.26.</span> networkPolicy</h3>
<div class="outline-text-3" id="text-3-26">
<p>
select pod to action
</p>
</div>
</div>
<div id="outline-container-org8611e41" class="outline-3">
<h3 id="org8611e41"><span class="section-number-3">3.27.</span> update and rollback</h3>
<div class="outline-text-3" id="text-3-27">
</div>
<div id="outline-container-org8768d60" class="outline-4">
<h4 id="org8768d60"><span class="section-number-4">3.27.1.</span> 1. create the deployment and  add description in metadata</h4>
<div class="outline-text-4" id="text-3-27-1">
<div class="org-src-container">
<pre class="src src-bash">kubectl create deployment mynginx --image=nginx --replicas=2 
</pre>
</div>

<pre class="example">
deployment.apps/mynginx created
</pre>


<p>
add description
</p>
<div class="org-src-container">
<pre class="src src-bash">kubectl annotate deployment mynginx <span style="color: #dcaeea;">description</span>=<span style="color: #98be65;">"my orginal nginx"</span>
</pre>
</div>

<pre class="example">
deployment.apps/mynginx annotated
</pre>


<div class="org-src-container">
<pre class="src src-bash">kubectl get deployment mynginx -o yaml | grep description
</pre>
</div>

<pre class="example">
description: my orginal nginx
</pre>


<p>
this will not create a new revision fo rollback
</p>
<div class="org-src-container">
<pre class="src src-bash">kubectl rollout history deployment mynginx 
</pre>
</div>

<pre class="example">
deployment.apps/mynginx 
REVISION  CHANGE-CAUSE
1         &lt;none&gt;

</pre>



<div class="org-src-container">
<pre class="src src-bash">kubectl get pods
</pre>
</div>

<pre class="example">
NAME                       READY   STATUS    RESTARTS   AGE
mynginx-5cb564657c-h5pgb   1/1     Running   0          36s
mynginx-5cb564657c-jnmsk   1/1     Running   0          36s
</pre>



<p>
check the version
</p>
<div class="org-src-container">
<pre class="src src-bash">kubectl exec  mynginx-5cb564657c-g6xjr  -- nginx -v 2&gt;&amp;1
</pre>
</div>

<pre class="example">
nginx version: nginx/1.29.3
</pre>
</div>
</div>
<div id="outline-container-orgd02c3d3" class="outline-4">
<h4 id="orgd02c3d3"><span class="section-number-4">3.27.2.</span> 2. make change</h4>
<div class="outline-text-4" id="text-3-27-2">
<div class="org-src-container">
<pre class="src src-bash">kubectl set image deployment mynginx  <span style="color: #dcaeea;">nginx</span>=nginx:1.23 --record
</pre>
</div>

<pre class="example">
deployment.apps/mynginx image updated
</pre>


<p>
check if the change is finished
</p>
<div class="org-src-container">
<pre class="src src-bash">kubectl rollout status deployment mynginx 
</pre>
</div>

<pre class="example">
deployment "mynginx" successfully rolled out
</pre>



<p>
if  it's done, check the revision records
</p>
<div class="org-src-container">
<pre class="src src-bash">kubectl rollout history deployment mynginx 
</pre>
</div>

<pre class="example">
deployment.apps/mynginx 
REVISION  CHANGE-CAUSE
1         &lt;none&gt;
2         kubectl set image deployment mynginx nginx=nginx:1.23 --record=true

</pre>



<div class="org-src-container">
<pre class="src src-bash">kubectl get pods
</pre>
</div>

<pre class="example">
NAME                     READY   STATUS    RESTARTS   AGE
mynginx-7c9bbc59-7pkqd   1/1     Running   0          37s
mynginx-7c9bbc59-tjxv6   1/1     Running   0          39s
</pre>


<p>
check the change
</p>
<div class="org-src-container">
<pre class="src src-bash">kubectl exec  mynginx-7c9bbc59-7pkqd  -- nginx -v 2&gt;&amp;1
</pre>
</div>

<pre class="example">
nginx version: nginx/1.23.4
</pre>
</div>
</div>
<div id="outline-container-orgb9f25d5" class="outline-4">
<h4 id="orgb9f25d5"><span class="section-number-4">3.27.3.</span> 3. rollback to wanted version and check again</h4>
<div class="outline-text-4" id="text-3-27-3">
<div class="org-src-container">
<pre class="src src-bash">kubectl rollout undo deployment/mynginx  --to-revision=1
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">kubectl get pods
</pre>
</div>

<pre class="example">
NAME                       READY   STATUS    RESTARTS   AGE
mynginx-5cb564657c-2n8sx   1/1     Running   0          6s
mynginx-5cb564657c-46tzf   1/1     Running   0          9s
</pre>



<p>
and check again
</p>
<div class="org-src-container">
<pre class="src src-bash">kubectl exec  mynginx-5cb564657c-2n8sx  -- nginx -v 2&gt;&amp;1
</pre>
</div>

<pre class="example">
nginx version: nginx/1.29.3
</pre>
</div>
</div>
<div id="outline-container-org368651f" class="outline-4">
<h4 id="org368651f"><span class="section-number-4">3.27.4.</span> 4. clean</h4>
<div class="outline-text-4" id="text-3-27-4">
<div class="org-src-container">
<pre class="src src-bash">kubectl delete deployment mynginx
</pre>
</div>

<pre class="example">
deployment.apps "mynginx" deleted from default namespace
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org20beb78" class="outline-2">
<h2 id="org20beb78"><span class="section-number-2">4.</span> Kubectl imperative</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org047a513" class="outline-3">
<h3 id="org047a513"><span class="section-number-3">4.1.</span> Deployment</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Use &#x2013;dry-run=client for local validation and &#x2013;dry-run=server for API server validation
</p>
<div class="org-src-container">
<pre class="src src-bash">kubectl create deployment backend-deploy <span style="color: #98be65;">\</span>
--image=hashicorp/http-echo <span style="color: #98be65;">\</span>
--replicas=3 <span style="color: #98be65;">\</span>
--port=5678 <span style="color: #98be65;">\</span>
--dry-run=client -o yaml 
</pre>
</div>

<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #dcaeea;">apiVersion</span>: apps/v1
<span style="color: #dcaeea;">kind</span>: Deployment
<span style="color: #dcaeea;">metadata</span>:
  <span style="color: #dcaeea;">labels</span>:
    <span style="color: #dcaeea;">app</span>: backend-deploy
  <span style="color: #dcaeea;">name</span>: backend-deploy
<span style="color: #dcaeea;">spec</span>:
  <span style="color: #dcaeea;">replicas</span>: 3
  <span style="color: #dcaeea;">selector</span>:
    <span style="color: #dcaeea;">matchLabels</span>:
      <span style="color: #dcaeea;">app</span>: backend-deploy
  <span style="color: #dcaeea;">strategy</span>: {<span style="color: #dcaeea;">}</span>
<span style="color: #dcaeea;">  template</span>:
    <span style="color: #dcaeea;">metadata</span>:
      <span style="color: #dcaeea;">labels</span>:
        <span style="color: #dcaeea;">app</span>: backend-deploy
    <span style="color: #dcaeea;">spec</span>:
      <span style="color: #dcaeea;">containers</span>:
      - <span style="color: #dcaeea;">image</span>: hashicorp/http-echo
        <span style="color: #dcaeea;">name</span>: http-echo
        <span style="color: #dcaeea;">ports</span>:
        - <span style="color: #dcaeea;">containerPort</span>: 5678
        <span style="color: #dcaeea;">resources</span>: {<span style="color: #dcaeea;">}</span>
<span style="color: #dcaeea;">status</span>: {}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-nil">kubectl expose deployment backend-deploy \
--type=ClusterIP \
--port=9090 \
--target-port=5678 \
--name=backend-svc \
--dry-run=client -o yaml 
</pre>
</div>

<p>
No NodePort can be set here
</p>
<div class="org-src-container">
<pre class="src src-nil">kubectl expose deployment backend-deploy \
--type=ClusterIP \
--port=9090 \
--target-port=5678 \
--name=backend-svc \
--dry-run=client -o yaml 
</pre>
</div>

<div class="org-src-container">
<pre class="src src-nil">kubectl run mypod.... --port=80, this port number is actually set the containerPort attribe
kubectl expose pod  mypod.... --port=80, this port number is actually set the Port attribe, and the TargetPort is set to be same same of the containerPort of mypod, they have to be the same
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">kubectl create deployment nginx-deployment --image=nginx:1.14.2 --replicas=2 --port=80 --dry-run=client -o yaml 
</pre>
</div>

<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #dcaeea;">apiVersion</span>: apps/v1
<span style="color: #dcaeea;">kind</span>: Deployment
<span style="color: #dcaeea;">metadata</span>:
  <span style="color: #dcaeea;">labels</span>:
    <span style="color: #dcaeea;">app</span>: nginx-deployment
  <span style="color: #dcaeea;">name</span>: nginx-deployment
<span style="color: #dcaeea;">spec</span>:
  <span style="color: #dcaeea;">replicas</span>: 2
  <span style="color: #dcaeea;">selector</span>:
    <span style="color: #dcaeea;">matchLabels</span>:
      <span style="color: #dcaeea;">app</span>: nginx-deployment
  <span style="color: #dcaeea;">strategy</span>: {<span style="color: #dcaeea;">}</span>
<span style="color: #dcaeea;">  template</span>:
    <span style="color: #dcaeea;">metadata</span>:
      <span style="color: #dcaeea;">labels</span>:
        <span style="color: #dcaeea;">app</span>: nginx-deployment
    <span style="color: #dcaeea;">spec</span>:
      <span style="color: #dcaeea;">containers</span>:
      - <span style="color: #dcaeea;">image</span>: nginx:1.14.2
        <span style="color: #dcaeea;">name</span>: nginx
        <span style="color: #dcaeea;">ports</span>:
        - <span style="color: #dcaeea;">containerPort</span>: 80
        <span style="color: #dcaeea;">resources</span>: {<span style="color: #dcaeea;">}</span>
<span style="color: #dcaeea;">status</span>: {}
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Silin Zhao</p>
<p class="date">Created: 2025-11-04 Di 00:40</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
